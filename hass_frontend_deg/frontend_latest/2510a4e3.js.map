{"version":3,"file":"2510a4e3.js","mappings":";;AAgEA;AACA;AACA;AACA;;;;;;AAMA;;;;AAIA;;;AAIA;;;;AAMA;;AAEA;;;;;;;;;;AAUA;;;AAIA;AAGA;;;;;;;;;;;;;;;;;;;;;;AApFA","sources":["webpack://home-assistant-frontend/./src/panels/config/integrations/integration-panels/zwave_js/zwave_js-logs.ts"],"sourcesContent":["import { mdiDownload } from \"@mdi/js\";\nimport \"@polymer/paper-dropdown-menu/paper-dropdown-menu\";\nimport \"@polymer/paper-listbox/paper-listbox\";\nimport { UnsubscribeFunc } from \"home-assistant-js-websocket\";\nimport { css, CSSResultArray, html, LitElement } from \"lit\";\nimport { customElement, property, query, state } from \"lit/decorators\";\nimport { capitalizeFirstLetter } from \"../../../../../common/string/capitalize-first-letter\";\nimport \"../../../../../components/ha-icon-button\";\nimport {\n  fetchZWaveJSLogConfig,\n  setZWaveJSLogLevel,\n  subscribeZWaveJSLogs,\n  ZWaveJSLogConfig,\n} from \"../../../../../data/zwave_js\";\nimport \"../../../../../layouts/hass-tabs-subpage\";\nimport { SubscribeMixin } from \"../../../../../mixins/subscribe-mixin\";\nimport { haStyle } from \"../../../../../resources/styles\";\nimport { HomeAssistant, Route } from \"../../../../../types\";\nimport { fileDownload } from \"../../../../../util/file_download\";\nimport { configTabs } from \"./zwave_js-config-router\";\n\n@customElement(\"zwave_js-logs\")\nclass ZWaveJSLogs extends SubscribeMixin(LitElement) {\n  @property({ attribute: false }) public hass!: HomeAssistant;\n\n  @property({ type: Object }) public route!: Route;\n\n  @property({ type: Boolean }) public narrow!: boolean;\n\n  @property() public configEntryId!: string;\n\n  @state() private _logConfig?: ZWaveJSLogConfig;\n\n  @query(\"textarea\", true) private _textarea?: HTMLTextAreaElement;\n\n  public hassSubscribe(): Array<UnsubscribeFunc | Promise<UnsubscribeFunc>> {\n    return [\n      subscribeZWaveJSLogs(this.hass, this.configEntryId, (update) => {\n        if (!this.hasUpdated) {\n          return;\n        }\n        if (update.type === \"log_message\") {\n          if (Array.isArray(update.log_message.message)) {\n            for (const line of update.log_message.message) {\n              this._textarea!.value += `${line}\\n`;\n            }\n          } else {\n            this._textarea!.value += `${update.log_message.message}\\n`;\n          }\n        } else {\n          this._logConfig = update.log_config;\n        }\n      }).then((unsub) => {\n        this._textarea!.value += `${this.hass.localize(\n          \"ui.panel.config.zwave_js.logs.subscribed_to_logs\"\n        )}\\n`;\n        return unsub;\n      }),\n    ];\n  }\n\n  protected render() {\n    return html`\n      <hass-tabs-subpage\n        .hass=${this.hass}\n        .narrow=${this.narrow}\n        .route=${this.route}\n        .tabs=${configTabs}\n      >\n        <div class=\"container\">\n          <ha-card>\n            <div class=\"card-header\">\n              <h1>\n                ${this.hass.localize(\"ui.panel.config.zwave_js.logs.title\")}\n              </h1>\n            </div>\n            <div class=\"card-content\">\n              ${this._logConfig\n                ? html`\n                    <paper-dropdown-menu\n                      dynamic-align\n                      .label=${this.hass.localize(\n                        \"ui.panel.config.zwave_js.logs.log_level\"\n                      )}\n                    >\n                      <paper-listbox\n                        slot=\"dropdown-content\"\n                        .selected=${this._logConfig.level}\n                        attr-for-selected=\"value\"\n                        @iron-select=${this._dropdownSelected}\n                      >\n                        <paper-item value=\"error\">Error</paper-item>\n                        <paper-item value=\"warn\">Warn</paper-item>\n                        <paper-item value=\"info\">Info</paper-item>\n                        <paper-item value=\"verbose\">Verbose</paper-item>\n                        <paper-item value=\"debug\">Debug</paper-item>\n                        <paper-item value=\"silly\">Silly</paper-item>\n                      </paper-listbox>\n                    </paper-dropdown-menu>\n                  `\n                : \"\"}\n            </div>\n            <ha-icon-button\n              .label=${this.hass.localize(\n                \"ui.panel.config.zwave_js.logs.download_logs\"\n              )}\n              @click=${this._downloadLogs}\n              .path=${mdiDownload}\n            ></ha-icon-button>\n          </ha-card>\n          <textarea readonly></textarea>\n        </div>\n      </hass-tabs-subpage>\n    `;\n  }\n\n  protected firstUpdated(changedProps) {\n    super.firstUpdated(changedProps);\n    this._fetchData();\n  }\n\n  private async _fetchData() {\n    if (!this.configEntryId) {\n      return;\n    }\n    this._logConfig = await fetchZWaveJSLogConfig(\n      this.hass!,\n      this.configEntryId\n    );\n  }\n\n  private _downloadLogs() {\n    fileDownload(\n      this,\n      `data:text/plain;charset=utf-8,${encodeURIComponent(\n        this._textarea!.value\n      )}`,\n      `zwave_js.log`\n    );\n  }\n\n  private _dropdownSelected(ev) {\n    if (ev.target === undefined || this._logConfig === undefined) {\n      return;\n    }\n    const selected = ev.target.selected;\n    if (this._logConfig.level === selected) {\n      return;\n    }\n    setZWaveJSLogLevel(this.hass!, this.configEntryId, selected);\n    this._textarea!.value += `${this.hass.localize(\n      \"ui.panel.config.zwave_js.logs.log_level_changed\",\n      { level: capitalizeFirstLetter(selected) }\n    )}\\n`;\n  }\n\n  static get styles(): CSSResultArray {\n    return [\n      haStyle,\n      css`\n        .container {\n          display: flex;\n          flex-direction: column;\n          height: 100%;\n          box-sizing: border-box;\n          padding: 16px;\n        }\n        textarea {\n          flex-grow: 1;\n          padding: 16px;\n        }\n        ha-card {\n          margin: 16px 0;\n        }\n      `,\n    ];\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"zwave_js-logs\": ZWaveJSLogs;\n  }\n}\n"],"names":[],"sourceRoot":""}