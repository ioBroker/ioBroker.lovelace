{"version":3,"file":"ec2904af.js","mappings":";;;;AAwOA;AACA;;;AAqBA;AACA;AAGA","sources":["webpack://home-assistant-frontend/./src/panels/my/ha-panel-my.ts"],"sourcesContent":["import { sanitizeUrl } from \"@braintree/sanitize-url\";\nimport { html, LitElement } from \"lit\";\nimport { customElement, property, state } from \"lit/decorators\";\nimport { isComponentLoaded } from \"../../common/config/is_component_loaded\";\nimport { navigate } from \"../../common/navigate\";\nimport {\n  createSearchParam,\n  extractSearchParamsObject,\n} from \"../../common/url/search-params\";\nimport { domainToName } from \"../../data/integration\";\nimport \"../../layouts/hass-error-screen\";\nimport { HomeAssistant, Route } from \"../../types\";\nimport { documentationUrl } from \"../../util/documentation-url\";\n\nconst REDIRECTS: Redirects = {\n  developer_states: {\n    redirect: \"/developer-tools/state\",\n  },\n  developer_services: {\n    redirect: \"/developer-tools/service\",\n  },\n  developer_call_service: {\n    redirect: \"/developer-tools/service\",\n    params: {\n      service: \"string\",\n    },\n  },\n  developer_template: {\n    redirect: \"/developer-tools/template\",\n  },\n  developer_events: {\n    redirect: \"/developer-tools/event\",\n  },\n  developer_statistics: {\n    redirect: \"/developer-tools/statistics\",\n  },\n  config: {\n    redirect: \"/config\",\n  },\n  cloud: {\n    component: \"cloud\",\n    redirect: \"/config/cloud\",\n  },\n  integrations: {\n    redirect: \"/config/integrations\",\n  },\n  config_flow_start: {\n    redirect: \"/config/integrations/add\",\n    params: {\n      domain: \"string\",\n    },\n  },\n  config_mqtt: {\n    component: \"mqtt\",\n    redirect: \"/config/mqtt\",\n  },\n  config_zha: {\n    component: \"zha\",\n    redirect: \"/config/zha/dashboard\",\n  },\n  config_zwave_js: {\n    component: \"zwave_js\",\n    redirect: \"/config/zwave_js/dashboard\",\n  },\n  config_energy: {\n    component: \"energy\",\n    redirect: \"/config/energy/dashboard\",\n  },\n  devices: {\n    redirect: \"/config/devices/dashboard\",\n  },\n  entities: {\n    redirect: \"/config/entities\",\n  },\n  energy: {\n    component: \"energy\",\n    redirect: \"/energy\",\n  },\n  areas: {\n    redirect: \"/config/areas/dashboard\",\n  },\n  blueprints: {\n    component: \"blueprint\",\n    redirect: \"/config/blueprint/dashboard\",\n  },\n  blueprint_import: {\n    component: \"blueprint\",\n    redirect: \"/config/blueprint/dashboard/import\",\n    params: {\n      blueprint_url: \"url\",\n    },\n  },\n  automations: {\n    component: \"automation\",\n    redirect: \"/config/automation/dashboard\",\n  },\n  scenes: {\n    component: \"scene\",\n    redirect: \"/config/scene/dashboard\",\n  },\n  scripts: {\n    component: \"script\",\n    redirect: \"/config/script/dashboard\",\n  },\n  helpers: {\n    redirect: \"/config/helpers\",\n  },\n  tags: {\n    component: \"tag\",\n    redirect: \"/config/tags\",\n  },\n  lovelace_dashboards: {\n    component: \"lovelace\",\n    redirect: \"/config/lovelace/dashboards\",\n  },\n  lovelace_resources: {\n    component: \"lovelace\",\n    redirect: \"/config/lovelace/resources\",\n  },\n  people: {\n    component: \"person\",\n    redirect: \"/config/person\",\n  },\n  zones: {\n    component: \"zone\",\n    redirect: \"/config/zone\",\n  },\n  users: {\n    redirect: \"/config/users\",\n  },\n  general: {\n    redirect: \"/config/core\",\n  },\n  server_controls: {\n    redirect: \"/config/server_control\",\n  },\n  logs: {\n    redirect: \"/config/logs\",\n  },\n  info: {\n    redirect: \"/config/info\",\n  },\n  customize: {\n    // customize was removed in 2021.12, fallback to dashboard\n    redirect: \"/config/dashboard\",\n  },\n  profile: {\n    redirect: \"/profile/dashboard\",\n  },\n  logbook: {\n    component: \"logbook\",\n    redirect: \"/logbook\",\n  },\n  history: {\n    component: \"history\",\n    redirect: \"/history\",\n  },\n};\n\nexport type ParamType = \"url\" | \"string\";\n\nexport type Redirects = { [key: string]: Redirect };\nexport interface Redirect {\n  redirect: string;\n  component?: string;\n  params?: {\n    [key: string]: ParamType;\n  };\n}\n\n@customElement(\"ha-panel-my\")\nclass HaPanelMy extends LitElement {\n  @property({ attribute: false }) public hass!: HomeAssistant;\n\n  @property() public route!: Route;\n\n  @state() public _error?: string;\n\n  connectedCallback() {\n    super.connectedCallback();\n    const path = this.route.path.substr(1);\n\n    if (path.startsWith(\"supervisor\")) {\n      if (!isComponentLoaded(this.hass, \"hassio\")) {\n        this._error = \"no_supervisor\";\n        return;\n      }\n      navigate(`/hassio/_my_redirect/${path}${window.location.search}`, {\n        replace: true,\n      });\n      return;\n    }\n\n    const redirect = REDIRECTS[path];\n\n    if (!redirect) {\n      this._error = \"not_supported\";\n      return;\n    }\n\n    if (\n      redirect.component &&\n      !isComponentLoaded(this.hass, redirect.component)\n    ) {\n      this._error = \"no_component\";\n      return;\n    }\n\n    let url: string;\n    try {\n      url = this._createRedirectUrl(redirect);\n    } catch (err: any) {\n      this._error = \"url_error\";\n      return;\n    }\n\n    navigate(url, { replace: true });\n  }\n\n  protected render() {\n    if (this._error) {\n      let error: string;\n      switch (this._error) {\n        case \"not_supported\":\n          error =\n            this.hass.localize(\n              \"ui.panel.my.not_supported\",\n              \"link\",\n              html`<a\n                target=\"_blank\"\n                rel=\"noreferrer noopener\"\n                href=\"https://my.home-assistant.io/faq.html#supported-pages\"\n                >${this.hass.localize(\"ui.panel.my.faq_link\")}</a\n              >`\n            ) || \"This redirect is not supported.\";\n          break;\n        case \"no_component\":\n          error =\n            this.hass.localize(\n              \"ui.panel.my.component_not_loaded\",\n              \"integration\",\n              domainToName(\n                this.hass.localize,\n                REDIRECTS[this.route.path.substr(1)].component!\n              )\n            ) || \"This redirect is not supported.\";\n          break;\n        case \"no_supervisor\":\n          error = this.hass.localize(\n            \"ui.panel.my.no_supervisor\",\n            \"docs_link\",\n            html`<a\n              target=\"_blank\"\n              rel=\"noreferrer noopener\"\n              href=${documentationUrl(this.hass, \"/installation\")}\n              >${this.hass.localize(\"ui.panel.my.documentation\")}</a\n            >`\n          );\n          break;\n        default:\n          error = this.hass.localize(\"ui.panel.my.error\") || \"Unknown error\";\n      }\n      return html`<hass-error-screen .error=${error}></hass-error-screen>`;\n    }\n    return html``;\n  }\n\n  private _createRedirectUrl(redirect: Redirect): string {\n    const params = this._createRedirectParams(redirect);\n    return `${redirect.redirect}${params}`;\n  }\n\n  private _createRedirectParams(redirect: Redirect): string {\n    const params = extractSearchParamsObject();\n    if (!redirect.params && !Object.keys(params).length) {\n      return \"\";\n    }\n    const resultParams = {};\n    Object.entries(redirect.params || {}).forEach(([key, type]) => {\n      if (!params[key] || !this._checkParamType(type, params[key])) {\n        throw Error();\n      }\n      resultParams[key] = params[key];\n    });\n    return `?${createSearchParam(resultParams)}`;\n  }\n\n  private _checkParamType(type: ParamType, value: string) {\n    if (type === \"string\") {\n      return true;\n    }\n    if (type === \"url\") {\n      return value && value === sanitizeUrl(value);\n    }\n    return false;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"ha-panel-my\": HaPanelMy;\n  }\n}\n"],"names":[],"sourceRoot":""}