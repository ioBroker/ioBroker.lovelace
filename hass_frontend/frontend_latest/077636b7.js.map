{"version":3,"file":"077636b7.js","mappings":";AAgDA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;;;;AAjDA;;;;;;;;AAAA;;;;ACFA;;;;ACDA;ACgBA;AACA;;AAGA;;;;;;;AAQA;;AAGA;;AAxBA;AAgCA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAhCA;ACAA;;AAEA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAQA;;;;;;;;ACnBA;;;ACuEA;AACA;;;AAGA;AAGA;;;AAQA;AAGA;AAGA;AAKA;;;AAKA;;;AAQA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;AAGA;AAEA;AAGA;AAEA;;AAGA;AACA;AACA;AAGA;;AArEA","sources":["webpack://home-assistant-frontend/./src/components/ha-button-menu.ts","webpack://home-assistant-frontend/./src/components/ha-check-list-item.ts","webpack://home-assistant-frontend/./src/components/ha-checkbox.ts","webpack://home-assistant-frontend/./src/components/ha-chip.ts","webpack://home-assistant-frontend/./src/components/ha-dialog.ts","webpack://home-assistant-frontend/./src/components/ha-input-helper-text.ts","webpack://home-assistant-frontend/./src/panels/profile/dialog-ha-mfa-module-setup-flow.ts"],"sourcesContent":["import type { Button } from \"@material/mwc-button\";\nimport \"@material/mwc-menu\";\nimport type { Corner, Menu, MenuCorner } from \"@material/mwc-menu\";\nimport { css, CSSResultGroup, html, LitElement, TemplateResult } from \"lit\";\nimport { customElement, property, query } from \"lit/decorators\";\nimport { FOCUS_TARGET } from \"../dialogs/make-dialog-manager\";\nimport type { HaIconButton } from \"./ha-icon-button\";\n\n@customElement(\"ha-button-menu\")\nexport class HaButtonMenu extends LitElement {\n  protected readonly [FOCUS_TARGET];\n\n  @property() public corner: Corner = \"TOP_START\";\n\n  @property() public menuCorner: MenuCorner = \"START\";\n\n  @property({ type: Number }) public x: number | null = null;\n\n  @property({ type: Number }) public y: number | null = null;\n\n  @property({ type: Boolean }) public multi = false;\n\n  @property({ type: Boolean }) public activatable = false;\n\n  @property({ type: Boolean }) public disabled = false;\n\n  @property({ type: Boolean }) public fixed = false;\n\n  @query(\"mwc-menu\", true) private _menu?: Menu;\n\n  public get items() {\n    return this._menu?.items;\n  }\n\n  public get selected() {\n    return this._menu?.selected;\n  }\n\n  public override focus() {\n    if (this._menu?.open) {\n      this._menu.focusItemAtIndex(0);\n    } else {\n      this._triggerButton?.focus();\n    }\n  }\n\n  protected render(): TemplateResult {\n    return html`\n      <div @click=${this._handleClick}>\n        <slot name=\"trigger\" @slotchange=${this._setTriggerAria}></slot>\n      </div>\n      <mwc-menu\n        .corner=${this.corner}\n        .menuCorner=${this.menuCorner}\n        .fixed=${this.fixed}\n        .multi=${this.multi}\n        .activatable=${this.activatable}\n        .y=${this.y}\n        .x=${this.x}\n      >\n        <slot></slot>\n      </mwc-menu>\n    `;\n  }\n\n  protected firstUpdated(changedProps): void {\n    super.firstUpdated(changedProps);\n\n    if (document.dir === \"rtl\") {\n      this.updateComplete.then(() => {\n        this.querySelectorAll(\"mwc-list-item\").forEach((item) => {\n          const style = document.createElement(\"style\");\n          style.innerHTML =\n            \"span.material-icons:first-of-type { margin-left: var(--mdc-list-item-graphic-margin, 32px) !important; margin-right: 0px !important;}\";\n          item!.shadowRoot!.appendChild(style);\n        });\n      });\n    }\n  }\n\n  private _handleClick(): void {\n    if (this.disabled) {\n      return;\n    }\n    this._menu!.anchor = this;\n    this._menu!.show();\n  }\n\n  private get _triggerButton() {\n    return this.querySelector(\n      'ha-icon-button[slot=\"trigger\"], mwc-button[slot=\"trigger\"]'\n    ) as HaIconButton | Button | null;\n  }\n\n  private _setTriggerAria() {\n    if (this._triggerButton) {\n      this._triggerButton.ariaHasPopup = \"menu\";\n    }\n  }\n\n  static get styles(): CSSResultGroup {\n    return css`\n      :host {\n        display: inline-block;\n        position: relative;\n      }\n      ::slotted([disabled]) {\n        color: var(--disabled-text-color);\n      }\n    `;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"ha-button-menu\": HaButtonMenu;\n  }\n}\n","import { css } from \"lit\";\nimport { CheckListItemBase } from \"@material/mwc-list/mwc-check-list-item-base\";\nimport { styles as controlStyles } from \"@material/mwc-list/mwc-control-list-item.css\";\nimport { styles } from \"@material/mwc-list/mwc-list-item.css\";\nimport { customElement } from \"lit/decorators\";\n\n@customElement(\"ha-check-list-item\")\nexport class HaCheckListItem extends CheckListItemBase {\n  static override styles = [\n    styles,\n    controlStyles,\n    css`\n      :host {\n        --mdc-theme-secondary: var(--primary-color);\n      }\n    `,\n  ];\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"ha-check-list-item\": HaCheckListItem;\n  }\n}\n","import { CheckboxBase } from \"@material/mwc-checkbox/mwc-checkbox-base\";\nimport { styles } from \"@material/mwc-checkbox/mwc-checkbox.css\";\nimport { css } from \"lit\";\nimport { customElement } from \"lit/decorators\";\n\n@customElement(\"ha-checkbox\")\nexport class HaCheckbox extends CheckboxBase {\n  static override styles = [\n    styles,\n    css`\n      :host {\n        --mdc-theme-secondary: var(--primary-color);\n      }\n    `,\n  ];\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"ha-checkbox\": HaCheckbox;\n  }\n}\n","// @ts-ignore\nimport chipStyles from \"@material/chips/dist/mdc.chips.min.css\";\nimport {\n  css,\n  CSSResultGroup,\n  html,\n  LitElement,\n  TemplateResult,\n  unsafeCSS,\n} from \"lit\";\nimport { customElement, property } from \"lit/decorators\";\n\n@customElement(\"ha-chip\")\nexport class HaChip extends LitElement {\n  @property({ type: Boolean }) public hasIcon = false;\n\n  @property({ type: Boolean }) public hasTrailingIcon = false;\n\n  @property({ type: Boolean }) public noText = false;\n\n  protected render(): TemplateResult {\n    return html`\n      <div class=\"mdc-chip ${this.noText ? \"no-text\" : \"\"}\">\n        ${this.hasIcon\n          ? html`<div class=\"mdc-chip__icon mdc-chip__icon--leading\">\n              <slot name=\"icon\"></slot>\n            </div>`\n          : null}\n        <div class=\"mdc-chip__ripple\"></div>\n        <span role=\"gridcell\">\n          <span role=\"button\" tabindex=\"0\" class=\"mdc-chip__primary-action\">\n            <span class=\"mdc-chip__text\"><slot></slot></span>\n          </span>\n        </span>\n        ${this.hasTrailingIcon\n          ? html`<div class=\"mdc-chip__icon mdc-chip__icon--trailing\">\n              <slot name=\"trailing-icon\"></slot>\n            </div>`\n          : null}\n      </div>\n    `;\n  }\n\n  static get styles(): CSSResultGroup {\n    return css`\n      ${unsafeCSS(chipStyles)}\n      .mdc-chip {\n        background-color: var(\n          --ha-chip-background-color,\n          rgba(var(--rgb-primary-text-color), 0.15)\n        );\n        color: var(--ha-chip-text-color, var(--primary-text-color));\n      }\n\n      .mdc-chip.no-text {\n        padding: 0 10px;\n      }\n\n      .mdc-chip:hover {\n        color: var(--ha-chip-text-color, var(--primary-text-color));\n      }\n\n      .mdc-chip__icon--leading,\n      .mdc-chip__icon--trailing {\n        --mdc-icon-size: 18px;\n        line-height: 14px;\n        color: var(--ha-chip-icon-color, var(--ha-chip-text-color));\n      }\n      .mdc-chip.mdc-chip--selected .mdc-chip__checkmark,\n      .mdc-chip .mdc-chip__icon--leading:not(.mdc-chip__icon--leading-hidden) {\n        margin-right: -4px;\n        margin-inline-start: -4px;\n        margin-inline-end: 4px;\n        direction: var(--direction);\n      }\n\n      span[role=\"gridcell\"] {\n        line-height: 14px;\n      }\n    `;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"ha-chip\": HaChip;\n  }\n}\n","import { DialogBase } from \"@material/mwc-dialog/mwc-dialog-base\";\nimport { styles } from \"@material/mwc-dialog/mwc-dialog.css\";\nimport { mdiClose } from \"@mdi/js\";\nimport { css, html, TemplateResult } from \"lit\";\nimport { customElement } from \"lit/decorators\";\nimport type { HomeAssistant } from \"../types\";\nimport { FOCUS_TARGET } from \"../dialogs/make-dialog-manager\";\nimport \"./ha-icon-button\";\n\nexport const createCloseHeading = (\n  hass: HomeAssistant,\n  title: string | TemplateResult\n) => html`\n  <span class=\"header_title\">${title}</span>\n  <ha-icon-button\n    .label=${hass.localize(\"ui.dialogs.generic.close\")}\n    .path=${mdiClose}\n    dialogAction=\"close\"\n    class=\"header_button\"\n  ></ha-icon-button>\n`;\n\n@customElement(\"ha-dialog\")\nexport class HaDialog extends DialogBase {\n  protected readonly [FOCUS_TARGET];\n\n  public scrollToPos(x: number, y: number) {\n    this.contentElement?.scrollTo(x, y);\n  }\n\n  protected renderHeading() {\n    return html`<slot name=\"heading\"> ${super.renderHeading()} </slot>`;\n  }\n\n  static override styles = [\n    styles,\n    css`\n      .mdc-dialog {\n        --mdc-dialog-scroll-divider-color: var(--divider-color);\n        z-index: var(--dialog-z-index, 7);\n        -webkit-backdrop-filter: var(--dialog-backdrop-filter, none);\n        backdrop-filter: var(--dialog-backdrop-filter, none);\n      }\n      .mdc-dialog__actions {\n        justify-content: var(--justify-action-buttons, flex-end);\n        padding-bottom: max(env(safe-area-inset-bottom), 8px);\n      }\n      .mdc-dialog__actions span:nth-child(1) {\n        flex: var(--secondary-action-button-flex, unset);\n      }\n      .mdc-dialog__actions span:nth-child(2) {\n        flex: var(--primary-action-button-flex, unset);\n      }\n      .mdc-dialog__container {\n        align-items: var(--vertial-align-dialog, center);\n      }\n      .mdc-dialog__title::before {\n        display: block;\n        height: 20px;\n      }\n      .mdc-dialog .mdc-dialog__content {\n        position: var(--dialog-content-position, relative);\n        padding: var(--dialog-content-padding, 20px 24px);\n      }\n      :host([hideactions]) .mdc-dialog .mdc-dialog__content {\n        padding-bottom: max(\n          var(--dialog-content-padding, 20px),\n          env(safe-area-inset-bottom)\n        );\n      }\n      .mdc-dialog .mdc-dialog__surface {\n        position: var(--dialog-surface-position, relative);\n        top: var(--dialog-surface-top);\n        min-height: var(--mdc-dialog-min-height, auto);\n        border-radius: var(\n          --ha-dialog-border-radius,\n          var(--ha-card-border-radius, 4px)\n        );\n      }\n      :host([flexContent]) .mdc-dialog .mdc-dialog__content {\n        display: flex;\n        flex-direction: column;\n      }\n      .header_button {\n        position: absolute;\n        right: 16px;\n        top: 10px;\n        text-decoration: none;\n        color: inherit;\n      }\n      .header_title {\n        margin-right: 40px;\n        margin-inline-end: 40px;\n        margin-inline-start: initial;\n        direction: var(--direction);\n      }\n      .header_button {\n        inset-inline-start: initial;\n        inset-inline-end: 16px;\n        direction: var(--direction);\n      }\n      .dialog-actions {\n        inset-inline-start: initial !important;\n        inset-inline-end: 0px !important;\n        direction: var(--direction);\n      }\n    `,\n  ];\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"ha-dialog\": HaDialog;\n  }\n}\n","import { css, html, LitElement, TemplateResult } from \"lit\";\nimport { customElement } from \"lit/decorators\";\n\n@customElement(\"ha-input-helper-text\")\nclass InputHelperText extends LitElement {\n  protected render(): TemplateResult {\n    return html`<slot></slot>`;\n  }\n\n  static styles = css`\n    :host {\n      display: block;\n      color: var(--mdc-text-field-label-ink-color, rgba(0, 0, 0, 0.6));\n      font-size: 0.75rem;\n      padding-left: 16px;\n      padding-right: 16px;\n    }\n  `;\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"ha-input-helper-text\": InputHelperText;\n  }\n}\n","import \"@material/mwc-button\";\nimport { css, CSSResultGroup, html, LitElement, TemplateResult } from \"lit\";\nimport { customElement, property, state } from \"lit/decorators\";\nimport \"../../components/ha-circular-progress\";\nimport \"../../components/ha-dialog\";\nimport \"../../components/ha-form/ha-form\";\nimport \"../../components/ha-markdown\";\nimport {\n  DataEntryFlowStep,\n  DataEntryFlowStepForm,\n} from \"../../data/data_entry_flow\";\nimport { haStyleDialog } from \"../../resources/styles\";\nimport { HomeAssistant } from \"../../types\";\n\nlet instance = 0;\n\n@customElement(\"ha-mfa-module-setup-flow\")\nclass HaMfaModuleSetupFlow extends LitElement {\n  @property() public hass!: HomeAssistant;\n\n  @state() private _dialogClosedCallback?: (params: {\n    flowFinished: boolean;\n  }) => void;\n\n  @state() private _instance?: number;\n\n  @state() private _loading = false;\n\n  @state() private _opened = false;\n\n  @state() private _stepData: any = {};\n\n  @state() private _step?: DataEntryFlowStep;\n\n  @state() private _errorMessage?: string;\n\n  public showDialog({ continueFlowId, mfaModuleId, dialogClosedCallback }) {\n    this._instance = instance++;\n    this._dialogClosedCallback = dialogClosedCallback;\n    this._opened = true;\n\n    const fetchStep = continueFlowId\n      ? this.hass.callWS({\n          type: \"auth/setup_mfa\",\n          flow_id: continueFlowId,\n        })\n      : this.hass.callWS({\n          type: \"auth/setup_mfa\",\n          mfa_module_id: mfaModuleId,\n        });\n\n    const curInstance = this._instance;\n\n    fetchStep.then((step) => {\n      if (curInstance !== this._instance) return;\n\n      this._processStep(step);\n    });\n  }\n\n  public closeDialog() {\n    // Closed dialog by clicking on the overlay\n    if (this._step) {\n      this._flowDone();\n    }\n    this._opened = false;\n  }\n\n  protected render(): TemplateResult {\n    if (!this._opened) {\n      return html``;\n    }\n    return html`\n      <ha-dialog\n        open\n        .heading=${this._computeStepTitle()}\n        @closed=${this.closeDialog}\n      >\n        <div>\n          ${this._errorMessage\n            ? html`<div class=\"error\">${this._errorMessage}</div>`\n            : \"\"}\n          ${!this._step\n            ? html`<div class=\"init-spinner\">\n                <ha-circular-progress active></ha-circular-progress>\n              </div>`\n            : html`${this._step.type === \"abort\"\n                ? html` <ha-markdown\n                    allowsvg\n                    breaks\n                    .content=${this.hass.localize(\n                      `component.auth.mfa_setup.${this._step.handler}.abort.${this._step.reason}`\n                    )}\n                  ></ha-markdown>`\n                : this._step.type === \"create_entry\"\n                ? html`<p>\n                    ${this.hass.localize(\n                      \"ui.panel.profile.mfa_setup.step_done\",\n                      \"step\",\n                      this._step.title\n                    )}\n                  </p>`\n                : this._step.type === \"form\"\n                ? html`<ha-markdown\n                      allowsvg\n                      breaks\n                      .content=${this.hass.localize(\n                        `component.auth.mfa_setup.${this._step!.handler}.step.${\n                          (this._step! as DataEntryFlowStepForm).step_id\n                        }.description`,\n                        this._step!.description_placeholders\n                      )}\n                    ></ha-markdown>\n                    <ha-form\n                      .hass=${this.hass}\n                      .data=${this._stepData}\n                      .schema=${this._step.data_schema}\n                      .error=${this._step.errors}\n                      .computeLabel=${this._computeLabel}\n                      .computeError=${this._computeError}\n                      @value-changed=${this._stepDataChanged}\n                    ></ha-form>`\n                : \"\"}`}\n        </div>\n        ${[\"abort\", \"create_entry\"].includes(this._step?.type || \"\")\n          ? html`<mwc-button slot=\"primaryAction\" @click=${this.closeDialog}\n              >${this.hass.localize(\n                \"ui.panel.profile.mfa_setup.close\"\n              )}</mwc-button\n            >`\n          : \"\"}\n        ${this._step?.type === \"form\"\n          ? html`<mwc-button\n              slot=\"primaryAction\"\n              .disabled=${this._loading}\n              @click=${this._submitStep}\n              >${this.hass.localize(\n                \"ui.panel.profile.mfa_setup.submit\"\n              )}</mwc-button\n            >`\n          : \"\"}\n      </ha-dialog>\n    `;\n  }\n\n  static get styles(): CSSResultGroup {\n    return [\n      haStyleDialog,\n      css`\n        .error {\n          color: red;\n        }\n        ha-dialog {\n          max-width: 500px;\n        }\n        ha-markdown {\n          --markdown-svg-background-color: white;\n          --markdown-svg-color: black;\n          display: block;\n          margin: 0 auto;\n        }\n        ha-markdown a {\n          color: var(--primary-color);\n        }\n        .init-spinner {\n          padding: 10px 100px 34px;\n          text-align: center;\n        }\n        .submit-spinner {\n          margin-right: 16px;\n        }\n      `,\n    ];\n  }\n\n  protected firstUpdated(changedProperties) {\n    super.firstUpdated(changedProperties);\n    this.hass.loadBackendTranslation(\"mfa_setup\", \"auth\");\n    this.addEventListener(\"keypress\", (ev) => {\n      if (ev.key === \"Enter\") {\n        this._submitStep();\n      }\n    });\n  }\n\n  private _stepDataChanged(ev: CustomEvent) {\n    this._stepData = ev.detail.value;\n  }\n\n  private _submitStep() {\n    this._loading = true;\n    this._errorMessage = undefined;\n\n    const curInstance = this._instance;\n\n    this.hass\n      .callWS({\n        type: \"auth/setup_mfa\",\n        flow_id: this._step!.flow_id,\n        user_input: this._stepData,\n      })\n      .then(\n        (step) => {\n          if (curInstance !== this._instance) {\n            return;\n          }\n\n          this._processStep(step);\n          this._loading = false;\n        },\n        (err) => {\n          this._errorMessage =\n            (err && err.body && err.body.message) || \"Unknown error occurred\";\n          this._loading = false;\n        }\n      );\n  }\n\n  private _processStep(step) {\n    if (!step.errors) step.errors = {};\n    this._step = step;\n    // We got a new form if there are no errors.\n    if (Object.keys(step.errors).length === 0) {\n      this._stepData = {};\n    }\n  }\n\n  private _flowDone() {\n    const flowFinished = Boolean(\n      this._step && [\"create_entry\", \"abort\"].includes(this._step.type)\n    );\n\n    this._dialogClosedCallback!({\n      flowFinished,\n    });\n\n    this._errorMessage = undefined;\n    this._step = undefined;\n    this._stepData = {};\n    this._dialogClosedCallback = undefined;\n    this.closeDialog();\n  }\n\n  private _computeStepTitle() {\n    return this._step?.type === \"abort\"\n      ? this.hass.localize(\"ui.panel.profile.mfa_setup.title_aborted\")\n      : this._step?.type === \"create_entry\"\n      ? this.hass.localize(\"ui.panel.profile.mfa_setup.title_success\")\n      : this._step?.type === \"form\"\n      ? this.hass.localize(\n          `component.auth.mfa_setup.${this._step.handler}.step.${this._step.step_id}.title`\n        )\n      : \"\";\n  }\n\n  private _computeLabel = (schema) =>\n    this.hass.localize(\n      `component.auth.mfa_setup.${this._step!.handler}.step.${\n        (this._step! as DataEntryFlowStepForm).step_id\n      }.data.${schema.name}`\n    ) || schema.name;\n\n  private _computeError = (error) =>\n    this.hass.localize(\n      `component.auth.mfa_setup.${this._step!.handler}.error.${error}`\n    ) || error;\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"ha-mfa-module-setup-flow\": HaMfaModuleSetupFlow;\n  }\n}\n"],"names":[],"sourceRoot":""}