{"version":3,"file":"3948e197.js","mappings":";AAiEA;AAhCA;;AA+CA;AACA;;AAEA;AACA;AACA;AACA;AACA;AAGA;;;;;;AAMA;;AAIA;;;;;AAzBA","sources":["webpack://home-assistant-frontend/./src/panels/config/lovelace/resources/ha-config-lovelace-resources.ts"],"sourcesContent":["import { mdiPlus } from \"@mdi/js\";\nimport \"@polymer/paper-dropdown-menu/paper-dropdown-menu\";\nimport \"@polymer/paper-item/paper-icon-item\";\nimport \"@polymer/paper-listbox/paper-listbox\";\nimport { html, LitElement, PropertyValues, TemplateResult } from \"lit\";\nimport { customElement, property, state } from \"lit/decorators\";\nimport memoize from \"memoize-one\";\nimport { stringCompare } from \"../../../../common/string/compare\";\nimport {\n  DataTableColumnContainer,\n  RowClickedEvent,\n} from \"../../../../components/data-table/ha-data-table\";\nimport \"../../../../components/ha-fab\";\nimport \"../../../../components/ha-svg-icon\";\nimport {\n  createResource,\n  deleteResource,\n  fetchResources,\n  LovelaceResource,\n  updateResource,\n} from \"../../../../data/lovelace\";\nimport {\n  showAlertDialog,\n  showConfirmationDialog,\n} from \"../../../../dialogs/generic/show-dialog-box\";\nimport \"../../../../layouts/hass-loading-screen\";\nimport \"../../../../layouts/hass-tabs-subpage-data-table\";\nimport { HomeAssistant, Route } from \"../../../../types\";\nimport { loadLovelaceResources } from \"../../../lovelace/common/load-resources\";\nimport { lovelaceTabs } from \"../ha-config-lovelace\";\nimport { showResourceDetailDialog } from \"./show-dialog-lovelace-resource-detail\";\n\n@customElement(\"ha-config-lovelace-resources\")\nexport class HaConfigLovelaceRescources extends LitElement {\n  @property({ attribute: false }) public hass!: HomeAssistant;\n\n  @property() public isWide!: boolean;\n\n  @property() public narrow!: boolean;\n\n  @property() public route!: Route;\n\n  @state() private _resources: LovelaceResource[] = [];\n\n  private _columns = memoize(\n    (_language): DataTableColumnContainer => ({\n      url: {\n        title: this.hass.localize(\n          \"ui.panel.config.lovelace.resources.picker.headers.url\"\n        ),\n        sortable: true,\n        filterable: true,\n        direction: \"asc\",\n        grows: true,\n        forceLTR: true,\n      },\n      type: {\n        title: this.hass.localize(\n          \"ui.panel.config.lovelace.resources.picker.headers.type\"\n        ),\n        sortable: true,\n        filterable: true,\n        width: \"30%\",\n        template: (type) =>\n          html`\n            ${this.hass.localize(\n              `ui.panel.config.lovelace.resources.types.${type}`\n            ) || type}\n          `,\n      },\n    })\n  );\n\n  protected render(): TemplateResult {\n    if (!this.hass || this._resources === undefined) {\n      return html` <hass-loading-screen></hass-loading-screen> `;\n    }\n\n    return html`\n      <hass-tabs-subpage-data-table\n        .hass=${this.hass}\n        .narrow=${this.narrow}\n        back-path=\"/config\"\n        .route=${this.route}\n        .tabs=${lovelaceTabs}\n        .columns=${this._columns(this.hass.language)}\n        .data=${this._resources}\n        .noDataText=${this.hass.localize(\n          \"ui.panel.config.lovelace.resources.picker.no_resources\"\n        )}\n        @row-click=${this._editResource}\n        hasFab\n        clickable\n      >\n        <ha-fab\n          slot=\"fab\"\n          .label=${this.hass.localize(\n            \"ui.panel.config.lovelace.resources.picker.add_resource\"\n          )}\n          extended\n          @click=${this._addResource}\n        >\n          <ha-svg-icon slot=\"icon\" .path=${mdiPlus}></ha-svg-icon>\n        </ha-fab>\n      </hass-tabs-subpage-data-table>\n    `;\n  }\n\n  protected firstUpdated(changedProps: PropertyValues) {\n    super.firstUpdated(changedProps);\n    this._getResources();\n  }\n\n  private async _getResources() {\n    this._resources = await fetchResources(this.hass.connection);\n  }\n\n  private _editResource(ev: CustomEvent) {\n    if ((this.hass.panels.lovelace?.config as any)?.mode !== \"storage\") {\n      showAlertDialog(this, {\n        text: this.hass!.localize(\n          \"ui.panel.config.lovelace.resources.cant_edit_yaml\"\n        ),\n      });\n      return;\n    }\n    const id = (ev.detail as RowClickedEvent).id;\n    const resource = this._resources.find((res) => res.id === id);\n    this._openDialog(resource);\n  }\n\n  private _addResource() {\n    if ((this.hass.panels.lovelace?.config as any)?.mode !== \"storage\") {\n      showAlertDialog(this, {\n        text: this.hass!.localize(\n          \"ui.panel.config.lovelace.resources.cant_edit_yaml\"\n        ),\n      });\n      return;\n    }\n    this._openDialog();\n  }\n\n  private async _openDialog(resource?: LovelaceResource): Promise<void> {\n    showResourceDetailDialog(this, {\n      resource,\n      createResource: async (values) => {\n        const created = await createResource(this.hass!, values);\n        this._resources = this._resources!.concat(created).sort((res1, res2) =>\n          stringCompare(res1.url, res2.url)\n        );\n        loadLovelaceResources([created], this.hass!.auth.data.hassUrl);\n      },\n      updateResource: async (values) => {\n        const updated = await updateResource(this.hass!, resource!.id, values);\n        this._resources = this._resources!.map((res) =>\n          res === resource ? updated : res\n        );\n        loadLovelaceResources([updated], this.hass!.auth.data.hassUrl);\n      },\n      removeResource: async () => {\n        if (\n          !(await showConfirmationDialog(this, {\n            text: this.hass!.localize(\n              \"ui.panel.config.lovelace.resources.confirm_delete\"\n            ),\n          }))\n        ) {\n          return false;\n        }\n\n        try {\n          await deleteResource(this.hass!, resource!.id);\n          this._resources = this._resources!.filter((res) => res !== resource);\n          showConfirmationDialog(this, {\n            title: this.hass!.localize(\n              \"ui.panel.config.lovelace.resources.refresh_header\"\n            ),\n            text: this.hass!.localize(\n              \"ui.panel.config.lovelace.resources.refresh_body\"\n            ),\n            confirmText: this.hass.localize(\"ui.common.refresh\"),\n            dismissText: this.hass.localize(\"ui.common.not_now\"),\n            confirm: () => location.reload(),\n          });\n          return true;\n        } catch (err: any) {\n          return false;\n        }\n      },\n    });\n  }\n}\n"],"names":[],"sourceRoot":""}