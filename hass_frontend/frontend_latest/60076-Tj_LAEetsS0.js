export const id=60076;export const ids=[60076];export const modules={30443:(t,e,i)=>{i.d(e,{Z:()=>n});var s=i(59429),o=i(23682);function n(t,e){(0,o.Z)(2,arguments);var i=(0,s.Z)(t),n=(0,s.Z)(e);return i.getTime()===n.getTime()}},53970:(t,e,i)=>{i.d(e,{Z:()=>n});var s=i(30443),o=i(23682);function n(t){return(0,o.Z)(1,arguments),(0,s.Z)(t,Date.now())}},73589:(t,e,i)=>{i.d(e,{Z:()=>o});const s=t=>{const e=parseFloat(t);if(isNaN(e))throw new Error(`${t} is not a number`);return e};function o(t){if(!t)return null;try{if(t.endsWith("%"))return{w:100,h:s(t.substr(0,t.length-1))};const e=t.replace(":","x").split("x");return 0===e.length?null:1===e.length?{w:s(e[0]),h:1}:{w:s(e[0]),h:s(e[1])}}catch(t){}return null}},58763:(t,e,i)=>{i.a(t,(async(t,s)=>{try{i.d(e,{Nu:()=>p,Vk:()=>d,xS:()=>f});var o=i(58831),n=i(29171),r=i(91741),a=t([n]);n=(a.then?(await a)():a)[0];const c=["climate","humidifier","water_heater"],h=["climate","humidifier","input_datetime","thermostat","water_heater","person","device_tracker"],u=["temperature","current_temperature","target_temp_low","target_temp_high","hvac_action","humidity","mode","action","current_humidity"],l=(t,e)=>!t.states[e]||h.includes((0,o.M)(e)),d=(t,e,i,s,o)=>{const n={type:"history/stream",entity_ids:o,start_time:i.toISOString(),end_time:s.toISOString(),minimal_response:!0,no_attributes:!o.some((e=>l(t,e)))},r=new _(t);return t.connection.subscribeMessage((t=>e(r.processMessage(t))),n)};class _{constructor(t,e){this.hass=void 0,this.hoursToShow=void 0,this.combinedHistory=void 0,this.hass=t,this.hoursToShow=e,this.combinedHistory={}}processMessage(t){if(!this.combinedHistory||!Object.keys(this.combinedHistory).length)return this.combinedHistory=t.states,this.combinedHistory;if(!Object.keys(t.states).length)return this.combinedHistory;const e=this.hoursToShow?((new Date).getTime()-3600*this.hoursToShow*1e3)/1e3:void 0,i={};for(const t of Object.keys(this.combinedHistory))i[t]=[];for(const e of Object.keys(t.states))i[e]=[];for(const s of Object.keys(i)){if(s in this.combinedHistory&&s in t.states){const e=this.combinedHistory[s],o=e[e.length-1];i[s]=e.concat(t.states[s]),t.states[s][0].lu<o.lu&&(i[s]=i[s].sort(((t,e)=>t.lu-e.lu)))}else s in this.combinedHistory?i[s]=this.combinedHistory[s]:i[s]=t.states[s];if(e&&s in this.combinedHistory){const t=i[s].filter((t=>t.lu<e));if(!t.length)continue;if(i[s]=i[s].filter((t=>t.lu>=e)),i[s].length&&i[s][0].lu===e)continue;const o=t[t.length-1];o.lu=e,i[s].unshift(o)}}return this.combinedHistory=i,this.combinedHistory}}const f=(t,e,i,s,o=!0,n=!0,r)=>{const a={type:"history/stream",entity_ids:s,start_time:new Date((new Date).getTime()-3600*i*1e3).toISOString(),minimal_response:o,significant_changes_only:n,no_attributes:null!=r?r:!s.some((e=>l(t,e)))},c=new _(t,i);return t.connection.subscribeMessage((t=>e(c.processMessage(t))),a)},m=(t,e)=>t.state===e.state&&(!t.attributes||!e.attributes||u.every((i=>t.attributes[i]===e.attributes[i]))),g=(t,e,i,s,o,a,c)=>{const h=[],u=a[0];for(const r of a){if(h.length>0&&r.s===h[h.length-1].state)continue;const a={};null!=c&&c.attributes.device_class&&(a.device_class=null==c?void 0:c.attributes.device_class),h.push({state_localize:(0,n.c)(t,e,i,s[o],o,{...r.a||u.a,...a},r.s),state:r.s,last_changed:1e3*(r.lc?r.lc:r.lu)})}return{name:(0,r.a)(o,(null==c?void 0:c.attributes)||u.a),entity_id:o,data:h}},y=(t,e,i)=>{const s=[];return Object.keys(e).forEach((t=>{const n=e[t],a=n[0],h=(0,o.M)(t),l=[];for(const t of n){let e;if(c.includes(h)){e={state:t.s,last_changed:1e3*t.lu,attributes:{}};for(const i of u)i in t.a&&(e.attributes[i]=t.a[i])}else e={state:t.s,last_changed:1e3*(t.lc?t.lc:t.lu),attributes:{}};l.length>1&&m(e,l[l.length-1])&&m(e,l[l.length-2])||l.push(e)}const d=t in i?i[t].attributes:"friendly_name"in a.a?a.a:void 0;s.push({domain:h,name:(0,r.a)(t,d||{}),entity_id:t,states:l})})),{unit:t,identifier:Object.keys(e).join(""),data:s}},b=t=>v(t.attributes),v=t=>"unit_of_measurement"in t||"state_class"in t,p=(t,e,i)=>{const s={},n=[];if(!e)return{line:[],timeline:[]};Object.keys(e).forEach((r=>{const a=e[r];if(0===a.length)return;const c=r in t.states?t.states[r]:void 0,h=!c&&a.find((t=>t.a&&v(t.a)));let u;u=c&&b(c)?c.attributes.unit_of_measurement||" ":h?h.a.unit_of_measurement||" ":{zone:i("ui.dialogs.more_info_control.zone.graph_unit"),climate:t.config.unit_system.temperature,counter:"#",humidifier:"%",input_number:"#",number:"#",water_heater:t.config.unit_system.temperature}[(0,o.M)(r)],u?u in s&&r in s[u]?s[u][r].push(...a):(u in s||(s[u]={}),s[u][r]=a):n.push(g(i,t.locale,t.config,t.entities,r,a,c))}));return{line:Object.keys(s).map((e=>y(e,s[e],t.states))),timeline:n}};s()}catch(t){s(t)}}))},60076:(t,e,i)=>{i.a(t,(async(t,s)=>{try{i.r(e),i.d(e,{DEFAULT_HOURS_TO_SHOW:()=>H,DEFAULT_ZOOM:()=>E});var o=i(17463),n=i(34541),r=i(47838),a=i(53970),c=i(68144),h=i(79932),u=i(14516),l=i(55070),d=i(7323),_=i(44583),f=i(49684),m=i(58831),g=i(73589),y=(i(22098),i(9381),i(10983),i(13786),i(58763)),b=i(53658),v=i(15688),p=i(90271),k=t([_,f,y]);[_,f,y]=k.then?(await k)():k;const w="M12,9A3,3 0 0,0 9,12A3,3 0 0,0 12,15A3,3 0 0,0 15,12A3,3 0 0,0 12,9M19,19H15V21H19A2,2 0 0,0 21,19V15H19M19,3H15V5H19V9H21V5A2,2 0 0,0 19,3M5,5H9V3H5A2,2 0 0,0 3,5V9H5M5,15H3V19A2,2 0 0,0 5,21H9V19H5V15Z",H=0,E=14;(0,o.Z)([(0,h.Mo)("hui-map-card")],(function(t,e){class s extends e{constructor(...e){super(...e),t(this)}}return{F:s,d:[{kind:"field",decorators:[(0,h.Cb)({attribute:!1})],key:"hass",value:void 0},{kind:"field",decorators:[(0,h.Cb)({type:Boolean,reflect:!0})],key:"isPanel",value:()=>!1},{kind:"field",decorators:[(0,h.SB)()],key:"_stateHistory",value:void 0},{kind:"field",decorators:[(0,h.SB)()],key:"_config",value:void 0},{kind:"field",decorators:[(0,h.IO)("ha-map")],key:"_map",value:void 0},{kind:"field",key:"_configEntities",value:void 0},{kind:"field",key:"_colorDict",value:()=>({})},{kind:"field",key:"_colorIndex",value:()=>0},{kind:"field",decorators:[(0,h.SB)()],key:"_error",value:void 0},{kind:"field",key:"_subscribed",value:void 0},{kind:"method",key:"setConfig",value:function(t){var e;if(!t)throw new Error("Error in card configuration.");if(!(null!==(e=t.entities)&&void 0!==e&&e.length||t.geo_location_sources))throw new Error("Either entities or geo_location_sources must be specified");if(t.entities&&!Array.isArray(t.entities))throw new Error("Entities need to be an array");if(t.geo_location_sources&&!Array.isArray(t.geo_location_sources))throw new Error("Parameter geo_location_sources needs to be an array");this._config=t,this._configEntities=(t.entities?(0,p.A)(t.entities):[]).map((t=>t.entity))}},{kind:"method",key:"getCardSize",value:function(){var t;if(null===(t=this._config)||void 0===t||!t.aspect_ratio)return 7;const e=(0,g.Z)(this._config.aspect_ratio),i=e&&e.w>0&&e.h>0?`${(100*e.h/e.w).toFixed(2)}`:"100";return 1+Math.floor(Number(i)/25)||3}},{kind:"method",static:!0,key:"getConfigElement",value:async function(){return await Promise.all([i.e(46992),i.e(42850),i.e(97487),i.e(40163),i.e(74535),i.e(52092),i.e(50963)]).then(i.bind(i,51821)),document.createElement("hui-map-card-editor")}},{kind:"method",static:!0,key:"getStubConfig",value:function(t,e,i){return{type:"map",entities:(0,v.j)(t,2,e,i,["device_tracker"])}}},{kind:"method",key:"render",value:function(){var t;return this._config?this._error?c.dy`<ha-alert alert-type="error"> ${this.hass.localize("ui.components.map.error")}: ${this._error.message} (${this._error.code}) </ha-alert>`:c.dy` <ha-card id="card" .header="${this._config.title}"> <div id="root"> <ha-map .hass="${this.hass}" .entities="${this._getEntities(this.hass.states,this._config,this._configEntities)}" .zoom="${null!==(t=this._config.default_zoom)&&void 0!==t?t:E}" .paths="${this._getHistoryPaths(this._config,this._stateHistory)}" .autoFit="${this._config.auto_fit}" .darkMode="${this._config.dark_mode}" interactiveZones renderPassive></ha-map> <ha-icon-button .label="${this.hass.localize("ui.panel.lovelace.cards.map.reset_focus")}" .path="${w}" @click="${this._fitMap}" tabindex="0"></ha-icon-button> </div> </ha-card> `:c.Ld}},{kind:"method",key:"shouldUpdate",value:function(t){var e,i;if(!t.has("hass")||t.size>1)return!0;const s=t.get("hass");return!s||!this._configEntities||(s.themes.darkMode!==this.hass.themes.darkMode||(!!t.has("_stateHistory")||(!(null===(e=this._config)||void 0===e||!e.geo_location_sources||s.states===this.hass.states)||(null!==(i=this._config)&&void 0!==i&&i.entities?(0,b.Wh)(this,t):(0,b.SN)(this,t)))))}},{kind:"method",key:"connectedCallback",value:function(){var t;(0,n.Z)((0,r.Z)(s.prototype),"connectedCallback",this).call(this),this.hasUpdated&&null!==(t=this._configEntities)&&void 0!==t&&t.length&&this._subscribeHistory()}},{kind:"method",key:"disconnectedCallback",value:function(){(0,n.Z)((0,r.Z)(s.prototype),"disconnectedCallback",this).call(this),this._unsubscribeHistory()}},{kind:"method",key:"_subscribeHistory",value:function(){var t,e,i;(0,d.p)(this.hass,"history")&&!this._subscribed&&(null!==(t=null===(e=this._config)||void 0===e?void 0:e.hours_to_show)&&void 0!==t?t:H)&&(this._subscribed=(0,y.xS)(this.hass,(t=>{this._subscribed&&(this._stateHistory=t)}),null!==(i=this._config.hours_to_show)&&void 0!==i?i:H,this._configEntities,!1,!1,!1).catch((t=>{this._subscribed=void 0,this._error=t})))}},{kind:"method",key:"_unsubscribeHistory",value:function(){this._subscribed&&(this._subscribed.then((t=>null==t?void 0:t())),this._subscribed=void 0)}},{kind:"method",key:"updated",value:function(t){var e;null!==(e=this._configEntities)&&void 0!==e&&e.length?this._subscribed&&!t.has("_config")||(this._unsubscribeHistory(),this._subscribeHistory()):this._unsubscribeHistory(),t.has("_config")&&this._computePadding()}},{kind:"method",key:"_computePadding",value:function(){const t=this.shadowRoot.getElementById("root");if(!this._config||this.isPanel||!t)return;if(!this._config.aspect_ratio)return void(t.style.paddingBottom="100%");t.style.height="auto";const e=(0,g.Z)(this._config.aspect_ratio);t.style.paddingBottom=e&&e.w>0&&e.h>0?`${(100*e.h/e.w).toFixed(2)}%`:t.style.paddingBottom="100%"}},{kind:"method",key:"_fitMap",value:function(){var t;null===(t=this._map)||void 0===t||t.fitMap()}},{kind:"method",key:"_getColor",value:function(t){let e=this._colorDict[t];return e||(e=(0,l.Eu)(this._colorIndex),this._colorIndex++,this._colorDict[t]=e,e)}},{kind:"field",key:"_getEntities",value(){return(0,u.Z)(((t,e,i)=>{if(!t||!e)return;let s=i||[];if(e.geo_location_sources){const i=[],o=e.geo_location_sources.includes("all");for(const s of Object.values(t))"geo_location"===(0,m.M)(s.entity_id)&&(o||e.geo_location_sources.includes(s.attributes.source))&&i.push(s.entity_id);s=[...s,...i]}return s.map((t=>({entity_id:t,color:this._getColor(t)})))}))}},{kind:"field",key:"_getHistoryPaths",value(){return(0,u.Z)(((t,e)=>{var i;if(!e||!(null!==(i=t.hours_to_show)&&void 0!==i?i:H))return;const s=[];for(const i of Object.keys(e)){if("zone"===(0,m.M)(i))continue;const n=e[i];if(null==n||!n.length)continue;const r=[];for(const e of n){var o;const i=e.a.latitude,s=e.a.longitude;if(!i||!s)continue;const n={};n.point=[i,s];const c=new Date(1e3*e.lu);(null!==(o=t.hours_to_show)&&void 0!==o?o:H)>144?n.tooltip=(0,_.o0)(c,this.hass.locale,this.hass.config):(0,a.Z)(c)?n.tooltip=(0,f.Vu)(c,this.hass.locale,this.hass.config):n.tooltip=(0,f.xO)(c,this.hass.locale,this.hass.config),r.push(n)}s.push({points:r,color:this._getColor(i),gradualOpacity:.8})}return s}))}},{kind:"get",static:!0,key:"styles",value:function(){return c.iv`ha-card{overflow:hidden;width:100%;height:100%;display:flex;flex-direction:column}ha-map{z-index:0;border:none;position:absolute;top:0;left:0;width:100%;height:100%;background:inherit}ha-icon-button{position:absolute;top:75px;left:3px;outline:0}#root{position:relative;height:100%}`}}]}}),c.oi);s()}catch(t){s(t)}}))}};
//# sourceMappingURL=60076-Tj_LAEetsS0.js.map