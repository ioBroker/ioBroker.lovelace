"use strict";(self.webpackChunkhome_assistant_frontend=self.webpackChunkhome_assistant_frontend||[]).push([["85745"],{50875:function(e,t,a){a.d(t,{Eu:()=>r,hZ:()=>o,o9:()=>c});var s=a(27486),n=a(11259);const i=["#4269d0","#f4bd4a","#ff725c","#6cc5b0","#a463f2","#ff8ab7","#9c6b4e","#97bbf5","#01ab63","#9498a0","#094bad","#c99000","#d84f3e","#49a28f","#048732","#d96895","#8043ce","#7599d1","#7a4c31","#74787f","#6989f4","#ffd444","#ff957c","#8fe9d3","#62cc71","#ffadda","#c884ff","#badeff","#bf8b6d","#b6bac2","#927acc","#97ee3f","#bf3947","#9f5b00","#f48758","#8caed6","#f2b94f","#eff26e","#e43872","#d9b100","#9d7a00","#698cff","#d9d9d9","#00d27e","#d06800","#009f82","#c49200","#cbe8ff","#fecddf","#c27eb6","#8cd2ce","#c4b8d9","#f883b0","#a49100","#f48800","#27d0df","#a04a9b"];function r(e){return i[e%i.length]}function o(e,t){const a=t.getPropertyValue(`--graph-color-${e+1}`)||r(e);return(0,n.Rq)(a)}const c=(0,s.Z)((e=>i.map(((t,a)=>o(a,e)))),((e,t)=>e[0].getPropertyValue("--graph-color-1")===t[0].getPropertyValue("--graph-color-1")))},6736:function(e,t,a){a.d(t,{f:()=>r});var s=a(61701),n=a(72621),i=(a(19083),a(71695),a(9359),a(52924),a(40251),a(61006),a(47021),a(50778));const r=e=>(0,s.Z)(null,(function(e,t){class a extends t{constructor(...t){super(...t),e(this)}}return{F:a,d:[{kind:"field",decorators:[(0,i.Cb)({attribute:!1})],key:"hass",value:void 0},{kind:"field",key:"hassSubscribeRequiredHostProps",value:void 0},{kind:"field",key:"__unsubs",value:void 0},{kind:"method",key:"connectedCallback",value:function(){(0,n.Z)(a,"connectedCallback",this,3)([]),this._checkSubscribed()}},{kind:"method",key:"disconnectedCallback",value:function(){if((0,n.Z)(a,"disconnectedCallback",this,3)([]),this.__unsubs){for(;this.__unsubs.length;){const e=this.__unsubs.pop();e instanceof Promise?e.then((e=>e())):e()}this.__unsubs=void 0}}},{kind:"method",key:"updated",value:function(e){if((0,n.Z)(a,"updated",this,3)([e]),e.has("hass"))this._checkSubscribed();else if(this.hassSubscribeRequiredHostProps)for(const t of e.keys())if(this.hassSubscribeRequiredHostProps.includes(t))return void this._checkSubscribed()}},{kind:"method",key:"hassSubscribe",value:function(){return[]}},{kind:"method",key:"_checkSubscribed",value:function(){var e;void 0!==this.__unsubs||!this.isConnected||void 0===this.hass||null!==(e=this.hassSubscribeRequiredHostProps)&&void 0!==e&&e.some((e=>void 0===this[e]))||(this.__unsubs=this.hassSubscribe())}}]}}),e)},20548:function(e,t,a){a.d(t,{H:()=>i});a(81804);var s=a(11259),n=a(4643);function i(e,t,a,i,r,o){const c=e.getPropertyValue(r+"-"+o).trim(),d=c.length>0?c:e.getPropertyValue(r).trim();let l=(0,s.Rq)(d);return 0===c.length&&o&&(l=(0,s.CO)((0,s.p3)(t?(0,n.C)((0,s.Rw)((0,s.wK)(l)),o):(0,n.W)((0,s.Rw)((0,s.wK)(l)),o)))),i?l+=a?"32":"7F":a&&(l+="7F"),l}},53259:function(e,t,a){a.a(e,(async function(e,s){try{a.d(t,{J:()=>k,MC:()=>m,Zx:()=>$,b4:()=>_,kT:()=>C});a(28457),a(71695),a(92745),a(61893),a(5509),a(9359),a(56475),a(31526),a(70104),a(19423),a(92519),a(42179),a(89256),a(24931),a(88463),a(57449),a(19814),a(88044),a(47021);var n=a(21893),i=a(13809),r=a(38836),o=a(84775),c=a(80951),d=a(13730),l=a(6542),u=a(83204),h=a(23459),f=a(23711),b=a(50602),v=a(46467),p=a(33570),g=e([v,p,b]);function m(e,t){let a=new Date(t);return e>2&&0===a.getHours()&&(a=(0,n.b)(a,1)),a.setMinutes(0,0,0),e>35&&a.setDate(1),e>2&&a.setHours(0),a.getTime()}function _(e){return e>35?"month":e>2?"day":"hour"}function k(e,t,a,s,n,r,o,c){const d=(0,i.j)(t,e),l=void 0!==r&&void 0!==o;return{xAxis:{type:"time",min:e,max:m(d,t)},yAxis:{type:"value",name:n,nameGap:2,nameTextStyle:{align:"left"},axisLabel:{formatter:e=>(0,b.uf)(Math.abs(e),a)},splitLine:{show:!0}},grid:{top:15,bottom:0,left:1,right:1,containLabel:!0},tooltip:{trigger:"axis",formatter:e=>{if(Array.isArray(e)){const t=[],i=[];return e.forEach((e=>{var a;null!==(a=e.seriesId)&&void 0!==a&&a.startsWith("compare-")?i.push(e):t.push(e)})),[t,i].map((e=>S(e,a,s,d,l,n,c))).filter(Boolean).join("<br><br>")}return S([e],a,s,d,l,n,c)}}}}function S(e,t,a,s,n,i,o){var c,d,l,u;if(null===(c=e[0])||void 0===c||!c.value)return"";const h=new Date(null!==(d=null===(l=e[0].value)||void 0===l?void 0:l[2])&&void 0!==d?d:null===(u=e[0].value)||void 0===u?void 0:u[0]);let f;f=s>89?`${(0,v.NC)(h,t,a)}`:s>0?`${(0,v.ud)(h,t,a)}`:`${n?`${(0,v.ud)(h,t,a)}: `:""}${(0,p.mr)(h,t,a)} â€“ ${(0,p.mr)((0,r.T)(h,1),t,a)}`;const g=`<h4 style="text-align: center; margin: 0;">${f}</h4>`;let y=0,m=0,_=0,k=0;const S=e.map((e=>{var a;const s=null===(a=e.value)||void 0===a?void 0:a[1],n=(0,b.uf)(s,t);return"0"!==n&&("bar"===e.componentSubType&&(s>0?(y+=s,m++):(_+=s,k++)),`${e.marker} ${e.seriesName}: ${n} ${i}`)})).filter(Boolean);let $="";return 0!==y&&m>1&&o&&($+=`<br><b>${o(y)}</b>`),0!==_&&k>1&&o&&($+=`<br><b>${o(_)}</b>`),S.length>0?`${g}${S.join("<br>")}${$}`:""}function $(e){Array.from(new Set(e.map((e=>e.data.map((e=>Number(e[0]))))).flat())).sort(((e,t)=>e-t)).forEach(((t,a)=>{const s={},n={};for(let u=e.length-1;u>=0;u--){var i,r,o,c,d;const h=e[u].data[a],f=h&&"object"==typeof h&&"value"in h?h:{value:h},b=null===(i=f.value)||void 0===i?void 0:i[0],v=null!==(r=e[u].stack)&&void 0!==r?r:"";var l;if(void 0!==b)if(Number(b)!==t)null===(l=e[u].data)||void 0===l||l.splice(a,0,{value:[t,0],itemStyle:{borderWidth:0}});else 0===(null===(o=f.value)||void 0===o?void 0:o[1])?e[u].data[a]=Object.assign(Object.assign({},f),{},{itemStyle:Object.assign(Object.assign({},f.itemStyle),{},{borderWidth:0})}):!s[v]&&(null===(c=f.value)||void 0===c?void 0:c[1])>0?(e[u].data[a]=Object.assign(Object.assign({},f),{},{itemStyle:Object.assign(Object.assign({},f.itemStyle),{},{borderRadius:[4,4,0,0]})}),s[v]=!0):!n[v]&&(null===(d=f.value)||void 0===d?void 0:d[1])<0&&(e[u].data[a]=Object.assign(Object.assign({},f),{},{itemStyle:Object.assign(Object.assign({},f.itemStyle),{},{borderRadius:[0,0,4,4]})}),n[v]=!0)}}))}function C(e,t){if(!t)return e=>e;const a=(0,o.o)(e,t);if(0!==a&&e.getTime()===(0,c.e)(e).getTime())return e=>(0,d.B)(e,a);const s=(0,l.d)(e,t);if(0!==s&&e.getTime()===(0,u.N)(e).getTime())return e=>(0,h.z)(e,s);const n=e.getTime()-t.getTime();return e=>(0,f.n)(e,n)}[v,p,b]=g.then?(await g)():g,s()}catch(y){s(y)}}))},63:function(e,t,a){a.a(e,(async function(e,s){try{a.r(t),a.d(t,{HuiEnergySolarGraphCard:()=>w});var n=a(61701),i=(a(71695),a(92745),a(9359),a(56475),a(31526),a(52924),a(40251),a(47021),a(42625)),r=a(83389),o=a(16444),c=a(13809),d=a(57243),l=a(50778),u=a(35359),h=a(27486),f=a(20548),b=a(50602),v=a(25179),p=(a(54977),a(1118)),g=a(17705),y=a(6736),m=a(93331),_=a(53259),k=e([v,b,p,_]);[v,b,p,_]=k.then?(await k)():k;let S,$,C,j,x=e=>e,w=(0,n.Z)([(0,l.Mo)("hui-energy-solar-graph-card")],(function(e,t){return{F:class extends t{constructor(...t){super(...t),e(this)}},d:[{kind:"field",decorators:[(0,l.Cb)({attribute:!1})],key:"hass",value:void 0},{kind:"field",decorators:[(0,l.SB)()],key:"_config",value:void 0},{kind:"field",decorators:[(0,l.SB)()],key:"_chartData",value(){return[]}},{kind:"field",decorators:[(0,l.SB)()],key:"_start",value(){return(0,i.I)()}},{kind:"field",decorators:[(0,l.SB)()],key:"_end",value(){return(0,r.p)()}},{kind:"field",decorators:[(0,l.SB)()],key:"_compareStart",value:void 0},{kind:"field",decorators:[(0,l.SB)()],key:"_compareEnd",value:void 0},{kind:"field",key:"hassSubscribeRequiredHostProps",value(){return["_config"]}},{kind:"method",key:"hassSubscribe",value:function(){var e;return[(0,p.UB)(this.hass,{key:null===(e=this._config)||void 0===e?void 0:e.collection_key}).subscribe((e=>this._getStatistics(e)))]}},{kind:"method",key:"getCardSize",value:function(){return 3}},{kind:"method",key:"setConfig",value:function(e){this._config=e}},{kind:"method",key:"shouldUpdate",value:function(e){return(0,m.SN)(this,e)||e.size>1||!e.has("hass")}},{kind:"method",key:"render",value:function(){return this.hass&&this._config?(0,d.dy)(S||(S=x` <ha-card> ${0} <div class="content ${0}"> <ha-chart-base .hass="${0}" .data="${0}" .options="${0}" chart-type="bar"></ha-chart-base> ${0} </div> </ha-card> `),this._config.title?(0,d.dy)($||($=x`<h1 class="card-header">${0}</h1>`),this._config.title):"",(0,u.$)({"has-header":!!this._config.title}),this.hass,this._chartData,this._createOptions(this._start,this._end,this.hass.locale,this.hass.config,this._compareStart,this._compareEnd),this._chartData.length?"":(0,d.dy)(C||(C=x`<div class="no-data"> ${0} </div>`),(0,o.z)(this._start)?this.hass.localize("ui.panel.lovelace.cards.energy.no_data"):this.hass.localize("ui.panel.lovelace.cards.energy.no_data_period"))):d.Ld}},{kind:"field",key:"_formatTotal",value(){return e=>this.hass.localize("ui.panel.lovelace.cards.energy.energy_solar_graph.total_produced",{num:(0,b.uf)(e,this.hass.locale)})}},{kind:"field",key:"_createOptions",value(){return(0,h.Z)(((e,t,a,s,n,i)=>(0,_.J)(e,t,a,s,"kWh",n,i,this._formatTotal)))}},{kind:"method",key:"_getStatistics",value:async function(e){this._start=e.start,this._end=e.end||(0,r.p)(),this._compareStart=e.startCompare,this._compareEnd=e.endCompare;const t=e.prefs.energy_sources.filter((e=>"solar"===e.type));let a;if(t.some((e=>{var t;return null===(t=e.config_entry_solar_forecast)||void 0===t?void 0:t.length})))try{a=await(0,p.jB)(this.hass)}catch(c){}const s=[],n=getComputedStyle(this);if(e.statsCompare)s.push(...this._processDataSet(e.statsCompare,e.statsMetadata,t,n,!0));else{var i,o;const e=null!==(i=null===(o=t[0])||void 0===o?void 0:o.stat_energy_from)&&void 0!==i?i:"placeholder";s.push({id:"compare-"+e,type:"bar",stack:"solar",data:[]})}s.push(...this._processDataSet(e.stats,e.statsMetadata,t,n)),(0,_.Zx)(s),a&&s.push(...this._processForecast(e.statsMetadata,a,t,n.getPropertyValue("--primary-text-color"),e.start,e.end)),this._chartData=s}},{kind:"method",key:"_processDataSet",value:function(e,t,a,s,n=!1){const i=[],r=(0,_.kT)(this._start,this._compareStart);return a.forEach(((a,o)=>{let c=null;const d=[];if(a.stat_energy_from in e){const t=e[a.stat_energy_from];for(const e of t){if(null===e.change||void 0===e.change||0===e.change)continue;if(c===e.start)continue;const t=[e.start,e.change];n&&(t[2]=t[0],t[0]=r(new Date(e.start))),d.push(t),c=e.start}}i.push({type:"bar",cursor:"default",id:n?"compare-"+a.stat_energy_from:a.stat_energy_from,name:this.hass.localize("ui.panel.lovelace.cards.energy.energy_solar_graph.production",{name:(0,g.Kd)(this.hass,a.stat_energy_from,t[a.stat_energy_from])}),barMaxWidth:50,itemStyle:{borderColor:(0,f.H)(s,this.hass.themes.darkMode,!1,n,"--energy-solar-color",o)},color:(0,f.H)(s,this.hass.themes.darkMode,!0,n,"--energy-solar-color",o),data:d,stack:n?"compare":"solar"})})),i}},{kind:"method",key:"_processForecast",value:function(e,t,a,s,n,i){const r=[],o=(0,c.j)(i||new Date,n);return a.forEach((a=>{if(a.config_entry_solar_forecast){const c={};if(a.config_entry_solar_forecast.forEach((e=>{t[e]&&Object.entries(t[e].wh_hours).forEach((([e,t])=>{const a=new Date(e);if(a<n||i&&a>i)return;o>35&&a.setDate(1),o>2?a.setHours(0,0,0,0):a.setMinutes(0,0,0);const s=a.getTime();s in c?c[s]+=t:c[s]=t}))})),c){const t=[];for(const[e,a]of Object.entries(c))t.push([Number(e),a/1e3]);t.length&&r.push({id:"forecast-"+a.stat_energy_from,type:"line",stack:"forecast",name:this.hass.localize("ui.panel.lovelace.cards.energy.energy_solar_graph.forecast",{name:(0,g.Kd)(this.hass,a.stat_energy_from,e[a.stat_energy_from])}),step:!1,color:s,lineStyle:{type:[7,5],width:1.5},symbol:"none",data:t})}}})),r}},{kind:"field",static:!0,key:"styles",value(){return(0,d.iv)(j||(j=x`ha-card{height:100%}.card-header{padding-bottom:0}.content{padding:16px}.has-header{padding-top:0}.no-data{position:absolute;height:100%;top:0;left:0;right:0;display:flex;justify-content:center;align-items:center;padding:20%;margin-left:32px;margin-inline-start:32px;margin-inline-end:initial;box-sizing:border-box}`))}}]}}),(0,y.f)(d.oi));s()}catch(S){s(S)}}))},41924:function(e,t,a){a.d(t,{y:()=>n});var s=a(53907);function n(e){return(0,s.L)(e,Date.now())}},97836:function(e,t,a){a.d(t,{K:()=>i});a(71695),a(47021);var s=a(18492),n=a(7591);function i(e,t,a){const[i,r]=(0,s.d)(null==a?void 0:a.in,e,t);return+(0,n.b)(i)==+(0,n.b)(r)}},16444:function(e,t,a){a.d(t,{z:()=>r});var s=a(53907),n=a(41924),i=a(97836);function r(e,t){return(0,i.K)((0,s.L)((null==t?void 0:t.in)||e,e),(0,n.y)((null==t?void 0:t.in)||e))}}}]);
//# sourceMappingURL=85745.7065b8fd0f397865.js.map