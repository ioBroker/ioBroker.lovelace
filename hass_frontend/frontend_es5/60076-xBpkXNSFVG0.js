"use strict";(self.webpackChunkhome_assistant_frontend=self.webpackChunkhome_assistant_frontend||[]).push([[60076],{30443:function(t,e,i){i.d(e,{Z:function(){return r}});var n=i(59429),o=i(23682);function r(t,e){(0,o.Z)(2,arguments);var i=(0,n.Z)(t),r=(0,n.Z)(e);return i.getTime()===r.getTime()}},53970:function(t,e,i){i.d(e,{Z:function(){return r}});var n=i(30443),o=i(23682);function r(t){return(0,o.Z)(1,arguments),(0,n.Z)(t,Date.now())}},73589:function(t,e,i){i.d(e,{Z:function(){return o}});var n=function(t){var e=parseFloat(t);if(isNaN(e))throw new Error("".concat(t," is not a number"));return e};function o(t){if(!t)return null;try{if(t.endsWith("%"))return{w:100,h:n(t.substr(0,t.length-1))};var e=t.replace(":","x").split("x");return 0===e.length?null:1===e.length?{w:n(e[0]),h:1}:{w:n(e[0]),h:n(e[1])}}catch(i){}return null}},58763:function(t,e,i){i.d(e,{Nu:function(){return b},Vk:function(){return _},xS:function(){return g}});var n=i(53709),o=i(40039),r=i(71650),s=i(33368),a=i(58831),u=i(41826),c=i(91741),l=["climate","humidifier","water_heater"],h=["climate","humidifier","input_datetime","thermostat","water_heater","person","device_tracker"],d=["temperature","current_temperature","target_temp_low","target_temp_high","hvac_action","humidity","mode","action","current_humidity"],f=function(t,e){return!t.states[e]||h.includes((0,a.M)(e))},_=function(t,e,i,n,o){var r={type:"history/stream",entity_ids:o,start_time:i.toISOString(),end_time:n.toISOString(),minimal_response:!0,no_attributes:!o.some((function(e){return f(t,e)}))},s=new v(t);return t.connection.subscribeMessage((function(t){return e(s.processMessage(t))}),r)},v=function(){function t(e,i){(0,r.Z)(this,t),this.hass=void 0,this.hoursToShow=void 0,this.combinedHistory=void 0,this.hass=e,this.hoursToShow=i,this.combinedHistory={}}return(0,s.Z)(t,[{key:"processMessage",value:function(t){if(!this.combinedHistory||!Object.keys(this.combinedHistory).length)return this.combinedHistory=t.states,this.combinedHistory;if(!Object.keys(t.states).length)return this.combinedHistory;for(var e=this.hoursToShow?((new Date).getTime()-3600*this.hoursToShow*1e3)/1e3:void 0,i={},n=0,o=Object.keys(this.combinedHistory);n<o.length;n++){i[o[n]]=[]}for(var r=0,s=Object.keys(t.states);r<s.length;r++){i[s[r]]=[]}for(var a=0,u=Object.keys(i);a<u.length;a++){var c=u[a];if(c in this.combinedHistory&&c in t.states){var l=this.combinedHistory[c],h=l[l.length-1];i[c]=l.concat(t.states[c]),t.states[c][0].lu<h.lu&&(i[c]=i[c].sort((function(t,e){return t.lu-e.lu})))}else c in this.combinedHistory?i[c]=this.combinedHistory[c]:i[c]=t.states[c];if(e&&c in this.combinedHistory){var d=i[c].filter((function(t){return t.lu<e}));if(!d.length)continue;if(i[c]=i[c].filter((function(t){return t.lu>=e})),i[c].length&&i[c][0].lu===e)continue;var f=d[d.length-1];f.lu=e,i[c].unshift(f)}}return this.combinedHistory=i,this.combinedHistory}}]),t}(),g=function(t,e,i,n){var o=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],r=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],s=arguments.length>6?arguments[6]:void 0,a={type:"history/stream",entity_ids:n,start_time:new Date((new Date).getTime()-3600*i*1e3).toISOString(),minimal_response:o,significant_changes_only:r,no_attributes:null!=s?s:!n.some((function(e){return f(t,e)}))},u=new v(t,i);return t.connection.subscribeMessage((function(t){return e(u.processMessage(t))}),a)},y=function(t,e){return t.state===e.state&&(!t.attributes||!e.attributes||d.every((function(i){return t.attributes[i]===e.attributes[i]})))},m=function(t){return"unit_of_measurement"in t||"state_class"in t},b=function(t,e,i){var r={},s=[];return e?(Object.keys(e).forEach((function(l){var h=e[l];if(0!==h.length){var d,f=l in t.states?t.states[l]:void 0,_=!f&&h.find((function(t){return t.a&&m(t.a)}));if(d=f&&m(f.attributes)?f.attributes.unit_of_measurement||" ":_?_.a.unit_of_measurement||" ":{zone:i("ui.dialogs.more_info_control.zone.graph_unit"),climate:t.config.unit_system.temperature,counter:"#",humidifier:"%",input_number:"#",number:"#",water_heater:t.config.unit_system.temperature}[(0,a.M)(l)])if(d in r&&l in r[d]){var v;(v=r[d][l]).push.apply(v,(0,n.Z)(h))}else d in r||(r[d]={}),r[d][l]=h;else s.push(function(t,e,i,n,r,s,a){var l,h=[],d=s[0],f=(0,o.Z)(s);try{for(f.s();!(l=f.n()).done;){var _=l.value;if(!(h.length>0&&_.s===h[h.length-1].state)){var v={};null!=a&&a.attributes.device_class&&(v.device_class=null==a?void 0:a.attributes.device_class),h.push({state_localize:(0,u.computeStateDisplayFromEntityAttributes)(t,e,i,n[r],r,Object.assign(Object.assign({},_.a||d.a),v),_.s),state:_.s,last_changed:1e3*(_.lc?_.lc:_.lu)})}}}catch(g){f.e(g)}finally{f.f()}return{name:(0,c.a)(r,(null==a?void 0:a.attributes)||d.a),entity_id:r,data:h}}(i,t.locale,t.config,t.entities,l,h,f))}})),{line:Object.keys(r).map((function(e){return function(t,e,i){var n=[];return Object.keys(e).forEach((function(t){var r,s=e[t],u=s[0],h=(0,a.M)(t),f=[],_=(0,o.Z)(s);try{for(_.s();!(r=_.n()).done;){var v=r.value,g=void 0;if(l.includes(h)){g={state:v.s,last_changed:1e3*v.lu,attributes:{}};for(var m=0,b=d;m<b.length;m++){var p=b[m];p in v.a&&(g.attributes[p]=v.a[p])}}else g={state:v.s,last_changed:1e3*(v.lc?v.lc:v.lu),attributes:{}};f.length>1&&y(g,f[f.length-1])&&y(g,f[f.length-2])||f.push(g)}}catch(w){_.e(w)}finally{_.f()}var k=t in i?i[t].attributes:"friendly_name"in u.a?u.a:void 0;n.push({domain:h,name:(0,c.a)(t,k||{}),entity_id:t,states:f})})),{unit:t,identifier:Object.keys(e).join(""),data:n}}(e,r[e],t.states)})),timeline:s}):{line:[],timeline:[]}}},60076:function(t,e,i){i.r(e),i.d(e,{DEFAULT_HOURS_TO_SHOW:function(){return V},DEFAULT_ZOOM:function(){return z}});var n,o,r,s=i(40039),a=i(53709),u=i(88962),c=i(99312),l=i(81043),h=i(33368),d=i(71650),f=i(82390),_=i(69205),v=i(70906),g=i(91808),y=i(34541),m=i(47838),b=i(53970),p=i(68144),k=i(79932),w=i(14516),H=i(55070),Z=i(7323),E=i(44583),M=i(49684),O=i(58831),S=i(73589),x=(i(22098),i(9381),i(10983),i(13786),i(58763)),A=i(53658),j=i(15688),C=i(90271),V=0,z=14;(0,g.Z)([(0,k.Mo)("hui-map-card")],(function(t,e){var g,D=function(e){(0,_.Z)(n,e);var i=(0,v.Z)(n);function n(){var e;(0,d.Z)(this,n);for(var o=arguments.length,r=new Array(o),s=0;s<o;s++)r[s]=arguments[s];return e=i.call.apply(i,[this].concat(r)),t((0,f.Z)(e)),e}return(0,h.Z)(n)}(e);return{F:D,d:[{kind:"field",decorators:[(0,k.Cb)({attribute:!1})],key:"hass",value:void 0},{kind:"field",decorators:[(0,k.Cb)({type:Boolean,reflect:!0})],key:"isPanel",value:function(){return!1}},{kind:"field",decorators:[(0,k.SB)()],key:"_stateHistory",value:void 0},{kind:"field",decorators:[(0,k.SB)()],key:"_config",value:void 0},{kind:"field",decorators:[(0,k.IO)("ha-map")],key:"_map",value:void 0},{kind:"field",key:"_configEntities",value:void 0},{kind:"field",key:"_colorDict",value:function(){return{}}},{kind:"field",key:"_colorIndex",value:function(){return 0}},{kind:"field",decorators:[(0,k.SB)()],key:"_error",value:void 0},{kind:"field",key:"_subscribed",value:void 0},{kind:"method",key:"setConfig",value:function(t){var e;if(!t)throw new Error("Error in card configuration.");if(!(null!==(e=t.entities)&&void 0!==e&&e.length||t.geo_location_sources))throw new Error("Either entities or geo_location_sources must be specified");if(t.entities&&!Array.isArray(t.entities))throw new Error("Entities need to be an array");if(t.geo_location_sources&&!Array.isArray(t.geo_location_sources))throw new Error("Parameter geo_location_sources needs to be an array");this._config=t,this._configEntities=(t.entities?(0,C.A)(t.entities):[]).map((function(t){return t.entity}))}},{kind:"method",key:"getCardSize",value:function(){var t;if(null===(t=this._config)||void 0===t||!t.aspect_ratio)return 7;var e=(0,S.Z)(this._config.aspect_ratio),i=e&&e.w>0&&e.h>0?"".concat((100*e.h/e.w).toFixed(2)):"100";return 1+Math.floor(Number(i)/25)||3}},{kind:"method",static:!0,key:"getConfigElement",value:(g=(0,l.Z)((0,c.Z)().mark((function t(){return(0,c.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Promise.all([i.e(46992),i.e(42850),i.e(79071),i.e(97487),i.e(40163),i.e(74535),i.e(52092),i.e(62065)]).then(i.bind(i,62065));case 2:return t.abrupt("return",document.createElement("hui-map-card-editor"));case 3:case"end":return t.stop()}}),t)}))),function(){return g.apply(this,arguments)})},{kind:"method",static:!0,key:"getStubConfig",value:function(t,e,i){return{type:"map",entities:(0,j.j)(t,2,e,i,["device_tracker"])}}},{kind:"method",key:"render",value:function(){var t;return this._config?this._error?(0,p.dy)(n||(n=(0,u.Z)(['<ha-alert alert-type="error"> ',": "," (",") </ha-alert>"])),this.hass.localize("ui.components.map.error"),this._error.message,this._error.code):(0,p.dy)(o||(o=(0,u.Z)([' <ha-card id="card" .header="','"> <div id="root"> <ha-map .hass="','" .entities="','" .zoom="','" .paths="','" .autoFit="','" .darkMode="','" interactiveZones renderPassive></ha-map> <ha-icon-button .label="','" .path="','" @click="','" tabindex="0"></ha-icon-button> </div> </ha-card> '])),this._config.title,this.hass,this._getEntities(this.hass.states,this._config,this._configEntities),null!==(t=this._config.default_zoom)&&void 0!==t?t:z,this._getHistoryPaths(this._config,this._stateHistory),this._config.auto_fit,this._config.dark_mode,this.hass.localize("ui.panel.lovelace.cards.map.reset_focus"),"M12,9A3,3 0 0,0 9,12A3,3 0 0,0 12,15A3,3 0 0,0 15,12A3,3 0 0,0 12,9M19,19H15V21H19A2,2 0 0,0 21,19V15H19M19,3H15V5H19V9H21V5A2,2 0 0,0 19,3M5,5H9V3H5A2,2 0 0,0 3,5V9H5M5,15H3V19A2,2 0 0,0 5,21H9V19H5V15Z",this._fitMap):p.Ld}},{kind:"method",key:"shouldUpdate",value:function(t){var e,i;if(!t.has("hass")||t.size>1)return!0;var n=t.get("hass");return!n||!this._configEntities||(n.themes.darkMode!==this.hass.themes.darkMode||(!!t.has("_stateHistory")||(!(null===(e=this._config)||void 0===e||!e.geo_location_sources||n.states===this.hass.states)||(null!==(i=this._config)&&void 0!==i&&i.entities?(0,A.Wh)(this,t):(0,A.SN)(this,t)))))}},{kind:"method",key:"connectedCallback",value:function(){var t;(0,y.Z)((0,m.Z)(D.prototype),"connectedCallback",this).call(this),this.hasUpdated&&null!==(t=this._configEntities)&&void 0!==t&&t.length&&this._subscribeHistory()}},{kind:"method",key:"disconnectedCallback",value:function(){(0,y.Z)((0,m.Z)(D.prototype),"disconnectedCallback",this).call(this),this._unsubscribeHistory()}},{kind:"method",key:"_subscribeHistory",value:function(){var t,e,i,n=this;(0,Z.p)(this.hass,"history")&&!this._subscribed&&(null!==(t=null===(e=this._config)||void 0===e?void 0:e.hours_to_show)&&void 0!==t?t:V)&&(this._subscribed=(0,x.xS)(this.hass,(function(t){n._subscribed&&(n._stateHistory=t)}),null!==(i=this._config.hours_to_show)&&void 0!==i?i:V,this._configEntities,!1,!1,!1).catch((function(t){n._subscribed=void 0,n._error=t})))}},{kind:"method",key:"_unsubscribeHistory",value:function(){this._subscribed&&(this._subscribed.then((function(t){return null==t?void 0:t()})),this._subscribed=void 0)}},{kind:"method",key:"updated",value:function(t){var e;null!==(e=this._configEntities)&&void 0!==e&&e.length?this._subscribed&&!t.has("_config")||(this._unsubscribeHistory(),this._subscribeHistory()):this._unsubscribeHistory(),t.has("_config")&&this._computePadding()}},{kind:"method",key:"_computePadding",value:function(){var t=this.shadowRoot.getElementById("root");if(this._config&&!this.isPanel&&t)if(this._config.aspect_ratio){t.style.height="auto";var e=(0,S.Z)(this._config.aspect_ratio);t.style.paddingBottom=e&&e.w>0&&e.h>0?"".concat((100*e.h/e.w).toFixed(2),"%"):t.style.paddingBottom="100%"}else t.style.paddingBottom="100%"}},{kind:"method",key:"_fitMap",value:function(){var t;null===(t=this._map)||void 0===t||t.fitMap()}},{kind:"method",key:"_getColor",value:function(t){var e=this._colorDict[t];return e||(e=(0,H.Eu)(this._colorIndex),this._colorIndex++,this._colorDict[t]=e,e)}},{kind:"field",key:"_getEntities",value:function(){var t=this;return(0,w.Z)((function(e,i,n){if(e&&i){var o=n||[];if(i.geo_location_sources){for(var r=[],s=i.geo_location_sources.includes("all"),u=0,c=Object.values(e);u<c.length;u++){var l=c[u];"geo_location"===(0,O.M)(l.entity_id)&&(s||i.geo_location_sources.includes(l.attributes.source))&&r.push(l.entity_id)}o=[].concat((0,a.Z)(o),r)}return o.map((function(e){return{entity_id:e,color:t._getColor(e)}}))}}))}},{kind:"field",key:"_getHistoryPaths",value:function(){var t=this;return(0,w.Z)((function(e,i){var n;if(i&&(null!==(n=e.hours_to_show)&&void 0!==n?n:V)){for(var o=[],r=0,a=Object.keys(i);r<a.length;r++){var u=a[r];if("zone"!==(0,O.M)(u)){var c=i[u];if(null!=c&&c.length){var l,h=[],d=(0,s.Z)(c);try{for(d.s();!(l=d.n()).done;){var f,_=l.value,v=_.a.latitude,g=_.a.longitude;if(v&&g){var y={};y.point=[v,g];var m=new Date(1e3*_.lu);(null!==(f=e.hours_to_show)&&void 0!==f?f:V)>144?y.tooltip=(0,E.o0)(m,t.hass.locale,t.hass.config):(0,b.Z)(m)?y.tooltip=(0,M.Vu)(m,t.hass.locale,t.hass.config):y.tooltip=(0,M.xO)(m,t.hass.locale,t.hass.config),h.push(y)}}}catch(p){d.e(p)}finally{d.f()}o.push({points:h,color:t._getColor(u),gradualOpacity:.8})}}}return o}}))}},{kind:"get",static:!0,key:"styles",value:function(){return(0,p.iv)(r||(r=(0,u.Z)(["ha-card{overflow:hidden;width:100%;height:100%;display:flex;flex-direction:column}ha-map{z-index:0;border:none;position:absolute;top:0;left:0;width:100%;height:100%;background:inherit}ha-icon-button{position:absolute;top:75px;left:3px;outline:0}#root{position:relative;height:100%}"])))}}]}}),p.oi)}}]);
//# sourceMappingURL=60076-xBpkXNSFVG0.js.map