"use strict";(self.webpackChunkhome_assistant_frontend=self.webpackChunkhome_assistant_frontend||[]).push([["72743"],{97674:function(e,t,n){n.a(e,(async function(e,o){try{n.d(t,{AH:()=>d,Ai:()=>p,Al:()=>h,vA:()=>m});var r=n(86319),s=n(3938),i=n(6542),a=n(23459),c=n(2621),_=n(14276),l=n(23711),f=n(35895),y=n(20382),u=e([f]);f=(u.then?(await u)():u)[0];const g=(e,t,n,o)=>{const r=n((0,f.zW)(e,t),o);return r instanceof Date?(0,f.Nm)(r,t):r},d=(e,t,n,o,r)=>n.time_zone===y.c_.server?g(e,o.time_zone,t,r):t(e,r),m=(e,t,n,o,r)=>n.time_zone===y.c_.server?g(e,o.time_zone,t,r):t(e,r),p=(e,t,n,o,r)=>m(e,n,o,r,o.time_zone===y.c_.server?(0,f.zW)(t,r.time_zone):t),h=(e,t,n,o,f)=>{let y,u;if(m(e,r.b,o,f)&&m(t,s.h,o,f)){const r=(p(t,e,i.d,o,f)+1)*(n?1:-1);y=d(e,a.z,o,f,r),u=d(d(t,a.z,o,f,r),c.V,o,f)}else{const r=(p(t,e,_._,o,f)+1)*(n?1:-1);y=d(e,l.n,o,f,r),u=d(t,l.n,o,f,r)}return{start:y,end:u}};o()}catch(g){o(g)}}))},47558:function(e,t,n){n.d(t,{v:()=>o});n(71695),n(92745),n(47021);const o=(e,t)=>{const n={};for(const o of e){const e=t(o);e in n?n[e].push(o):n[e]=[o]}return n}},75101:function(e,t,n){n.d(t,{$H:()=>o,DJ:()=>a,LZ:()=>s,Nn:()=>y,Ny:()=>u,Pk:()=>d,Q4:()=>i,RQ:()=>_,SO:()=>l,T0:()=>g,aR:()=>r,iJ:()=>f,pB:()=>c});n(71695),n(9359),n(56475),n(1331),n(19423),n(47021);const o=(e,t)=>e.callWS({type:"config_entries/subentries/list",entry_id:t}),r=(e,t,n)=>e.callWS({type:"config_entries/subentries/delete",entry_id:t,subentry_id:n}),s=99387==n.j?["migration_error","setup_error","setup_retry"]:null,i=99387==n.j?["not_loaded","loaded","setup_error","setup_retry"]:null,a=(e,t,n)=>{const o={type:"config_entries/subscribe"};return n&&n.type&&(o.type_filter=n.type),e.connection.subscribeMessage((e=>t(e)),o)},c=(e,t)=>{const n={};return t&&(t.type&&(n.type_filter=t.type),t.domain&&(n.domain=t.domain)),e.callWS(Object.assign({type:"config_entries/get"},n))},_=(e,t)=>e.callWS({type:"config_entries/get_single",entry_id:t}),l=(e,t,n)=>e.callWS(Object.assign({type:"config_entries/update",entry_id:t},n)),f=(e,t)=>e.callApi("DELETE",`config/config_entries/entry/${t}`),y=(e,t)=>e.callApi("POST",`config/config_entries/entry/${t}/reload`),u=(e,t)=>e.callWS({type:"config_entries/disable",entry_id:t,disabled_by:"user"}),g=(e,t)=>e.callWS({type:"config_entries/disable",entry_id:t,disabled_by:null}),d=(e,t)=>{if(!t)return e;const n=e.find((e=>e.entry_id===t));if(!n)return e;return[n,...e.filter((e=>e.entry_id!==t))]}},1118:function(e,t,n){n.a(e,(async function(e,o){try{n.d(t,{Bm:()=>S,Cj:()=>D,E4:()=>G,EH:()=>q,G9:()=>I,Jj:()=>L,KU:()=>W,P:()=>A,UB:()=>$,ZC:()=>O,_Z:()=>P,b:()=>R,gy:()=>H,iK:()=>E,jB:()=>K,kJ:()=>U,o1:()=>k,rl:()=>j,vE:()=>Q,xZ:()=>C,yH:()=>Z});n(52247),n(19083),n(71695),n(92745),n(9359),n(31526),n(70104),n(19423),n(40251),n(61006),n(88044),n(47021);var r=n(13809),s=n(86319),i=n(3938),a=n(23459),c=n(6542),_=n(32424),l=n(23711),f=n(7591),y=n(96500),u=n(38836),g=n(62212),d=n(27486),m=n(97674),p=n(33570),h=n(47558),b=n(75101),v=n(17705),w=e([p,m]);[p,m]=w.then?(await w)():w;const T=[],S=()=>({stat_energy_from:"",stat_cost:null,entity_energy_price:null,number_energy_price:null}),k=()=>({stat_energy_to:"",stat_compensation:null,entity_energy_price:null,number_energy_price:null}),E=()=>({type:"grid",flow_from:[],flow_to:[],cost_adjustment_day:0}),j=()=>({type:"solar",stat_energy_from:"",config_entry_solar_forecast:null}),A=()=>({type:"battery",stat_energy_from:"",stat_energy_to:""}),W=()=>({type:"gas",stat_energy_from:"",stat_cost:null,entity_energy_price:null,number_energy_price:null}),D=()=>({type:"water",stat_energy_from:"",stat_cost:null,entity_energy_price:null,number_energy_price:null}),C=e=>e.callWS({type:"energy/info"}),H=async e=>(await e.loadBackendTranslation("issues","energy"),e.callWS({type:"energy/validate"})),O=e=>e.callWS({type:"energy/get_prefs"}),P=async(e,t)=>{const n=e.callWS(Object.assign({type:"energy/save_prefs"},t));return J(e),n},z=async(e,t,n,o,r,s="hour")=>e.callWS({type:"energy/fossil_energy_consumption",start_time:t.toISOString(),end_time:null==r?void 0:r.toISOString(),energy_statistic_ids:n,co2_statistic_id:o,period:s}),L=e=>(0,h.v)(e.energy_sources,(e=>e.type)),Z=(e,t,n)=>{const o=[];for(const r of e.energy_sources)if(!n||n.includes(r.type))if("solar"!==r.type)if("gas"!==r.type&&"water"!==r.type)if("battery"!==r.type){for(const e of r.flow_from){o.push(e.stat_energy_from),e.stat_cost&&o.push(e.stat_cost);const n=t.cost_sensors[e.stat_energy_from];n&&o.push(n)}for(const e of r.flow_to){o.push(e.stat_energy_to),e.stat_compensation&&o.push(e.stat_compensation);const n=t.cost_sensors[e.stat_energy_to];n&&o.push(n)}}else o.push(r.stat_energy_from),o.push(r.stat_energy_to);else{o.push(r.stat_energy_from),r.stat_cost&&o.push(r.stat_cost);const e=t.cost_sensors[r.stat_energy_from];e&&o.push(e)}else o.push(r.stat_energy_from);return n&&!n.includes("device")||o.push(...e.device_consumption.map((e=>e.stat_consumption))),o},B=async(e,t,n,o,f)=>{const[y,u]=await Promise.all([(0,b.pB)(e,{domain:"co2signal"}),C(e)]),g=y.length?y[0]:void 0;let d;if(g)for(const r of Object.values(e.entities)){if("co2signal"!==r.platform)continue;const t=e.states[r.entity_id];if(t&&"%"===t.attributes.unit_of_measurement){d=t.entity_id;break}}const p=[];for(const r of t.energy_sources)if("grid"===r.type)for(const e of r.flow_from)p.push(e.stat_energy_from);const h=Z(t,u,["grid","solar","battery","gas","device"]),w=Z(t,u,["water"]),T=[...h,...w],S=(0,r.j)(o||new Date,n),k=(0,s.b)(n)&&(!o||(0,i.h)(o))&&S>35?"month":S>2?"day":"hour",E=e.config.unit_system.length||"",j={energy:"kWh",volume:"km"===E?"m続":"ft続"},A={volume:"km"===E?"L":"gal"},W=h.length?(0,v.dL)(e,n,o,h,k,j,["change"]):{},D=w.length?(0,v.dL)(e,n,o,w,k,A,["change"]):{};let H,O,P,L,B,J={},M={};f&&(O=(0,m.vA)(n,s.b,e.locale,e.config)&&(0,m.vA)(o||new Date,i.h,e.locale,e.config)?(0,m.AH)(n,a.z,e.locale,e.config,-(0,m.Ai)(o||new Date,n,c.d,e.locale,e.config)-1):(0,m.AH)(n,_.E,e.locale,e.config,-1*(S+1)),P=(0,l.n)(n,-1),h.length&&(J=(0,v.dL)(e,O,P,h,k,j,["change"])),w.length&&(M=(0,v.dL)(e,O,P,w,k,A,["change"]))),void 0!==d&&(L=z(e,n,p,d,o,S>35?"month":S>2?"day":"hour"),f&&(B=z(e,O,p,d,P,S>35?"month":S>2?"day":"hour")));const $={},K=T.length?(0,v.Py)(e,T):[],[N,I,Q,R,U,q,x]=await Promise.all([W,D,J,M,K,L,B]),G=Object.assign(Object.assign({},N),I);f&&(H=Object.assign(Object.assign({},Q),R)),T.length&&U.forEach((e=>{$[e.statistic_id]=e}));return{start:n,end:o,startCompare:O,endCompare:P,info:u,prefs:t,stats:G,statsMetadata:$,statsCompare:H,co2SignalConfigEntry:g,co2SignalEntity:d,fossilEnergyConsumption:q,fossilEnergyConsumptionCompare:x}},J=e=>{T.forEach((t=>{const n=$(e,{key:t});n.clearPrefs(),n._active&&n.refresh()}))},M=e=>{if(e._refreshTimeout&&clearTimeout(e._refreshTimeout),e._active&&(!e.end||e.end>new Date)){const t=new Date;t.getMinutes()>=20&&t.setHours(t.getHours()+1),t.setMinutes(20,0,0),e._refreshTimeout=window.setTimeout((()=>e.refresh()),t.getTime()-Date.now())}},$=(e,t={})=>{let n="_energy";if(t.key){if(!t.key.startsWith("energy_"))throw new Error("Key need to start with energy_");n=`_${t.key}`}if(e.connection[n])return e.connection[n];T.push(t.key);const o=(0,g._)(e.connection,n,(async()=>(o.prefs||(o.prefs=await O(e)),M(o),B(e,o.prefs,o.start,o.end,o.compare)))),r=o.subscribe;o.subscribe=e=>{const t=r(e);return o._active++,void 0===o._refreshTimeout&&M(o),()=>{o._active--,o._active<1&&(clearTimeout(o._refreshTimeout),o._refreshTimeout=void 0),t()}},o._active=0,o.prefs=t.prefs;const s=new Date,i=(0,p.Zs)(s,e.locale,e.config).split(":")[0];o.start=(0,m.AH)("0"===i?(0,_.E)(s,-1):s,f.b,e.locale,e.config),o.end=(0,m.AH)("0"===i?(0,_.E)(s,-1):s,y.i,e.locale,e.config);const a=()=>{o._updatePeriodTimeout=window.setTimeout((()=>{o.start=(0,m.AH)(new Date,f.b,e.locale,e.config),o.end=(0,m.AH)(new Date,y.i,e.locale,e.config),a()}),(0,u.T)((0,m.AH)(s,y.i,e.locale,e.config),1).getTime()-Date.now())};return a(),o.clearPrefs=()=>{o.prefs=void 0},o.setPeriod=(t,n)=>{var r;o.start=t,o.end=n,o.start.getTime()!==(0,m.AH)(new Date,f.b,e.locale,e.config).getTime()||(null===(r=o.end)||void 0===r?void 0:r.getTime())!==(0,m.AH)(new Date,y.i,e.locale,e.config).getTime()||o._updatePeriodTimeout?o._updatePeriodTimeout&&(clearTimeout(o._updatePeriodTimeout),o._updatePeriodTimeout=void 0):a()},o.setCompare=e=>{o.compare=e},o},K=e=>e.callWS({type:"energy/solar_forecast"}),N=["volume","energy"],I=(e,t,n={})=>{for(const o of e.energy_sources){if("gas"!==o.type)continue;if(t&&t===o.stat_energy_from)continue;const e=n[o.stat_energy_from];if(N.includes(null==e?void 0:e.unit_class))return e.unit_class}},Q=(e,t,n={})=>{const o=I(t,void 0,n);if(void 0!==o)return"energy"===o?"kWh":"km"===e.config.unit_system.length?"m続":"ft続"},R=e=>"km"===e.config.unit_system.length?"L":"gal",U="/docs/energy/faq/#troubleshooting-missing-entities",q=(0,d.Z)((e=>({summedData:x(e),compareSummedData:e.statsCompare?x(e,!0):void 0}))),x=(e,t)=>{const n={};for(const r of e.prefs.energy_sources)if("solar"!==r.type)if("battery"!==r.type){if("grid"===r.type){for(const e of r.flow_from)n.from_grid?n.from_grid.push(e.stat_energy_from):n.from_grid=[e.stat_energy_from];for(const e of r.flow_to)n.to_grid?n.to_grid.push(e.stat_energy_to):n.to_grid=[e.stat_energy_to]}}else n.to_battery?(n.to_battery.push(r.stat_energy_to),n.from_battery.push(r.stat_energy_from)):(n.to_battery=[r.stat_energy_to],n.from_battery=[r.stat_energy_from]);else n.solar?n.solar.push(r.stat_energy_from):n.solar=[r.stat_energy_from];const o={};return Object.entries(n).forEach((([n,r])=>{const s={},i={};r.forEach((n=>{const o=t?e.statsCompare[n]:e.stats[n];if(!o)return;o.forEach((e=>{if(null===e.change||void 0===e.change)return;const t=e.change;s[e.start]=e.start in s?s[e.start]+t:t})),i[n]={}})),o[n]=s})),o},G=(0,d.Z)(((e,t)=>({consumption:V(e),compareConsumption:t?V(t):void 0}))),V=e=>{const t={total:{}};return Object.keys(e).forEach((n=>{Object.keys(e[n]).forEach((n=>{if(void 0===t.total[n]){var o,r,s,i,a;const c=((null===(o=e.from_grid)||void 0===o?void 0:o[n])||0)+((null===(r=e.solar)||void 0===r?void 0:r[n])||0)+((null===(s=e.from_battery)||void 0===s?void 0:s[n])||0)-((null===(i=e.to_grid)||void 0===i?void 0:i[n])||0)-((null===(a=e.to_battery)||void 0===a?void 0:a[n])||0);t.total[n]=c}}))})),t};o()}catch(T){o(T)}}))}}]);
//# sourceMappingURL=72743.0503904d61226695.js.map