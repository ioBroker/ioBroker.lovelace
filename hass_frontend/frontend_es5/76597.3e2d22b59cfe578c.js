"use strict";(self.webpackChunkhome_assistant_frontend=self.webpackChunkhome_assistant_frontend||[]).push([["76597"],{36185:function(t,e,i){i.a(t,(async function(t,e){try{var s=i(61701),a=(i(19083),i(71695),i(19423),i(40251),i(47021),i(57243)),n=i(50778),l=i(19631),o=i(46467),d=i(36522),r=i(20382),u=(i(37583),i(83166),t([o,l]));[o,l]=u.then?(await u)():u;let h,c,v=t=>t;const m="M19,19H5V8H19M16,1V3H8V1H6V3H5C3.89,3 3,3.89 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5C21,3.89 20.1,3 19,3H18V1M17,12H12V17H17V12Z",p=()=>Promise.all([i.e("97983"),i.e("3134"),i.e("58640"),i.e("60351"),i.e("46360")]).then(i.bind(i,88944)),_=(t,e)=>{(0,d.B)(t,"show-dialog",{dialogTag:"ha-dialog-date-picker",dialogImport:p,dialogParams:e})};(0,s.Z)([(0,n.Mo)("ha-date-input")],(function(t,e){return{F:class extends e{constructor(...e){super(...e),t(this)}},d:[{kind:"field",decorators:[(0,n.Cb)({attribute:!1})],key:"locale",value:void 0},{kind:"field",decorators:[(0,n.Cb)()],key:"value",value:void 0},{kind:"field",decorators:[(0,n.Cb)()],key:"min",value:void 0},{kind:"field",decorators:[(0,n.Cb)()],key:"max",value:void 0},{kind:"field",decorators:[(0,n.Cb)({type:Boolean})],key:"disabled",value(){return!1}},{kind:"field",decorators:[(0,n.Cb)({type:Boolean})],key:"required",value(){return!1}},{kind:"field",decorators:[(0,n.Cb)()],key:"label",value:void 0},{kind:"field",decorators:[(0,n.Cb)()],key:"helper",value:void 0},{kind:"field",decorators:[(0,n.Cb)({attribute:"can-clear",type:Boolean})],key:"canClear",value(){return!1}},{kind:"method",key:"render",value:function(){return(0,a.dy)(h||(h=v`<ha-textfield .label="${0}" .helper="${0}" .disabled="${0}" iconTrailing helperPersistent readonly="readonly" @click="${0}" @keydown="${0}" .value="${0}" .required="${0}"> <ha-svg-icon slot="trailingIcon" .path="${0}"></ha-svg-icon> </ha-textfield>`),this.label,this.helper,this.disabled,this._openDialog,this._keyDown,this.value?(0,o.WB)(new Date(`${this.value.split("T")[0]}T00:00:00`),Object.assign(Object.assign({},this.locale),{},{time_zone:r.c_.local}),{}):"",this.required,m)}},{kind:"method",key:"_openDialog",value:function(){this.disabled||_(this,{min:this.min||"1970-01-01",max:this.max,value:this.value,canClear:this.canClear,onChange:t=>this._valueChanged(t),locale:this.locale.language,firstWeekday:(0,l.Bt)(this.locale)})}},{kind:"method",key:"_keyDown",value:function(t){this.canClear&&["Backspace","Delete"].includes(t.key)&&this._valueChanged(void 0)}},{kind:"method",key:"_valueChanged",value:function(t){this.value!==t&&(this.value=t,(0,d.B)(this,"change"),(0,d.B)(this,"value-changed",{value:t}))}},{kind:"field",static:!0,key:"styles",value(){return(0,a.iv)(c||(c=v`ha-svg-icon{color:var(--secondary-text-color)}ha-textfield{display:block}`))}}]}}),a.oi);e()}catch(h){e(h)}}))},75677:function(t,e,i){i.a(t,(async function(t,s){try{i.r(e),i.d(e,{HaDateTimeSelector:()=>m});var a=i(61701),n=(i(71695),i(47021),i(57243)),l=i(50778),o=i(36522),d=i(36185),r=(i(49653),i(34363),t([d]));d=(r.then?(await r)():r)[0];let u,h,c,v=t=>t,m=(0,a.Z)([(0,l.Mo)("ha-selector-datetime")],(function(t,e){return{F:class extends e{constructor(...e){super(...e),t(this)}},d:[{kind:"field",decorators:[(0,l.Cb)({attribute:!1})],key:"hass",value:void 0},{kind:"field",decorators:[(0,l.Cb)({attribute:!1})],key:"selector",value:void 0},{kind:"field",decorators:[(0,l.Cb)()],key:"value",value:void 0},{kind:"field",decorators:[(0,l.Cb)()],key:"label",value:void 0},{kind:"field",decorators:[(0,l.Cb)()],key:"helper",value:void 0},{kind:"field",decorators:[(0,l.Cb)({type:Boolean,reflect:!0})],key:"disabled",value(){return!1}},{kind:"field",decorators:[(0,l.Cb)({type:Boolean})],key:"required",value(){return!0}},{kind:"field",decorators:[(0,l.IO)("ha-date-input")],key:"_dateInput",value:void 0},{kind:"field",decorators:[(0,l.IO)("ha-time-input")],key:"_timeInput",value:void 0},{kind:"method",key:"render",value:function(){const t="string"==typeof this.value?this.value.split(" "):void 0;return(0,n.dy)(u||(u=v` <div class="input"> <ha-date-input .label="${0}" .locale="${0}" .disabled="${0}" .required="${0}" .value="${0}" @value-changed="${0}"> </ha-date-input> <ha-time-input enable-second .value="${0}" .locale="${0}" .disabled="${0}" .required="${0}" @value-changed="${0}"></ha-time-input> </div> ${0} `),this.label,this.hass.locale,this.disabled,this.required,null==t?void 0:t[0],this._valueChanged,(null==t?void 0:t[1])||"00:00:00",this.hass.locale,this.disabled,this.required,this._valueChanged,this.helper?(0,n.dy)(h||(h=v`<ha-input-helper-text>${0}</ha-input-helper-text>`),this.helper):"")}},{kind:"method",key:"_valueChanged",value:function(t){t.stopPropagation(),this._dateInput.value&&this._timeInput.value&&(0,o.B)(this,"value-changed",{value:`${this._dateInput.value} ${this._timeInput.value}`})}},{kind:"field",static:!0,key:"styles",value(){return(0,n.iv)(c||(c=v`.input{display:flex;align-items:center;flex-direction:row}ha-date-input{min-width:150px;margin-right:4px;margin-inline-end:4px;margin-inline-start:initial}`))}}]}}),n.oi);s()}catch(u){s(u)}}))},69695:function(t,e,i){i.r(e),i.d(e,{HaNumberSelector:()=>m});var s=i(61701),a=(i(71695),i(11740),i(47021),i(57243)),n=i(50778),l=i(35359),o=i(36522);i(34363),i(74421),i(83166);let d,r,u,h,c,v=t=>t,m=(0,s.Z)([(0,n.Mo)("ha-selector-number")],(function(t,e){return{F:class extends e{constructor(...e){super(...e),t(this)}},d:[{kind:"field",decorators:[(0,n.Cb)({attribute:!1})],key:"hass",value:void 0},{kind:"field",decorators:[(0,n.Cb)({attribute:!1})],key:"selector",value:void 0},{kind:"field",decorators:[(0,n.Cb)({type:Number})],key:"value",value:void 0},{kind:"field",decorators:[(0,n.Cb)({type:Number})],key:"placeholder",value:void 0},{kind:"field",decorators:[(0,n.Cb)()],key:"label",value:void 0},{kind:"field",decorators:[(0,n.Cb)()],key:"helper",value:void 0},{kind:"field",decorators:[(0,n.Cb)({type:Boolean})],key:"required",value(){return!0}},{kind:"field",decorators:[(0,n.Cb)({type:Boolean})],key:"disabled",value(){return!1}},{kind:"field",key:"_valueStr",value(){return""}},{kind:"method",key:"willUpdate",value:function(t){t.has("value")&&(""!==this._valueStr&&this.value===Number(this._valueStr)||(this._valueStr=null==this.value||isNaN(this.value)?"":this.value.toString()))}},{kind:"method",key:"render",value:function(){var t,e,i,s,n,o,c,m,p,_,f,k,b,g;const y="box"===(null===(t=this.selector.number)||void 0===t?void 0:t.mode)||void 0===(null===(e=this.selector.number)||void 0===e?void 0:e.min)||void 0===(null===(i=this.selector.number)||void 0===i?void 0:i.max);let $;var x;if(!y&&($=null!==(x=this.selector.number.step)&&void 0!==x?x:1,"any"===$)){$=1;const t=(this.selector.number.max-this.selector.number.min)/100;for(;$>t;)$/=10}return(0,a.dy)(d||(d=v` ${0} <div class="input"> ${0} <ha-textfield .inputMode="${0}" .label="${0}" .placeholder="${0}" class="${0}" .min="${0}" .max="${0}" .value="${0}" .step="${0}" helperPersistent .helper="${0}" .disabled="${0}" .required="${0}" .suffix="${0}" type="number" autoValidate ?no-spinner="${0}" @input="${0}"> </ha-textfield> </div> ${0} `),this.label&&!y?(0,a.dy)(r||(r=v`${0}${0}`),this.label,this.required?"*":""):a.Ld,y?a.Ld:(0,a.dy)(u||(u=v` <ha-slider labeled .min="${0}" .max="${0}" .value="${0}" .step="${0}" .disabled="${0}" .required="${0}" @change="${0}" .ticks="${0}"> </ha-slider> `),this.selector.number.min,this.selector.number.max,null!==(s=this.value)&&void 0!==s?s:"",$,this.disabled,this.required,this._handleSliderChange,null===(n=this.selector.number)||void 0===n?void 0:n.slider_ticks),"any"===(null===(o=this.selector.number)||void 0===o?void 0:o.step)||(null!==(c=null===(m=this.selector.number)||void 0===m?void 0:m.step)&&void 0!==c?c:1)%1!=0?"decimal":"numeric",y?this.label:void 0,this.placeholder,(0,l.$)({single:y}),null===(p=this.selector.number)||void 0===p?void 0:p.min,null===(_=this.selector.number)||void 0===_?void 0:_.max,null!==(f=this._valueStr)&&void 0!==f?f:"",null!==(k=null===(b=this.selector.number)||void 0===b?void 0:b.step)&&void 0!==k?k:1,y?this.helper:void 0,this.disabled,this.required,null===(g=this.selector.number)||void 0===g?void 0:g.unit_of_measurement,!y,this._handleInputChange,!y&&this.helper?(0,a.dy)(h||(h=v`<ha-input-helper-text>${0}</ha-input-helper-text>`),this.helper):a.Ld)}},{kind:"method",key:"_handleInputChange",value:function(t){t.stopPropagation(),this._valueStr=t.target.value;const e=""===t.target.value||isNaN(t.target.value)?void 0:Number(t.target.value);this.value!==e&&(0,o.B)(this,"value-changed",{value:e})}},{kind:"method",key:"_handleSliderChange",value:function(t){t.stopPropagation();const e=Number(t.target.value);this.value!==e&&(0,o.B)(this,"value-changed",{value:e})}},{kind:"field",static:!0,key:"styles",value(){return(0,a.iv)(c||(c=v`.input{display:flex;justify-content:space-between;align-items:center;direction:ltr}ha-slider{flex:1;margin-right:16px;margin-inline-end:16px;margin-inline-start:0}ha-textfield{--ha-textfield-input-width:40px}.single{--ha-textfield-input-width:unset;flex:1}`))}}]}}),a.oi)},316:function(t,e,i){i.a(t,(async function(t,s){try{i.r(e),i.d(e,{DialogStatisticsFixUnsupportedUnitMetadata:()=>S});var a=i(61701),n=(i(71695),i(92745),i(61893),i(9359),i(31526),i(40251),i(19134),i(97003),i(47021),i(31622),i(85017)),l=i(57243),o=i(50778),d=i(27486),r=i(64214),u=i(36522),h=(i(97206),i(73729),i(29073),i(13928),i(7285),i(75677)),c=(i(69695),i(37583),i(17705)),v=i(76131),m=i(28008),p=i(72473),_=t([h,r]);[h,r]=_.then?(await _)():_;let f,k,b,g,y,$,x,w,C=t=>t,S=(0,a.Z)([(0,o.Mo)("dialog-statistics-adjust-sum")],(function(t,e){return{F:class extends e{constructor(...e){super(...e),t(this)}},d:[{kind:"field",decorators:[(0,o.Cb)({attribute:!1})],key:"hass",value:void 0},{kind:"field",decorators:[(0,o.SB)()],key:"_params",value:void 0},{kind:"field",decorators:[(0,o.SB)()],key:"_busy",value(){return!1}},{kind:"field",decorators:[(0,o.SB)()],key:"_moment",value:void 0},{kind:"field",decorators:[(0,o.SB)()],key:"_stats5min",value:void 0},{kind:"field",decorators:[(0,o.SB)()],key:"_statsHour",value:void 0},{kind:"field",decorators:[(0,o.SB)()],key:"_chosenStat",value:void 0},{kind:"field",key:"_origAmount",value:void 0},{kind:"field",decorators:[(0,o.SB)()],key:"_amount",value:void 0},{kind:"field",key:"_dateTimeSelector",value(){return{datetime:{}}}},{kind:"field",key:"_amountSelector",value(){return(0,d.Z)((t=>({number:{step:.01,unit_of_measurement:t,mode:"box"}})))}},{kind:"method",key:"showDialog",value:function(t){this._params=t;const e=new Date;e.setMinutes(e.getMinutes()-e.getMinutes()%5,0),this._moment=(0,n.X)(e),this._fetchStats()}},{kind:"method",key:"closeDialog",value:function(){this._params=void 0,this._moment=void 0,this._stats5min=void 0,this._statsHour=void 0,this._origAmount=void 0,this._amount=void 0,this._chosenStat=void 0,this._busy=!1,(0,u.B)(this,"dialog-closed",{dialog:this.localName})}},{kind:"method",key:"render",value:function(){if(!this._params)return l.Ld;let t;return t=this._chosenStat?this._renderAdjustStat():this._renderPickStatistic(),(0,l.dy)(f||(f=C` <ha-dialog open scrimClickAction escapeKeyAction @closed="${0}" .heading="${0}"> ${0} </ha-dialog> `),this.closeDialog,this.hass.localize("ui.panel.developer-tools.tabs.statistics.fix_issue.adjust_sum.title"),t)}},{kind:"method",key:"shouldUpdate",value:function(t){if(1!==t.size||!t.has("hass"))return!0;const e=t.get("hass");return!e||e.localize!==this.hass.localize}},{kind:"method",key:"_renderPickStatistic",value:function(){let t;if(this._stats5min&&this._statsHour)if(this._statsHour.length<1&&this._stats5min.length<1)t=(0,l.dy)(b||(b=C`<p> ${0} </p>`),this.hass.localize("ui.panel.developer-tools.tabs.statistics.fix_issue.adjust_sum.no_statistics_found"));else{const e=this._stats5min.length>=1?this._stats5min:this._statsHour,i=(0,c.dO)(this.hass,this._params.statistic.statistic_id,this._params.statistic),s=[];for(const t of e){const e=Math.round(100*t.change)/100;s.push((0,l.dy)(g||(g=C` <ha-list-item twoline hasMeta .stat="${0}" @click="${0}"> <span>${0} ${0}</span> <span slot="secondary"> ${0} </span> <ha-icon-next slot="meta"></ha-icon-next> </ha-list-item> `),t,this._setChosenStatistic,e,i,(0,r.o0)(new Date(t.start),this.hass.locale,this.hass.config)))}t=(0,l.dy)(y||(y=C`${0}`),s)}else t=(0,l.dy)(k||(k=C`<ha-circular-progress indeterminate></ha-circular-progress>`));return(0,l.dy)($||($=C` <div class="text-content"> ${0} </div> <div class="text-content"> <b>${0}</b> ${0} </div> <ha-selector-datetime .label="${0}" .hass="${0}" .selector="${0}" .value="${0}" @value-changed="${0}"></ha-selector-datetime> <div class="stat-list">${0}</div> <mwc-button slot="secondaryAction" .label="${0}" @click="${0}"></mwc-button> <mwc-button slot="primaryAction" dialogAction="cancel" .label="${0}"></mwc-button> `),this.hass.localize("ui.panel.developer-tools.tabs.statistics.fix_issue.adjust_sum.info_text_1"),this.hass.localize("ui.panel.developer-tools.tabs.statistics.fix_issue.adjust_sum.statistic"),this._params.statistic.statistic_id,this.hass.localize("ui.panel.developer-tools.tabs.statistics.fix_issue.adjust_sum.pick_a_time"),this.hass,this._dateTimeSelector,this._moment,this._dateTimeSelectorChanged,t,this.hass.localize("ui.panel.developer-tools.tabs.statistics.fix_issue.adjust_sum.outliers"),this._fetchOutliers,this.hass.localize("ui.common.close"))}},{kind:"method",key:"_clearChosenStatistic",value:function(){this._chosenStat=void 0}},{kind:"method",key:"_setChosenStatistic",value:function(t){const e=t.currentTarget.stat,i=Math.round(100*e.change)/100;this._chosenStat=e,this._origAmount=i,this._amount=i}},{kind:"method",key:"_dateTimeSelectorChanged",value:function(t){this._moment=t.detail.value,this._fetchStats()}},{kind:"method",key:"_renderAdjustStat",value:function(){const t=(0,c.dO)(this.hass,this._params.statistic.statistic_id,this._params.statistic);return(0,l.dy)(x||(x=C` <div class="text-content"> <b>${0}</b> ${0} </div> <div class="table-row"> <span>${0}</span> <span>${0}</span> </div> <div class="table-row"> <span>${0}</span> <span>${0}</span> </div> <ha-selector-number .label="${0}" .hass="${0}" .selector="${0}" .value="${0}" .disabled="${0}" @value-changed="${0}"></ha-selector-number> <mwc-button slot="primaryAction" .label="${0}" .disabled="${0}" @click="${0}"></mwc-button> <mwc-button slot="secondaryAction" .label="${0}" .disabled="${0}" @click="${0}"></mwc-button> `),this.hass.localize("ui.panel.developer-tools.tabs.statistics.fix_issue.adjust_sum.statistic"),this._params.statistic.statistic_id,this.hass.localize("ui.panel.developer-tools.tabs.statistics.fix_issue.adjust_sum.start"),(0,r.o0)(new Date(this._chosenStat.start),this.hass.locale,this.hass.config),this.hass.localize("ui.panel.developer-tools.tabs.statistics.fix_issue.adjust_sum.end"),(0,r.o0)(new Date(this._chosenStat.end),this.hass.locale,this.hass.config),this.hass.localize("ui.panel.developer-tools.tabs.statistics.fix_issue.adjust_sum.new_value"),this.hass,this._amountSelector(t||void 0),this._amount,this._busy,this._amountChanged,this.hass.localize("ui.panel.developer-tools.tabs.statistics.fix_issue.adjust_sum.adjust"),this._busy,this._fixIssue,this.hass.localize("ui.common.back"),this._busy,this._clearChosenStatistic)}},{kind:"method",key:"_amountChanged",value:function(t){this._amount=t.detail.value}},{kind:"method",key:"_fetchStats",value:async function(){this._stats5min=void 0,this._statsHour=void 0;const t=this._params.statistic.statistic_id,e=new Date(this._moment.replace(" ","T")),i=new Date(e.getTime());i.setTime(i.getTime()-72e5);const s=new Date(e.getTime());s.setTime(s.getTime()+108e5);const a=await(0,c.dL)(this.hass,i,s,[t],"hour");if(this._statsHour=t in a?a[t].slice(0,5):[],0===this._statsHour.length)return void(this._stats5min=[]);const n=new Date(e.getTime());n.setTime(n.getTime()-6e5);const l=new Date(e.getTime());l.setTime(l.getTime()+9e5);const o=await(0,c.dL)(this.hass,n,l,[t],"5minute");this._stats5min=t in o?o[t].slice(0,5):[]}},{kind:"method",key:"_fetchOutliers",value:async function(){this._stats5min=void 0,this._statsHour=void 0;const t=this._params.statistic.statistic_id,e=new Date(0),i=new Date,s=await(0,c.dL)(this.hass,e,i,[t],"hour"),a=t in s?s[t]:[];if(0===a.length)return;const n=await(0,c.dL)(this.hass,e,i,[t],"5minute"),l=t in n?n[t]:[];l.shift();const o=[];a.forEach((t=>{o.push({hour:t,fiveMin:[]})}));const d={hour:null,fiveMin:[]};let r=0;l.forEach((t=>{let e=!1;for(;r<o.length;r++){const i=o[r].hour;if(i&&t.start>=i.start&&t.end<=i.end){o[r].fiveMin.push(t),e=!0;break}}e||d.fiveMin.push(t)})),o.push(d);let u=[],h=0;const v=t=>{var e;const i=Math.abs(null!==(e=t.change)&&void 0!==e?e:0);var s;(u.length<10||i>h)&&(u.push(t),u=u.sort(((t,e)=>{var i,s;return Math.abs(null!==(i=e.change)&&void 0!==i?i:0)-Math.abs(null!==(s=t.change)&&void 0!==s?s:0)})),u=u.slice(0,10),h=null!==(s=u[u.length-1].change)&&void 0!==s?s:0)};o.forEach((t=>{0===t.fiveMin.length&&t.hour?v(t.hour):t.fiveMin.forEach((t=>{v(t)}))})),this._statsHour=u,this._stats5min=[]}},{kind:"method",key:"_fixIssue",value:async function(){const t=(0,c.dO)(this.hass,this._params.statistic.statistic_id,this._params.statistic);this._busy=!0;try{await(0,c.j2)(this.hass,this._params.statistic.statistic_id,this._chosenStat.start,this._amount-this._origAmount,t||null)}catch(e){return this._busy=!1,void(0,v.showAlertDialog)(this,{text:this.hass.localize("ui.panel.developer-tools.tabs.statistics.fix_issue.adjust_sum.error_sum_adjusted",{message:e.message||e})})}(0,p.C)(this,{message:this.hass.localize("ui.panel.developer-tools.tabs.statistics.fix_issue.adjust_sum.sum_adjusted")}),this.closeDialog()}},{kind:"get",static:!0,key:"styles",value:function(){return[m.Qx,m.yu,(0,l.iv)(w||(w=C`@media all and (max-width:450px),all and (max-height:500px){ha-dialog{--mdc-dialog-max-height:100%;height:100%}}@media all and (min-width:850px){ha-dialog{--mdc-dialog-max-height:80%;--mdc-dialog-max-height:80%}}@media all and (min-width:451px) and (min-height:501px){ha-dialog{--mdc-dialog-max-width:480px}}.text-content,ha-selector-datetime,ha-selector-number{margin-bottom:20px}ha-list-item{margin:0 -24px;--mdc-list-side-padding:24px}.table-row{display:flex;justify-content:space-between;margin-bottom:20px}.stat-list{min-height:360px;display:flex;flex-direction:column}.stat-list ha-circular-progress{margin:0 auto}`))]}}]}}),l.oi);s()}catch(f){s(f)}}))},55800:function(t,e,i){i.d(e,{r:()=>s});i(11740);function s(t,e){return(t<0?"-":"")+Math.abs(t).toString().padStart(e,"0")}},85017:function(t,e,i){i.d(e,{X:()=>l});i(52247);var s=i(55800),a=i(12279),n=i(18112);function l(t,e){var i,l;const o=(0,n.Q)(t,null==e?void 0:e.in);if(!(0,a.J)(o))throw new RangeError("Invalid time value");const d=null!==(i=null==e?void 0:e.format)&&void 0!==i?i:"extended",r=null!==(l=null==e?void 0:e.representation)&&void 0!==l?l:"complete";let u="";const h="extended"===d?"-":"",c="extended"===d?":":"";if("time"!==r){const t=(0,s.r)(o.getDate(),2),e=(0,s.r)(o.getMonth()+1,2);u=`${(0,s.r)(o.getFullYear(),4)}${h}${e}${h}${t}`}if("date"!==r){u=`${u}${""===u?"":" "}${(0,s.r)(o.getHours(),2)}${c}${(0,s.r)(o.getMinutes(),2)}${c}${(0,s.r)(o.getSeconds(),2)}`}return u}},12279:function(t,e,i){i.d(e,{J:()=>n});i(11740);function s(t){return t instanceof Date||"object"==typeof t&&"[object Date]"===Object.prototype.toString.call(t)}var a=i(18112);function n(t){return!(!s(t)&&"number"!=typeof t||isNaN(+(0,a.Q)(t)))}}}]);
//# sourceMappingURL=76597.3e2d22b59cfe578c.js.map