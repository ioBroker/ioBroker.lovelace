"use strict";(self.webpackChunkhome_assistant_frontend=self.webpackChunkhome_assistant_frontend||[]).push([[13786],{13786:function(e,t,a){var i,r,o,n,s=a(88962),l=a(99312),d=a(68990),c=a(81043),h=a(40039),u=a(33368),p=a(71650),f=a(82390),v=a(69205),m=a(70906),y=a(91808),k=a(34541),g=a(47838),b=a(68144),_=a(79932),Z=function(){var e=(0,c.Z)((0,l.Z)().mark((function e(t){var i,r,o,n;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.parentNode){e.next=2;break}throw new Error("Cannot setup Leaflet map on disconnected element");case 2:return e.next=4,a.e(70208).then(a.t.bind(a,70208,23));case 4:return(i=e.sent.default).Icon.Default.imagePath="/static/images/leaflet/images/",r=i.map(t),(o=document.createElement("link")).setAttribute("href","/static/images/leaflet/leaflet.css"),o.setAttribute("rel","stylesheet"),t.parentNode.appendChild(o),r.setView([52.3731339,4.8903147],13),n=w(i).addTo(r),e.abrupt("return",[r,i,n]);case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),w=function(e){return e.tileLayer("https://basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}".concat(e.Browser.retina?"@2x.png":".png"),{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>, &copy; <a href="https://carto.com/attributions">CARTO</a>',subdomains:"abcd",minZoom:0,maxZoom:20})},M=a(22311),x=a(91741),L=a(44281),z=(a(10983),a(47501)),C=a(47181),E=(0,y.Z)(null,(function(e,t){var a=function(t){(0,v.Z)(i,t);var a=(0,m.Z)(i);function i(){var t;(0,p.Z)(this,i);for(var r=arguments.length,o=new Array(r),n=0;n<r;n++)o[n]=arguments[n];return t=a.call.apply(a,[this].concat(o)),e((0,f.Z)(t)),t}return(0,u.Z)(i)}(t);return{F:a,d:[{kind:"field",decorators:[(0,_.Cb)({attribute:"entity-id"})],key:"entityId",value:void 0},{kind:"field",decorators:[(0,_.Cb)({attribute:"entity-name"})],key:"entityName",value:void 0},{kind:"field",decorators:[(0,_.Cb)({attribute:"entity-picture"})],key:"entityPicture",value:void 0},{kind:"field",decorators:[(0,_.Cb)({attribute:"entity-color"})],key:"entityColor",value:void 0},{kind:"method",key:"render",value:function(){return(0,b.dy)(i||(i=(0,s.Z)([' <div class="marker" style="','" @click="','"> '," </div> "])),(0,z.V)({"border-color":this.entityColor}),this._badgeTap,this.entityPicture?(0,b.dy)(r||(r=(0,s.Z)(['<div class="entity-picture" style="','"></div>'])),(0,z.V)({"background-image":"url(".concat(this.entityPicture,")")})):this.entityName)}},{kind:"method",key:"_badgeTap",value:function(e){e.stopPropagation(),this.entityId&&(0,C.B)(this,"hass-more-info",{entityId:this.entityId})}},{kind:"get",static:!0,key:"styles",value:function(){return(0,b.iv)(o||(o=(0,s.Z)([".marker{display:flex;justify-content:center;align-items:center;box-sizing:border-box;overflow:hidden;width:48px;height:48px;font-size:var(--ha-marker-font-size,1.5em);border-radius:50%;border:1px solid var(--ha-marker-color,var(--primary-color));color:var(--primary-text-color);background-color:var(--card-background-color)}.entity-picture{background-size:cover;height:100%;width:100%}"])))}}]}}),b.oi);customElements.define("ha-entity-marker",E);var P=function(e){return"string"==typeof e?e:e.entity_id};(0,y.Z)([(0,_.Mo)("ha-map")],(function(e,t){var a,i,r=function(t){(0,v.Z)(i,t);var a=(0,m.Z)(i);function i(){var t;(0,p.Z)(this,i);for(var r=arguments.length,o=new Array(r),n=0;n<r;n++)o[n]=arguments[n];return t=a.call.apply(a,[this].concat(o)),e((0,f.Z)(t)),t}return(0,u.Z)(i)}(t);return{F:r,d:[{kind:"field",decorators:[(0,_.Cb)({attribute:!1})],key:"hass",value:void 0},{kind:"field",decorators:[(0,_.Cb)({attribute:!1})],key:"entities",value:void 0},{kind:"field",decorators:[(0,_.Cb)({attribute:!1})],key:"paths",value:void 0},{kind:"field",decorators:[(0,_.Cb)({attribute:!1})],key:"layers",value:void 0},{kind:"field",decorators:[(0,_.Cb)({type:Boolean})],key:"autoFit",value:function(){return!1}},{kind:"field",decorators:[(0,_.Cb)({type:Boolean})],key:"renderPassive",value:function(){return!1}},{kind:"field",decorators:[(0,_.Cb)({type:Boolean})],key:"interactiveZones",value:function(){return!1}},{kind:"field",decorators:[(0,_.Cb)({type:Boolean})],key:"fitZones",value:void 0},{kind:"field",decorators:[(0,_.Cb)({type:Boolean})],key:"darkMode",value:void 0},{kind:"field",decorators:[(0,_.Cb)({type:Number})],key:"zoom",value:function(){return 14}},{kind:"field",decorators:[(0,_.SB)()],key:"_loaded",value:function(){return!1}},{kind:"field",key:"leafletMap",value:void 0},{kind:"field",key:"Leaflet",value:void 0},{kind:"field",key:"_resizeObserver",value:void 0},{kind:"field",key:"_mapItems",value:function(){return[]}},{kind:"field",key:"_mapZones",value:function(){return[]}},{kind:"field",key:"_mapPaths",value:function(){return[]}},{kind:"method",key:"connectedCallback",value:function(){(0,k.Z)((0,g.Z)(r.prototype),"connectedCallback",this).call(this),this._loadMap(),this._attachObserver()}},{kind:"method",key:"disconnectedCallback",value:function(){(0,k.Z)((0,g.Z)(r.prototype),"disconnectedCallback",this).call(this),this.leafletMap&&(this.leafletMap.remove(),this.leafletMap=void 0,this.Leaflet=void 0),this._loaded=!1,this._resizeObserver&&this._resizeObserver.unobserve(this)}},{kind:"method",key:"update",value:function(e){var t,a,i,o;if((0,k.Z)((0,g.Z)(r.prototype),"update",this).call(this,e),this._loaded){var n=e.get("hass");if(e.has("_loaded")||e.has("entities"))this._drawEntities();else if(this._loaded&&n&&this.entities){var s,l=(0,h.Z)(this.entities);try{for(l.s();!(s=l.n()).done;){var d=s.value;if(n.states[P(d)]!==this.hass.states[P(d)]){this._drawEntities();break}}}catch(u){l.e(u)}finally{l.f()}}if((e.has("_loaded")||e.has("paths"))&&this._drawPaths(),(e.has("_loaded")||e.has("layers"))&&this._drawLayers(e.get("layers")),(e.has("_loaded")||(e.has("entities")||e.has("layers"))&&this.autoFit)&&this.fitMap(),e.has("zoom")&&this.leafletMap.setZoom(this.zoom),e.has("darkMode")||e.has("hass")&&(!n||(null===(t=n.themes)||void 0===t?void 0:t.darkMode)!==(null===(a=this.hass.themes)||void 0===a?void 0:a.darkMode))){var c=null!==(i=this.darkMode)&&void 0!==i?i:null===(o=this.hass.themes)||void 0===o?void 0:o.darkMode;this.shadowRoot.getElementById("map").classList.toggle("dark",c)}}}},{kind:"method",key:"_loadMap",value:(i=(0,c.Z)((0,l.Z)().mark((function e(){var t,a,i,r,o;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(a=this.shadowRoot.getElementById("map"))||((a=document.createElement("div")).id="map",this.shadowRoot.append(a)),i=null!==(t=this.darkMode)&&void 0!==t?t:this.hass.themes.darkMode,e.next=5,Z(a);case 5:r=e.sent,o=(0,d.Z)(r,2),this.leafletMap=o[0],this.Leaflet=o[1],this.shadowRoot.getElementById("map").classList.toggle("dark",i),this._loaded=!0;case 11:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{kind:"method",key:"fitMap",value:function(e){var t,a,i;if(this.leafletMap&&this.Leaflet&&this.hass)if(this._mapItems.length||null!==(t=this.layers)&&void 0!==t&&t.length){var r,o=this.Leaflet.latLngBounds(this._mapItems?this._mapItems.map((function(e){return e.getLatLng()})):[]);if(this.fitZones)null===(r=this._mapZones)||void 0===r||r.forEach((function(e){o.extend("getBounds"in e?e.getBounds():e.getLatLng())}));null===(a=this.layers)||void 0===a||a.forEach((function(e){o.extend("getBounds"in e?e.getBounds():e.getLatLng())})),o=o.pad(null!==(i=null==e?void 0:e.pad)&&void 0!==i?i:.5),this.leafletMap.fitBounds(o,{maxZoom:(null==e?void 0:e.zoom)||this.zoom})}else this.leafletMap.setView(new this.Leaflet.LatLng(this.hass.config.latitude,this.hass.config.longitude),(null==e?void 0:e.zoom)||this.zoom)}},{kind:"method",key:"fitBounds",value:function(e,t){var a;if(this.leafletMap&&this.Leaflet&&this.hass){var i=this.Leaflet.latLngBounds(e).pad(null!==(a=null==t?void 0:t.pad)&&void 0!==a?a:.5);this.leafletMap.fitBounds(i,{maxZoom:(null==t?void 0:t.zoom)||this.zoom})}}},{kind:"method",key:"_drawLayers",value:function(e){if(e&&e.forEach((function(e){return e.remove()})),this.layers){var t=this.leafletMap;this.layers.forEach((function(e){t.addLayer(e)}))}}},{kind:"method",key:"_drawPaths",value:function(){var e=this,t=this.hass,a=this.leafletMap,i=this.Leaflet;if(t&&a&&i&&(this._mapPaths.length&&(this._mapPaths.forEach((function(e){return e.remove()})),this._mapPaths=[]),this.paths)){var r=getComputedStyle(this).getPropertyValue("--dark-primary-color");this.paths.forEach((function(t){var o,n;t.gradualOpacity&&(o=t.gradualOpacity/(t.points.length-2),n=1-t.gradualOpacity);for(var s=0;s<t.points.length-1;s++){var l=t.gradualOpacity?n+s*o:void 0;e._mapPaths.push(i.circleMarker(t.points[s].point,{radius:3,color:t.color||r,opacity:l,fillOpacity:l,interactive:!0}).bindTooltip(t.points[s].tooltip,{direction:"top"})),e._mapPaths.push(i.polyline([t.points[s].point,t.points[s+1].point],{color:t.color||r,opacity:l,interactive:!1}))}var d=t.points.length-1;if(d>=0){var c=t.gradualOpacity?n+d*o:void 0;e._mapPaths.push(i.circleMarker(t.points[d].point,{radius:3,color:t.color||r,opacity:c,fillOpacity:c,interactive:!0}).bindTooltip(t.points[d].tooltip,{direction:"top"}))}e._mapPaths.forEach((function(e){return a.addLayer(e)}))}))}}},{kind:"method",key:"_drawEntities",value:function(){var e,t=this.hass,a=this.leafletMap,i=this.Leaflet;if(t&&a&&i&&(this._mapItems.length&&(this._mapItems.forEach((function(e){return e.remove()})),this._mapItems=[]),this._mapZones.length&&(this._mapZones.forEach((function(e){return e.remove()})),this._mapZones=[]),this.entities)){var r,o=getComputedStyle(this),n=o.getPropertyValue("--accent-color"),s=o.getPropertyValue("--secondary-text-color"),l=o.getPropertyValue("--dark-primary-color"),d=(null!==(e=this.darkMode)&&void 0!==e?e:this.hass.themes.darkMode)?"dark":"light",c=(0,h.Z)(this.entities);try{for(c.s();!(r=c.n()).done;){var u=r.value,p=t.states[P(u)];if(p){var f=(0,x.C)(p),v=p.attributes,m=v.latitude,y=v.longitude,k=v.passive,g=v.icon,b=v.radius,_=v.entity_picture,Z=v.gps_accuracy;if(m&&y)if("zone"!==(0,M.N)(p)){var w=f.split(" ").map((function(e){return e[0]})).join("").substr(0,3);this._mapItems.push(i.marker([m,y],{icon:i.divIcon({html:'\n              <ha-entity-marker\n                entity-id="'.concat(P(u),'"\n                entity-name="').concat(w,'"\n                entity-picture="').concat(_?this.hass.hassUrl(_):"",'"\n                ').concat("string"!=typeof u?'entity-color="'.concat(u.color,'"'):"","\n              ></ha-entity-marker>\n            "),iconSize:[48,48],className:""}),title:(0,x.C)(p)})),Z&&this._mapItems.push(i.circle([m,y],{interactive:!1,color:l,radius:Z}))}else{if(k&&!this.renderPassive)continue;var L="";if(g){var z=document.createElement("ha-icon");z.setAttribute("icon",g),L=z.outerHTML}else{var C=document.createElement("span");C.innerHTML=f,L=C.outerHTML}this._mapZones.push(i.marker([m,y],{icon:i.divIcon({html:L,iconSize:[24,24],className:d}),interactive:this.interactiveZones,title:f})),this._mapZones.push(i.circle([m,y],{interactive:!1,color:k?s:n,radius:b}))}}}}catch(E){c.e(E)}finally{c.f()}this._mapItems.forEach((function(e){return a.addLayer(e)})),this._mapZones.forEach((function(e){return a.addLayer(e)}))}}},{kind:"method",key:"_attachObserver",value:(a=(0,c.Z)((0,l.Z)().mark((function e(){var t=this;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._resizeObserver){e.next=4;break}return e.next=3,(0,L.j)();case 3:this._resizeObserver=new ResizeObserver((function(){var e;null===(e=t.leafletMap)||void 0===e||e.invalidateSize({debounceMoveend:!0})}));case 4:this._resizeObserver.observe(this);case 5:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{kind:"get",static:!0,key:"styles",value:function(){return(0,b.iv)(n||(n=(0,s.Z)([":host{display:block;height:300px}#map{height:100%}#map.dark{background:#090909;--map-filter:invert(0.9) hue-rotate(170deg) grayscale(0.7)}#map:active{cursor:grabbing;cursor:-moz-grabbing;cursor:-webkit-grabbing}.light{color:#000}.dark{color:#fff}.leaflet-tile-pane{filter:var(--map-filter)}.dark .leaflet-bar a{background-color:var(--card-background-color,#1c1c1c);color:#fff}.leaflet-marker-draggable{cursor:move!important}.leaflet-edit-resize{border-radius:50%;cursor:nesw-resize!important}.named-icon{display:flex;align-items:center;justify-content:center;flex-direction:column;text-align:center;color:var(--primary-text-color)}.leaflet-pane{z-index:0!important}.leaflet-bottom,.leaflet-control,.leaflet-top{z-index:1!important}.leaflet-tooltip{padding:8px;font-size:90%;background:rgba(80,80,80,.9)!important;color:#fff!important;border-radius:4px;box-shadow:none!important}"])))}}]}}),b.fl)}}]);
//# sourceMappingURL=13786-s8ykcajCyFc.js.map