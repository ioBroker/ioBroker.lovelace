"use strict";(self.webpackChunkhome_assistant_frontend=self.webpackChunkhome_assistant_frontend||[]).push([[60076],{30443:function(t,e,i){i.d(e,{Z:function(){return r}});var n=i(59429),o=i(23682);function r(t,e){(0,o.Z)(2,arguments);var i=(0,n.Z)(t),r=(0,n.Z)(e);return i.getTime()===r.getTime()}},53970:function(t,e,i){i.d(e,{Z:function(){return r}});var n=i(30443),o=i(23682);function r(t){return(0,o.Z)(1,arguments),(0,n.Z)(t,Date.now())}},73589:function(t,e,i){i.d(e,{Z:function(){return o}});i(67712),i(51467),i(2094),i(63789),i(24074);var n=function(t){var e=parseFloat(t);if(isNaN(e))throw new Error("".concat(t," is not a number"));return e};function o(t){if(!t)return null;try{if(t.endsWith("%"))return{w:100,h:n(t.substr(0,t.length-1))};var e=t.replace(":","x").split("x");return 0===e.length?null:1===e.length?{w:n(e[0]),h:1}:{w:n(e[0]),h:n(e[1])}}catch(i){}return null}},58763:function(t,e,i){i.d(e,{Nu:function(){return k},Vk:function(){return _},xS:function(){return g},xj:function(){return w}});var n=i(53709),o=i(40039),r=i(71650),s=i(33368),a=(i(40271),i(46798),i(9849),i(13526),i(85717),i(65974),i(97393),i(37313),i(87438),i(22890),i(80628),i(36513),i(50289),i(94167),i(91989),i(60163),i(85472),i(90126),i(46349),i(70320),i(58831)),u=i(41826),c=i(91741),l=["climate","humidifier","water_heater"],h=["climate","humidifier","input_datetime","thermostat","water_heater","person","device_tracker"],d=["temperature","current_temperature","target_temp_low","target_temp_high","hvac_action","humidity","mode","action","current_humidity"],f=function(t,e){return!t.states[e]||h.includes((0,a.M)(e))},_=function(t,e,i,n,o){var r={type:"history/stream",entity_ids:o,start_time:i.toISOString(),end_time:n.toISOString(),minimal_response:!0,no_attributes:!o.some((function(e){return f(t,e)}))},s=new v(t);return t.connection.subscribeMessage((function(t){return e(s.processMessage(t))}),r)},v=function(){function t(e,i){(0,r.Z)(this,t),this.hass=void 0,this.hoursToShow=void 0,this.combinedHistory=void 0,this.hass=e,this.hoursToShow=i,this.combinedHistory={}}return(0,s.Z)(t,[{key:"processMessage",value:function(t){if(!this.combinedHistory||!Object.keys(this.combinedHistory).length)return this.combinedHistory=t.states,this.combinedHistory;if(!Object.keys(t.states).length)return this.combinedHistory;for(var e=this.hoursToShow?((new Date).getTime()-3600*this.hoursToShow*1e3)/1e3:void 0,i={},n=0,o=Object.keys(this.combinedHistory);n<o.length;n++){i[o[n]]=[]}for(var r=0,s=Object.keys(t.states);r<s.length;r++){i[s[r]]=[]}for(var a=0,u=Object.keys(i);a<u.length;a++){var c=u[a];if(c in this.combinedHistory&&c in t.states){var l=this.combinedHistory[c],h=l[l.length-1];i[c]=l.concat(t.states[c]),t.states[c][0].lu<h.lu&&(i[c]=i[c].sort((function(t,e){return t.lu-e.lu})))}else c in this.combinedHistory?i[c]=this.combinedHistory[c]:i[c]=t.states[c];if(e&&c in this.combinedHistory){var d=i[c].filter((function(t){return t.lu<e}));if(!d.length)continue;if(i[c]=i[c].filter((function(t){return t.lu>=e})),i[c].length&&i[c][0].lu===e)continue;var f=d[d.length-1];f.lu=e,i[c].unshift(f)}}return this.combinedHistory=i,this.combinedHistory}}]),t}(),g=function(t,e,i,n){var o=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],r=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],s=arguments.length>6?arguments[6]:void 0,a={type:"history/stream",entity_ids:n,start_time:new Date((new Date).getTime()-3600*i*1e3).toISOString(),minimal_response:o,significant_changes_only:r,no_attributes:null!=s?s:!n.some((function(e){return f(t,e)}))},u=new v(t,i);return t.connection.subscribeMessage((function(t){return e(u.processMessage(t))}),a)},m=function(t,e){return t.state===e.state&&(!t.attributes||!e.attributes||d.every((function(i){return t.attributes[i]===e.attributes[i]})))},y=["counter","input_number","number"],b=function(t){return y.includes(t)},p=function(t){return"unit_of_measurement"in t||"state_class"in t},k=function(t,e,i,r){var s={},h=[];return e?(Object.keys(e).forEach((function(l){var d,f=e[l];if(0!==f.length){var _,v=(0,a.M)(l),g=l in t.states?t.states[l]:void 0,m=g||b(v)?void 0:f.find((function(t){return t.a&&p(t.a)})),y=b(v)||null!=g&&p(g.attributes)||null!=g&&"sensor"===v&&function(t,e){return null!=t.attributes.device_class&&e.includes(t.attributes.device_class)}(g,r)||null!=m;_=y?(null==g?void 0:g.attributes.unit_of_measurement)||(null==m?void 0:m.a.unit_of_measurement)||" ":{zone:i("ui.dialogs.more_info_control.zone.graph_unit"),climate:t.config.unit_system.temperature,humidifier:"%",water_heater:t.config.unit_system.temperature}[v];var k=null===(d=(null==g?void 0:g.attributes)||(null==m?void 0:m.a))||void 0===d?void 0:d.device_class,H=w(_,k);if(_)if(H in s&&l in s[H]){var Z;(Z=s[H][l]).push.apply(Z,(0,n.Z)(f))}else H in s||(s[H]={}),s[H][l]=f;else h.push(function(t,e,i,n,r,s,a){var l,h=[],d=s[0],f=(0,o.Z)(s);try{for(f.s();!(l=f.n()).done;){var _=l.value;if(!(h.length>0&&_.s===h[h.length-1].state)){var v={};null!=a&&a.attributes.device_class&&(v.device_class=null==a?void 0:a.attributes.device_class),h.push({state_localize:(0,u.computeStateDisplayFromEntityAttributes)(t,e,i,n[r],r,Object.assign(Object.assign({},_.a||d.a),v),_.s),state:_.s,last_changed:1e3*(_.lc?_.lc:_.lu)})}}}catch(g){f.e(g)}finally{f.f()}return{name:(0,c.a)(r,(null==a?void 0:a.attributes)||d.a),entity_id:r,data:h}}(i,t.locale,t.config,t.entities,l,f,g))}})),{line:Object.keys(s).map((function(e){var i=e.split("_");return function(t,e,i,n){var r=[];return Object.keys(i).forEach((function(t){var e,s=i[t],u=s[0],h=(0,a.M)(t),f=[],_=(0,o.Z)(s);try{for(_.s();!(e=_.n()).done;){var v=e.value,g=void 0;if(l.includes(h)){g={state:v.s,last_changed:1e3*v.lu,attributes:{}};for(var y=0,b=d;y<b.length;y++){var p=b[y];p in v.a&&(g.attributes[p]=v.a[p])}}else g={state:v.s,last_changed:1e3*(v.lc?v.lc:v.lu),attributes:{}};f.length>1&&m(g,f[f.length-1])&&m(g,f[f.length-2])||f.push(g)}}catch(w){_.e(w)}finally{_.f()}var k=t in n?n[t].attributes:"friendly_name"in u.a?u.a:void 0;r.push({domain:h,name:(0,c.a)(t,k||{}),entity_id:t,states:f})})),{unit:t,device_class:e,identifier:Object.keys(i).join(""),data:r}}(i[0],i[1]||void 0,s[e],t.states)})),timeline:h}):{line:[],timeline:[]}},w=function(t,e){return"".concat(t,"_").concat(e||"")}},60076:function(t,e,i){i.r(e),i.d(e,{DEFAULT_HOURS_TO_SHOW:function(){return V},DEFAULT_ZOOM:function(){return D}});var n,o,r,s=i(40039),a=i(53709),u=i(88962),c=i(99312),l=i(81043),h=i(33368),d=i(71650),f=i(82390),_=i(69205),v=i(70906),g=i(91808),m=i(34541),y=i(47838),b=(i(97393),i(51467),i(5110),i(76843),i(51358),i(46798),i(47084),i(5239),i(98490),i(46349),i(70320),i(40271),i(60163),i(10733),i(36513),i(22859),i(65974),i(53970)),p=i(68144),k=i(95260),w=i(14516),H=i(55070),Z=i(7323),E=i(44583),M=i(49684),S=i(58831),O=i(36639),x=i(73589),A=(i(22098),i(9381),i(10983),i(13786),i(58763)),j=i(53658),C=i(15688),z=i(90271),V=0,D=14;(0,g.Z)([(0,k.Mo)("hui-map-card")],(function(t,e){var g,T=function(e){(0,_.Z)(n,e);var i=(0,v.Z)(n);function n(){var e;(0,d.Z)(this,n);for(var o=arguments.length,r=new Array(o),s=0;s<o;s++)r[s]=arguments[s];return e=i.call.apply(i,[this].concat(r)),t((0,f.Z)(e)),e}return(0,h.Z)(n)}(e);return{F:T,d:[{kind:"field",decorators:[(0,k.Cb)({attribute:!1})],key:"hass",value:void 0},{kind:"field",decorators:[(0,k.Cb)({type:Boolean,reflect:!0})],key:"isPanel",value:function(){return!1}},{kind:"field",decorators:[(0,k.SB)()],key:"_stateHistory",value:void 0},{kind:"field",decorators:[(0,k.SB)()],key:"_config",value:void 0},{kind:"field",decorators:[(0,k.IO)("ha-map")],key:"_map",value:void 0},{kind:"field",key:"_configEntities",value:void 0},{kind:"field",decorators:[(0,k.SB)()],key:"_mapEntities",value:function(){return[]}},{kind:"field",key:"_colorDict",value:function(){return{}}},{kind:"field",key:"_colorIndex",value:function(){return 0}},{kind:"field",decorators:[(0,k.SB)()],key:"_error",value:void 0},{kind:"field",key:"_subscribed",value:void 0},{kind:"method",key:"setConfig",value:function(t){var e;if(!t)throw new Error("Error in card configuration.");if(!(null!==(e=t.entities)&&void 0!==e&&e.length||t.geo_location_sources))throw new Error("Either entities or geo_location_sources must be specified");if(t.entities&&!Array.isArray(t.entities))throw new Error("Entities need to be an array");if(t.geo_location_sources&&!Array.isArray(t.geo_location_sources))throw new Error("Parameter geo_location_sources needs to be an array");this._config=t,this._configEntities=t.entities?(0,z.A)(t.entities):[],this._mapEntities=this._getMapEntities()}},{kind:"method",key:"getCardSize",value:function(){var t;if(null===(t=this._config)||void 0===t||!t.aspect_ratio)return 7;var e=(0,x.Z)(this._config.aspect_ratio),i=e&&e.w>0&&e.h>0?"".concat((100*e.h/e.w).toFixed(2)):"100";return 1+Math.floor(Number(i)/25)||3}},{kind:"method",static:!0,key:"getConfigElement",value:(g=(0,l.Z)((0,c.Z)().mark((function t(){return(0,c.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Promise.all([i.e(42850),i.e(78133),i.e(50731),i.e(68331),i.e(40163),i.e(74535),i.e(77434),i.e(62065)]).then(i.bind(i,62065));case 2:return t.abrupt("return",document.createElement("hui-map-card-editor"));case 3:case"end":return t.stop()}}),t)}))),function(){return g.apply(this,arguments)})},{kind:"method",static:!0,key:"getStubConfig",value:function(t,e,i){return{type:"map",entities:(0,C.j)(t,2,e,i,["device_tracker"])}}},{kind:"method",key:"render",value:function(){var t;return this._config?this._error?(0,p.dy)(n||(n=(0,u.Z)(['<ha-alert alert-type="error"> ',": "," (",") </ha-alert>"])),this.hass.localize("ui.components.map.error"),this._error.message,this._error.code):(0,p.dy)(o||(o=(0,u.Z)([' <ha-card id="card" .header="','"> <div id="root"> <ha-map .hass="','" .entities="','" .zoom="','" .paths="','" .autoFit="','" .fitZones="','" .darkMode="','" interactiveZones renderPassive></ha-map> <ha-icon-button .label="','" .path="','" @click="','" tabindex="0"></ha-icon-button> </div> </ha-card> '])),this._config.title,this.hass,this._mapEntities,null!==(t=this._config.default_zoom)&&void 0!==t?t:D,this._getHistoryPaths(this._config,this._stateHistory),this._config.auto_fit||!1,this._config.fit_zones,this._config.dark_mode,this.hass.localize("ui.panel.lovelace.cards.map.reset_focus"),"M12,9A3,3 0 0,0 9,12A3,3 0 0,0 12,15A3,3 0 0,0 15,12A3,3 0 0,0 12,9M19,19H15V21H19A2,2 0 0,0 21,19V15H19M19,3H15V5H19V9H21V5A2,2 0 0,0 19,3M5,5H9V3H5A2,2 0 0,0 3,5V9H5M5,15H3V19A2,2 0 0,0 5,21H9V19H5V15Z",this._fitMap):p.Ld}},{kind:"method",key:"shouldUpdate",value:function(t){var e,i;if(!t.has("hass")||t.size>1)return!0;var n=t.get("hass");return!n||!this._configEntities||(n.themes.darkMode!==this.hass.themes.darkMode||(!!t.has("_stateHistory")||(!(null===(e=this._config)||void 0===e||!e.geo_location_sources||n.states===this.hass.states)||(null!==(i=this._config)&&void 0!==i&&i.entities?(0,j.Wh)(this,t):(0,j.SN)(this,t)))))}},{kind:"method",key:"willUpdate",value:function(t){var e,i;(0,m.Z)((0,y.Z)(T.prototype),"willUpdate",this).call(this,t),t.has("hass")&&null!==(e=this._config)&&void 0!==e&&e.geo_location_sources&&!(0,O.v)(this._getSourceEntities(null===(i=t.get("hass"))||void 0===i?void 0:i.states),this._getSourceEntities(this.hass.states))&&(this._mapEntities=this._getMapEntities())}},{kind:"method",key:"connectedCallback",value:function(){var t;(0,m.Z)((0,y.Z)(T.prototype),"connectedCallback",this).call(this),this.hasUpdated&&null!==(t=this._configEntities)&&void 0!==t&&t.length&&this._subscribeHistory()}},{kind:"method",key:"disconnectedCallback",value:function(){(0,m.Z)((0,y.Z)(T.prototype),"disconnectedCallback",this).call(this),this._unsubscribeHistory()}},{kind:"method",key:"_subscribeHistory",value:function(){var t,e,i,n=this;(0,Z.p)(this.hass,"history")&&!this._subscribed&&(null!==(t=null===(e=this._config)||void 0===e?void 0:e.hours_to_show)&&void 0!==t?t:V)&&(this._subscribed=(0,A.xS)(this.hass,(function(t){n._subscribed&&(n._stateHistory=t)}),null!==(i=this._config.hours_to_show)&&void 0!==i?i:V,(this._configEntities||[]).map((function(t){return t.entity})),!1,!1,!1).catch((function(t){n._subscribed=void 0,n._error=t})))}},{kind:"method",key:"_unsubscribeHistory",value:function(){this._subscribed&&(this._subscribed.then((function(t){return null==t?void 0:t()})),this._subscribed=void 0)}},{kind:"method",key:"updated",value:function(t){var e;null!==(e=this._configEntities)&&void 0!==e&&e.length?this._subscribed&&!t.has("_config")||(this._unsubscribeHistory(),this._subscribeHistory()):this._unsubscribeHistory(),t.has("_config")&&this._computePadding()}},{kind:"method",key:"_computePadding",value:function(){var t=this.shadowRoot.getElementById("root");if(this._config&&!this.isPanel&&t)if(this._config.aspect_ratio){t.style.height="auto";var e=(0,x.Z)(this._config.aspect_ratio);t.style.paddingBottom=e&&e.w>0&&e.h>0?"".concat((100*e.h/e.w).toFixed(2),"%"):t.style.paddingBottom="100%"}else t.style.paddingBottom="100%"}},{kind:"method",key:"_fitMap",value:function(){var t;null===(t=this._map)||void 0===t||t.fitMap()}},{kind:"method",key:"_getColor",value:function(t){var e=this._colorDict[t];return e||(e=(0,H.Eu)(this._colorIndex),this._colorIndex++,this._colorDict[t]=e,e)}},{kind:"method",key:"_getSourceEntities",value:function(t){var e;if(!t||null===(e=this._config)||void 0===e||!e.geo_location_sources)return[];for(var i=[],n=this._config.geo_location_sources.includes("all"),o=0,r=Object.values(t);o<r.length;o++){var s=r[o];"geo_location"===(0,S.M)(s.entity_id)&&(n||this._config.geo_location_sources.includes(s.attributes.source))&&i.push(s.entity_id)}return i}},{kind:"method",key:"_getMapEntities",value:function(){var t,e=this;return[].concat((0,a.Z)((this._configEntities||[]).map((function(t){return{entity_id:t.entity,color:e._getColor(t.entity),label_mode:t.label_mode,focus:t.focus,name:t.name}}))),(0,a.Z)(this._getSourceEntities(null===(t=this.hass)||void 0===t?void 0:t.states).map((function(t){return{entity_id:t,color:e._getColor(t)}}))))}},{kind:"field",key:"_getHistoryPaths",value:function(){var t=this;return(0,w.Z)((function(e,i){var n;if(i&&(null!==(n=e.hours_to_show)&&void 0!==n?n:V)){for(var o=[],r=0,a=Object.keys(i);r<a.length;r++){var u=a[r];if("zone"!==(0,S.M)(u)){var c=i[u];if(null!=c&&c.length){var l,h=[],d=(0,s.Z)(c);try{for(d.s();!(l=d.n()).done;){var f,_=l.value,v=_.a.latitude,g=_.a.longitude;if(v&&g){var m={};m.point=[v,g];var y=new Date(1e3*_.lu);(null!==(f=e.hours_to_show)&&void 0!==f?f:V)>144?m.tooltip=(0,E.o0)(y,t.hass.locale,t.hass.config):(0,b.Z)(y)?m.tooltip=(0,M.Vu)(y,t.hass.locale,t.hass.config):m.tooltip=(0,M.xO)(y,t.hass.locale,t.hass.config),h.push(m)}}}catch(p){d.e(p)}finally{d.f()}o.push({points:h,color:t._getColor(u),gradualOpacity:.8})}}}return o}}))}},{kind:"get",static:!0,key:"styles",value:function(){return(0,p.iv)(r||(r=(0,u.Z)(["ha-card{overflow:hidden;width:100%;height:100%;display:flex;flex-direction:column}ha-map{z-index:0;border:none;position:absolute;top:0;left:0;width:100%;height:100%;background:inherit}ha-icon-button{position:absolute;top:75px;left:3px;outline:0}#root{position:relative;height:100%}"])))}}]}}),p.oi)},5110:function(t,e,i){var n=i(68077),o=i(55418),r=i(97673),s=i(29191),a=i(93892),u=i(18431),c=RangeError,l=String,h=Math.floor,d=o(a),f=o("".slice),_=o(1..toFixed),v=function(t,e,i){return 0===e?i:e%2==1?v(t,e-1,i*t):v(t*t,e/2,i)},g=function(t,e,i){for(var n=-1,o=i;++n<6;)o+=e*t[n],t[n]=o%1e7,o=h(o/1e7)},m=function(t,e){for(var i=6,n=0;--i>=0;)n+=t[i],t[i]=h(n/e),n=n%e*1e7},y=function(t){for(var e=6,i="";--e>=0;)if(""!==i||0===e||0!==t[e]){var n=l(t[e]);i=""===i?n:i+d("0",7-n.length)+n}return i};n({target:"Number",proto:!0,forced:u((function(){return"0.000"!==_(8e-5,3)||"1"!==_(.9,0)||"1.25"!==_(1.255,2)||"1000000000000000128"!==_(0xde0b6b3a7640080,0)}))||!u((function(){_({})}))},{toFixed:function(t){var e,i,n,o,a=s(this),u=r(t),h=[0,0,0,0,0,0],_="",b="0";if(u<0||u>20)throw new c("Incorrect fraction digits");if(a!=a)return"NaN";if(a<=-1e21||a>=1e21)return l(a);if(a<0&&(_="-",a=-a),a>1e-21)if(i=(e=function(t){for(var e=0,i=t;i>=4096;)e+=12,i/=4096;for(;i>=2;)e+=1,i/=2;return e}(a*v(2,69,1))-69)<0?a*v(2,-e,1):a/v(2,e,1),i*=4503599627370496,(e=52-e)>0){for(g(h,0,i),n=u;n>=7;)g(h,1e7,0),n-=7;for(g(h,v(10,n,1),0),n=e-1;n>=23;)m(h,1<<23),n-=23;m(h,1<<n),g(h,1,1),m(h,2),b=y(h)}else g(h,0,i),g(h,1<<-e,0),b=y(h)+d("0",u);return b=u>0?_+((o=b.length)<=u?"0."+d("0",u-o)+b:f(b,0,o-u)+"."+f(b,o-u)):_+b}})}}]);
//# sourceMappingURL=60076.SSu2yYvQVos.js.map