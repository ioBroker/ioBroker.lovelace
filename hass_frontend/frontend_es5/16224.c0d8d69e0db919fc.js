"use strict";(self.webpackChunkhome_assistant_frontend=self.webpackChunkhome_assistant_frontend||[]).push([["16224"],{50875:function(t,e,i){i.d(e,{Eu:()=>a,hZ:()=>r,o9:()=>c});var s=i(27486),n=i(11259);const o=["#4269d0","#f4bd4a","#ff725c","#6cc5b0","#a463f2","#ff8ab7","#9c6b4e","#97bbf5","#01ab63","#9498a0","#094bad","#c99000","#d84f3e","#49a28f","#048732","#d96895","#8043ce","#7599d1","#7a4c31","#74787f","#6989f4","#ffd444","#ff957c","#8fe9d3","#62cc71","#ffadda","#c884ff","#badeff","#bf8b6d","#b6bac2","#927acc","#97ee3f","#bf3947","#9f5b00","#f48758","#8caed6","#f2b94f","#eff26e","#e43872","#d9b100","#9d7a00","#698cff","#d9d9d9","#00d27e","#d06800","#009f82","#c49200","#cbe8ff","#fecddf","#c27eb6","#8cd2ce","#c4b8d9","#f883b0","#a49100","#f48800","#27d0df","#a04a9b"];function a(t){return o[t%o.length]}function r(t,e){const i=e.getPropertyValue(`--graph-color-${t+1}`)||a(t);return(0,n.Rq)(i)}const c=(0,s.Z)((t=>o.map(((e,i)=>r(i,t)))),((t,e)=>t[0].getPropertyValue("--graph-color-1")===e[0].getPropertyValue("--graph-color-1")))},97547:function(t,e,i){i.a(t,(async function(t,s){try{i.d(e,{c:()=>m,computeStateDisplay:()=>f});i(19083),i(19423),i(61006);var n=i(96194),o=i(20382),a=i(54363),r=i(46467),c=i(64214),u=i(33570),h=i(50602),d=i(87974),l=i(73850),_=t([a,h,r,u,c]);[a,h,r,u,c]=_.then?(await _)():_;const f=(t,e,i,s,n,o,a)=>{const r=null==o?void 0:o[e.entity_id];return m(t,i,s,n,r,e.entity_id,e.attributes,void 0!==a?a:e.state)},m=(t,e,i,s,_,f,m,y)=>{if(y===n.lz||y===n.nZ)return t(`state.default.${y}`);const b=(0,l.M)(f),g="counter"===b||"number"===b||"input_number"===b;if((0,h.sJ)(m,"sensor"===b?i:[])||g){if("duration"===m.device_class&&m.unit_of_measurement&&a.a_.includes(m.unit_of_measurement))try{return(0,a.LU)(e,y,m.unit_of_measurement,null==_?void 0:_.display_precision)}catch(v){}if("monetary"===m.device_class)try{return(0,h.uf)(y,e,Object.assign({style:"currency",currency:m.unit_of_measurement,minimumFractionDigits:2},(0,h.l4)({state:y,attributes:m},_)))}catch(v){}const i=(0,h.uf)(y,e,(0,h.l4)({state:y,attributes:m},_)),s=(null==_?void 0:_.translation_key)&&t(`component.${_.platform}.entity.${b}.${_.translation_key}.unit_of_measurement`)||m.unit_of_measurement;return s?`${i}${(0,d.L)(s,e)}${s}`:i}if(["date","input_datetime","time"].includes(b))try{const t=y.split(" ");if(2===t.length)return(0,c.o0)(new Date(t.join("T")),Object.assign(Object.assign({},e),{},{time_zone:o.c_.local}),s);if(1===t.length){if(y.includes("-"))return(0,r.p6)(new Date(`${y}T00:00`),Object.assign(Object.assign({},e),{},{time_zone:o.c_.local}),s);if(y.includes(":")){const t=new Date;return(0,u.mr)(new Date(`${t.toISOString().split("T")[0]}T${y}`),Object.assign(Object.assign({},e),{},{time_zone:o.c_.local}),s)}}return y}catch(p){return y}if(["button","conversation","event","image","input_button","notify","scene","stt","tag","tts","wake_word","datetime"].includes(b)||"sensor"===b&&"timestamp"===m.device_class)try{return(0,c.o0)(new Date(y),e,s)}catch(v){return y}return(null==_?void 0:_.translation_key)&&t(`component.${_.platform}.entity.${b}.${_.translation_key}.state.${y}`)||m.device_class&&t(`component.${b}.entity_component.${m.device_class}.state.${y}`)||t(`component.${b}.entity_component._.state.${y}`)||y};s()}catch(f){s(f)}}))},31428:function(t,e,i){i.d(e,{U:()=>_});i(71695),i(47021);var s=i(50875),n=i(11259),o=i(4643),a=i(73850),r=i(42818),c=i(96194),u=i(76190);const h={media_player:{paused:.5,idle:1},vacuum:{returning:.5}};let d=0;const l=new Map;function _(t,e,i){return function(t,e,i){var s;if(!i||t===c.nZ)return(0,u.g)("--history-unavailable-color",e);if(t===c.lz)return(0,u.g)("--history-unknown-color",e);const d=(0,r.tD)(i,t);if(!d)return;const l=(0,u.g)(d,e);if(!l)return;const _=(0,a.M)(i.entity_id),f=null===(s=h[_])||void 0===s?void 0:s[t];return f?(0,n.uO)((0,o.C)((0,n.Rw)((0,n.wK)(l)),f)):l}(t,e,i)||function(t,e){if(l.has(t))return l.get(t);const i=(0,s.hZ)(d,e);return d++,l.set(t,i),i}(t,e)}},6280:function(t,e,i){i.a(t,(async function(t,s){try{i.d(e,{Nu:()=>S,V3:()=>H,Vk:()=>l,YA:()=>$,xS:()=>f,zP:()=>j});i(19083),i(71695),i(92745),i(61893),i(84283),i(9359),i(56475),i(1331),i(31526),i(70104),i(52924),i(19423),i(11740),i(92519),i(42179),i(89256),i(24931),i(88463),i(57449),i(19814),i(61006),i(47021);var n=i(73850),o=i(97547),a=i(47194),r=t([o]);o=(r.then?(await r)():r)[0];const c=["climate","humidifier","water_heater"],u=["climate","humidifier","input_datetime","thermostat","water_heater","person","device_tracker"],h=["temperature","current_temperature","target_temp_low","target_temp_high","hvac_action","humidity","mode","action","current_humidity"],d=(t,e)=>!t.states[e]||u.includes((0,n.M)(e)),l=(t,e,i,s,n)=>{const o={type:"history/stream",entity_ids:n,start_time:i.toISOString(),end_time:s.toISOString(),minimal_response:!0,no_attributes:!n.some((e=>d(t,e)))},a=new _(t);return t.connection.subscribeMessage((t=>e(a.processMessage(t))),o)};class _{constructor(t,e){this.hass=void 0,this.hoursToShow=void 0,this.combinedHistory=void 0,this.hass=t,this.hoursToShow=e,this.combinedHistory={}}processMessage(t){if(!this.combinedHistory||!Object.keys(this.combinedHistory).length)return this.combinedHistory=t.states,this.combinedHistory;if(!Object.keys(t.states).length)return this.combinedHistory;const e=this.hoursToShow?((new Date).getTime()-3600*this.hoursToShow*1e3)/1e3:void 0,i={};for(const s of Object.keys(this.combinedHistory))i[s]=[];for(const s of Object.keys(t.states))i[s]=[];for(const s of Object.keys(i)){if(s in this.combinedHistory&&s in t.states){const e=this.combinedHistory[s],n=e[e.length-1];i[s]=e.concat(t.states[s]),t.states[s][0].lu<n.lu&&(i[s]=i[s].sort(((t,e)=>t.lu-e.lu)))}else s in this.combinedHistory?i[s]=this.combinedHistory[s]:i[s]=t.states[s];if(e&&s in this.combinedHistory){const t=i[s].filter((t=>t.lu<e));if(!t.length)continue;if(i[s]=i[s].filter((t=>t.lu>=e)),i[s].length&&i[s][0].lu===e)continue;const n=t[t.length-1];n.lu=e,i[s].unshift(n)}}return this.combinedHistory=i,this.combinedHistory}}const f=(t,e,i,s,n,o=!0,a=!0)=>{const r={type:"history/stream",entity_ids:s,start_time:new Date((new Date).getTime()-3600*i*1e3).toISOString(),minimal_response:o,significant_changes_only:a,no_attributes:null!=n?n:!s.some((e=>d(t,e)))},c=new _(t,i);return t.connection.subscribeMessage((t=>e(c.processMessage(t))),r)},m=(t,e)=>t.state===e.state&&(!t.attributes||!e.attributes||h.every((i=>t.attributes[i]===e.attributes[i]))),y=(t,e,i,s,n,r,c)=>{const u=[],h=r[0];for(const a of r){if(u.length>0&&a.s===u[u.length-1].state)continue;const r={};null!=c&&c.attributes.device_class&&(r.device_class=null==c?void 0:c.attributes.device_class),u.push({state_localize:(0,o.c)(t,e,[],i,s[n],n,Object.assign(Object.assign({},a.a||h.a),r),a.s),state:a.s,last_changed:1e3*(a.lc?a.lc:a.lu)})}return{name:(0,a.a)(n,(null==c?void 0:c.attributes)||h.a),entity_id:n,data:u}},b=(t,e,i,s)=>{const o=[];return Object.keys(i).forEach((t=>{const e=i[t],r=e[0],u=(0,n.M)(t),d=[];for(const i of e){let t;if(c.includes(u)){t={state:i.s,last_changed:1e3*i.lu,attributes:{}};for(const e of h)e in i.a&&(t.attributes[e]=i.a[e])}else t={state:i.s,last_changed:1e3*(i.lc?i.lc:i.lu),attributes:{}};d.length>1&&m(t,d[d.length-1])&&m(t,d[d.length-2])||d.push(t)}const l=t in s?s[t].attributes:"friendly_name"in r.a?r.a:void 0;o.push({domain:u,name:(0,a.a)(t,l||{}),entity_id:t,states:d})})),{unit:t,device_class:e,identifier:Object.keys(i).join(""),data:o}},g=["counter","input_number","number"],v=t=>g.includes(t),p=t=>"unit_of_measurement"in t||"state_class"in t,k=(t,e)=>null!=t.attributes.device_class&&e.includes(t.attributes.device_class),w=" ",$=(t,e,i,s,n=!1)=>{const o={};i.forEach((t=>{t in e&&(o[t]=e[t])}));const a={};Object.entries(o).forEach((([t,e])=>{const i=e.map((t=>({s:null!=t.mean?t.mean.toString():t.state.toString(),lc:t.start/1e3,a:{},lu:t.start/1e3})));a[t]=i}));const r=S(t,a,[],t.localize,s,n,!0);return((null==r?void 0:r.line)||[]).forEach((t=>{t.data.forEach((t=>{t.statistics=t.states,t.states=[]}))})),r},S=(t,e,i,s,o,a=!1,r=!1)=>{const c={},u=[],h={};if(new Set([...i,...Object.keys(e)]).forEach((i=>{i in e?h[i]=e[i]:t.states[i]&&(h[i]=[{s:t.states[i].state,a:t.states[i].attributes,lu:new Date(t.states[i].last_updated).getTime()/1e3}])})),!h)return{line:[],timeline:[]};Object.keys(h).forEach((e=>{var i;const d=h[e];if(0===d.length)return;const l=(0,n.M)(e),_=e in t.states?t.states[e]:void 0,f=_||v(l)?void 0:d.find((t=>t.a&&p(t.a)));let m;m=j(l,_,f,o,r)?(null==_?void 0:_.attributes.unit_of_measurement)||(null==f?void 0:f.a.unit_of_measurement)||w:{zone:s("ui.dialogs.more_info_control.zone.graph_unit"),climate:t.config.unit_system.temperature,humidifier:"%",water_heater:t.config.unit_system.temperature}[l];const b={climate:"temperature",humidifier:"humidity",water_heater:"temperature"}[l]||(null===(i=(null==_?void 0:_.attributes)||(null==f?void 0:f.a))||void 0===i?void 0:i.device_class),g=O(m,b,a);m?g&&g in c&&e in c[g]?c[g][e].push(...d):g&&(g in c||(c[g]={}),c[g][e]=d):u.push(y(s,t.locale,t.config,t.entities,e,d,_))}));return{line:Object.keys(c).map((e=>{const i=e.split("_"),s=i[0],n=i[1]||void 0;return b(s,n,c[e],t.states)})),timeline:u}},O=(t,e,i)=>i?`${t}_${e||""}`:t,j=(t,e,i,s,n=!1)=>n||v(t)||null!=e&&p(e.attributes)||null!=e&&"sensor"===t&&k(e,s)||null!=i,H=(t,e,i=!0)=>{if(!e)return t;const s=Object.assign(Object.assign({},t),{},{line:[]}),n={};for(const a of t.line){const t=O(a.unit,a.device_class,i);t&&(n[t]={historyItem:a})}for(const a of e.line){const t=O(a.unit,a.device_class,i);t&&(t in n?n[t].ltsItem=a:n[t]={ltsItem:a})}for(const{historyItem:a,ltsItem:r}of Object.values(n)){if(!a||!r){s.line.push(a||r);continue}const t=Object.assign(Object.assign({},a),{},{data:[]}),e=new Set([...a.data.map((t=>t.entity_id)),...r.data.map((t=>t.entity_id))]);for(const i of e){var o;const e=a.data.find((t=>t.entity_id===i)),s=r.data.find((t=>t.entity_id===i));if(!e||!s){t.data.push(e||s);continue}const n=(null===(o=e.states[0])||void 0===o?void 0:o.last_changed)||s.statistics[s.statistics.length-1].last_changed+1,c=[];for(const t of s.statistics){if(t.last_changed>=n)break;c.push(t)}t.data.push(0===c.length?e:Object.assign(Object.assign({},e),{},{statistics:c}))}s.line.push(t)}return s};s()}catch(c){s(c)}}))},26799:function(t,e,i){i.a(t,(async function(t,s){try{i.r(e),i.d(e,{DEFAULT_HOURS_TO_SHOW:()=>S,HuiHistoryGraphCard:()=>O});var n=i(61701),o=i(72621),a=(i(52247),i(71695),i(92745),i(9359),i(31526),i(19423),i(40251),i(47021),i(57243)),r=i(50778),c=i(35359),u=i(72344),h=i(71489),d=(i(99426),i(54977),i(13928),i(6280)),l=i(96309),_=i(93331),f=i(29401),m=i(58776),y=i(17705),b=t([h,d]);[h,d]=b.then?(await b)():b;let g,v,p,k,w,$=t=>t;const S=24;let O=(0,n.Z)([(0,r.Mo)("hui-history-graph-card")],(function(t,e){class s extends e{constructor(...e){super(...e),t(this)}}return{F:s,d:[{kind:"method",static:!0,key:"getConfigElement",value:async function(){return await Promise.all([i.e("46379"),i.e("24199"),i.e("78943"),i.e("27090"),i.e("3049"),i.e("47744")]).then(i.bind(i,96312)),document.createElement("hui-history-graph-card-editor")}},{kind:"method",static:!0,key:"getStubConfig",value:function(){return{type:"history-graph",entities:["sun.sun"]}}},{kind:"field",decorators:[(0,r.Cb)({attribute:!1})],key:"hass",value:void 0},{kind:"field",decorators:[(0,r.SB)()],key:"_history",value:void 0},{kind:"field",decorators:[(0,r.SB)()],key:"_statisticsHistory",value:void 0},{kind:"field",decorators:[(0,r.SB)()],key:"_config",value:void 0},{kind:"field",decorators:[(0,r.SB)()],key:"_error",value:void 0},{kind:"field",key:"_names",value(){return{}}},{kind:"field",key:"_entityIds",value(){return[]}},{kind:"field",key:"_hoursToShow",value(){return S}},{kind:"field",key:"_interval",value:void 0},{kind:"field",key:"_subscribed",value:void 0},{kind:"method",key:"getCardSize",value:function(){var t,e;return null!==(t=this._config)&&void 0!==t&&t.title?2:0+2*((null===(e=this._entityIds)||void 0===e?void 0:e.length)||1)}},{kind:"method",key:"getGridOptions",value:function(){return{columns:12,min_columns:6,min_rows:2}}},{kind:"method",key:"setConfig",value:function(t){if(!t.entities||!Array.isArray(t.entities))throw new Error("Entities need to be an array");if(!t.entities.length)throw new Error("You must include at least one entity");const e=t.entities?(0,f.A)(t.entities):[];this._entityIds=[],e.forEach((t=>{this._entityIds.push(t.entity),t.name&&(this._names[t.entity]=t.name)})),this._hoursToShow=t.hours_to_show||S,this._config=t}},{kind:"method",key:"connectedCallback",value:function(){(0,o.Z)(s,"connectedCallback",this,3)([]),this.hasUpdated&&this._subscribeHistory()}},{kind:"method",key:"disconnectedCallback",value:function(){(0,o.Z)(s,"disconnectedCallback",this,3)([]),this._unsubscribeHistory()}},{kind:"method",key:"_subscribeHistory",value:async function(){if(!(0,u.p)(this.hass,"history")||this._subscribed)return;const{numeric_device_classes:t}=await(0,l.ib)(this.hass);this._subscribed=(0,d.xS)(this.hass,(e=>{var i,s;if(!this._subscribed)return;const n=(0,d.Nu)(this.hass,e,this._entityIds,this.hass.localize,t,null===(i=this._config)||void 0===i?void 0:i.split_device_classes);this._history=(0,d.V3)(n,this._statisticsHistory,null===(s=this._config)||void 0===s?void 0:s.split_device_classes)}),this._hoursToShow,this._entityIds).catch((t=>{this._subscribed=void 0,this._error=t})),await this._fetchStatistics(t),this._setRedrawTimer()}},{kind:"method",key:"_fetchStatistics",value:async function(t){var e;const i=new Date,s=new Date;s.setHours(s.getHours()-this._hoursToShow);const n=await(0,y.dL)(this.hass,s,i,this._entityIds,"hour",void 0,["mean","state"]);this._statisticsHistory=(0,d.YA)(this.hass,n,this._entityIds,t,null===(e=this._config)||void 0===e?void 0:e.split_device_classes)}},{kind:"method",key:"_redrawGraph",value:function(){this._history&&(this._history=Object.assign({},this._history))}},{kind:"method",key:"_setRedrawTimer",value:function(){clearInterval(this._interval),this._interval=window.setInterval((()=>this._redrawGraph()),6e4)}},{kind:"method",key:"_unsubscribeHistory",value:function(){clearInterval(this._interval),this._subscribed&&(this._subscribed.then((t=>null==t?void 0:t())),this._subscribed=void 0)}},{kind:"method",key:"shouldUpdate",value:function(t){return(0,_.Wh)(this,t)||t.size>1||!t.has("hass")}},{kind:"method",key:"updated",value:function(t){if((0,o.Z)(s,"updated",this,3)([t]),!(this._config&&this.hass&&this._hoursToShow&&this._entityIds.length))return;if(!t.has("_config")&&!t.has("hass"))return;const e=t.get("_config");!t.has("_config")||(null==e?void 0:e.entities)===this._config.entities&&(null==e?void 0:e.hours_to_show)===this._config.hours_to_show||(this._unsubscribeHistory(),this._subscribeHistory())}},{kind:"method",key:"render",value:function(){var t,e,i,s;if(!this.hass||!this._config)return a.Ld;const n=new Date;n.setHours(n.getHours()-this._hoursToShow);const o=`/history?${(0,m.ou)({entity_id:this._entityIds.join(","),start_date:n.toISOString()})}`,r=null!==(t=null===(e=this._config.grid_options)||void 0===e?void 0:e.columns)&&void 0!==t?t:12,u="number"==typeof r&&r<=12,h="number"==typeof(null===(i=this._config.grid_options)||void 0===i?void 0:i.rows);return(0,a.dy)(g||(g=$` <ha-card> ${0} <div class="content ${0}"> ${0} </div> </ha-card> `),this._config.title?(0,a.dy)(v||(v=$` <h1 class="card-header"> ${0} <a href="${0}"><ha-icon-next></ha-icon-next></a> </h1> `),this._config.title,o):a.Ld,(0,c.$)({"has-header":!!this._config.title,"has-rows":!(null===(s=this._config.grid_options)||void 0===s||!s.rows),"has-height":h}),this._error?(0,a.dy)(p||(p=$` <ha-alert alert-type="error"> ${0}: ${0} </ha-alert> `),this.hass.localize("ui.components.history_charts.error"),this._error.message||this._error.code):(0,a.dy)(k||(k=$` <state-history-charts .hass="${0}" .isLoadingData="${0}" .historyData="${0}" .names="${0}" up-to-now .hoursToShow="${0}" .showNames="${0}" .logarithmicScale="${0}" .minYAxis="${0}" .maxYAxis="${0}" .fitYData="${0}" .height="${0}" .narrow="${0}" .expandLegend="${0}"></state-history-charts> `),this.hass,!this._history,this._history,this._names,this._hoursToShow,void 0===this._config.show_names||this._config.show_names,this._config.logarithmic_scale||!1,this._config.min_y_axis,this._config.max_y_axis,this._config.fit_y_data||!1,h?"100%":void 0,u,this._config.expand_legend))}},{kind:"field",static:!0,key:"styles",value(){return(0,a.iv)(w||(w=$`ha-card{display:flex;flex-direction:column;height:100%}.card-header{justify-content:space-between;display:flex;padding-bottom:0}.card-header ha-icon-next{--mdc-icon-button-size:24px;line-height:24px;color:var(--primary-text-color)}.content{padding:0 16px 8px;flex:1;overflow:hidden}.has-header{padding-top:0}state-history-charts{--timeline-top-margin:16px}.has-height state-history-charts{height:100%}.has-rows{--chart-max-height:100%}`))}}]}}),a.oi);s()}catch(g){s(g)}}))}}]);
//# sourceMappingURL=16224.c0d8d69e0db919fc.js.map