"use strict";(self.webpackChunkhome_assistant_frontend=self.webpackChunkhome_assistant_frontend||[]).push([["63697"],{50875:function(t,e,s){s.d(e,{Eu:()=>o,hZ:()=>r,o9:()=>d});var a=s(27486),i=s(11259);const n=["#4269d0","#f4bd4a","#ff725c","#6cc5b0","#a463f2","#ff8ab7","#9c6b4e","#97bbf5","#01ab63","#9498a0","#094bad","#c99000","#d84f3e","#49a28f","#048732","#d96895","#8043ce","#7599d1","#7a4c31","#74787f","#6989f4","#ffd444","#ff957c","#8fe9d3","#62cc71","#ffadda","#c884ff","#badeff","#bf8b6d","#b6bac2","#927acc","#97ee3f","#bf3947","#9f5b00","#f48758","#8caed6","#f2b94f","#eff26e","#e43872","#d9b100","#9d7a00","#698cff","#d9d9d9","#00d27e","#d06800","#009f82","#c49200","#cbe8ff","#fecddf","#c27eb6","#8cd2ce","#c4b8d9","#f883b0","#a49100","#f48800","#27d0df","#a04a9b"];function o(t){return n[t%n.length]}function r(t,e){const s=e.getPropertyValue(`--graph-color-${t+1}`)||o(t);return(0,i.Rq)(s)}const d=(0,a.Z)((t=>n.map(((e,s)=>r(s,t)))),((t,e)=>t[0].getPropertyValue("--graph-color-1")===e[0].getPropertyValue("--graph-color-1")))},6736:function(t,e,s){s.d(e,{f:()=>o});var a=s(61701),i=s(72621),n=(s(19083),s(71695),s(9359),s(52924),s(40251),s(61006),s(47021),s(50778));const o=t=>(0,a.Z)(null,(function(t,e){class s extends e{constructor(...e){super(...e),t(this)}}return{F:s,d:[{kind:"field",decorators:[(0,n.Cb)({attribute:!1})],key:"hass",value:void 0},{kind:"field",key:"hassSubscribeRequiredHostProps",value:void 0},{kind:"field",key:"__unsubs",value:void 0},{kind:"method",key:"connectedCallback",value:function(){(0,i.Z)(s,"connectedCallback",this,3)([]),this._checkSubscribed()}},{kind:"method",key:"disconnectedCallback",value:function(){if((0,i.Z)(s,"disconnectedCallback",this,3)([]),this.__unsubs){for(;this.__unsubs.length;){const t=this.__unsubs.pop();t instanceof Promise?t.then((t=>t())):t()}this.__unsubs=void 0}}},{kind:"method",key:"updated",value:function(t){if((0,i.Z)(s,"updated",this,3)([t]),t.has("hass"))this._checkSubscribed();else if(this.hassSubscribeRequiredHostProps)for(const e of t.keys())if(this.hassSubscribeRequiredHostProps.includes(e))return void this._checkSubscribed()}},{kind:"method",key:"hassSubscribe",value:function(){return[]}},{kind:"method",key:"_checkSubscribed",value:function(){var t;void 0!==this.__unsubs||!this.isConnected||void 0===this.hass||null!==(t=this.hassSubscribeRequiredHostProps)&&void 0!==t&&t.some((t=>void 0===this[t]))||(this.__unsubs=this.hassSubscribe())}}]}}),t)},20548:function(t,e,s){s.d(e,{H:()=>n});s(81804);var a=s(11259),i=s(4643);function n(t,e,s,n,o,r){const d=t.getPropertyValue(o+"-"+r).trim(),c=d.length>0?d:t.getPropertyValue(o).trim();let u=(0,a.Rq)(c);return 0===d.length&&r&&(u=(0,a.CO)((0,a.p3)(e?(0,i.C)((0,a.Rw)((0,a.wK)(u)),r):(0,i.W)((0,a.Rw)((0,a.wK)(u)),r)))),n?u+=s?"32":"7F":s&&(u+="7F"),u}},53259:function(t,e,s){s.a(t,(async function(t,a){try{s.d(e,{J:()=>y,MC:()=>k,Zx:()=>$,b4:()=>g,kT:()=>C});s(28457),s(71695),s(92745),s(61893),s(5509),s(9359),s(56475),s(31526),s(70104),s(19423),s(92519),s(42179),s(89256),s(24931),s(88463),s(57449),s(19814),s(88044),s(47021);var i=s(21893),n=s(13809),o=s(38836),r=s(84775),d=s(80951),c=s(13730),u=s(6542),l=s(83204),h=s(23459),f=s(23711),m=s(50602),p=s(46467),v=s(33570),b=t([p,v,m]);function k(t,e){let s=new Date(e);return t>2&&0===s.getHours()&&(s=(0,i.b)(s,1)),s.setMinutes(0,0,0),t>35&&s.setDate(1),t>2&&s.setHours(0),s.getTime()}function g(t){return t>35?"month":t>2?"day":"hour"}function y(t,e,s,a,i,o,r,d){const c=(0,n.j)(e,t),u=void 0!==o&&void 0!==r;return{xAxis:{type:"time",min:t,max:k(c,e)},yAxis:{type:"value",name:i,nameGap:2,nameTextStyle:{align:"left"},axisLabel:{formatter:t=>(0,m.uf)(Math.abs(t),s)},splitLine:{show:!0}},grid:{top:15,bottom:0,left:1,right:1,containLabel:!0},tooltip:{trigger:"axis",formatter:t=>{if(Array.isArray(t)){const e=[],n=[];return t.forEach((t=>{var s;null!==(s=t.seriesId)&&void 0!==s&&s.startsWith("compare-")?n.push(t):e.push(t)})),[e,n].map((t=>S(t,s,a,c,u,i,d))).filter(Boolean).join("<br><br>")}return S([t],s,a,c,u,i,d)}}}}function S(t,e,s,a,i,n,r){var d,c,u,l;if(null===(d=t[0])||void 0===d||!d.value)return"";const h=new Date(null!==(c=null===(u=t[0].value)||void 0===u?void 0:u[2])&&void 0!==c?c:null===(l=t[0].value)||void 0===l?void 0:l[0]);let f;f=a>89?`${(0,p.NC)(h,e,s)}`:a>0?`${(0,p.ud)(h,e,s)}`:`${i?`${(0,p.ud)(h,e,s)}: `:""}${(0,v.mr)(h,e,s)} â€“ ${(0,v.mr)((0,o.T)(h,1),e,s)}`;const b=`<h4 style="text-align: center; margin: 0;">${f}</h4>`;let _=0,k=0,g=0,y=0;const S=t.map((t=>{var s;const a=null===(s=t.value)||void 0===s?void 0:s[1],i=(0,m.uf)(a,e);return"0"!==i&&("bar"===t.componentSubType&&(a>0?(_+=a,k++):(g+=a,y++)),`${t.marker} ${t.seriesName}: ${i} ${n}`)})).filter(Boolean);let $="";return 0!==_&&k>1&&r&&($+=`<br><b>${r(_)}</b>`),0!==g&&y>1&&r&&($+=`<br><b>${r(g)}</b>`),S.length>0?`${b}${S.join("<br>")}${$}`:""}function $(t){Array.from(new Set(t.map((t=>t.data.map((t=>Number(t[0]))))).flat())).sort(((t,e)=>t-e)).forEach(((e,s)=>{const a={},i={};for(let l=t.length-1;l>=0;l--){var n,o,r,d,c;const h=t[l].data[s],f=h&&"object"==typeof h&&"value"in h?h:{value:h},m=null===(n=f.value)||void 0===n?void 0:n[0],p=null!==(o=t[l].stack)&&void 0!==o?o:"";var u;if(void 0!==m)if(Number(m)!==e)null===(u=t[l].data)||void 0===u||u.splice(s,0,{value:[e,0],itemStyle:{borderWidth:0}});else 0===(null===(r=f.value)||void 0===r?void 0:r[1])?t[l].data[s]=Object.assign(Object.assign({},f),{},{itemStyle:Object.assign(Object.assign({},f.itemStyle),{},{borderWidth:0})}):!a[p]&&(null===(d=f.value)||void 0===d?void 0:d[1])>0?(t[l].data[s]=Object.assign(Object.assign({},f),{},{itemStyle:Object.assign(Object.assign({},f.itemStyle),{},{borderRadius:[4,4,0,0]})}),a[p]=!0):!i[p]&&(null===(c=f.value)||void 0===c?void 0:c[1])<0&&(t[l].data[s]=Object.assign(Object.assign({},f),{},{itemStyle:Object.assign(Object.assign({},f.itemStyle),{},{borderRadius:[0,0,4,4]})}),i[p]=!0)}}))}function C(t,e){if(!e)return t=>t;const s=(0,r.o)(t,e);if(0!==s&&t.getTime()===(0,d.e)(t).getTime())return t=>(0,c.B)(t,s);const a=(0,u.d)(t,e);if(0!==a&&t.getTime()===(0,l.N)(t).getTime())return t=>(0,h.z)(t,a);const i=t.getTime()-e.getTime();return t=>(0,f.n)(t,i)}[p,v,m]=b.then?(await b)():b,a()}catch(_){a(_)}}))},36681:function(t,e,s){s.a(t,(async function(t,a){try{s.r(e),s.d(e,{HuiEnergyDevicesDetailGraphCard:()=>O});var i=s(61701),n=(s(71695),s(92745),s(52805),s(61893),s(9359),s(56475),s(31526),s(70104),s(48136),s(19423),s(19134),s(97003),s(47021),s(42625)),o=s(83389),r=s(57243),d=s(50778),c=s(35359),u=s(27486),l=s(50875),h=s(20548),f=(s(54977),s(25179)),m=s(1118),p=s(17705),v=s(6736),b=s(93331),_=s(53259),k=s(68958),g=s(50602),y=t([f,g,m,_]);[f,g,m,_]=y.then?(await y)():y;let S,$,C,x=t=>t;const j="kWh";let O=(0,i.Z)([(0,d.Mo)("hui-energy-devices-detail-graph-card")],(function(t,e){return{F:class extends e{constructor(...e){super(...e),t(this)}},d:[{kind:"field",decorators:[(0,d.Cb)({attribute:!1})],key:"hass",value:void 0},{kind:"field",decorators:[(0,d.SB)()],key:"_config",value:void 0},{kind:"field",decorators:[(0,d.SB)()],key:"_chartData",value(){return[]}},{kind:"field",decorators:[(0,d.SB)()],key:"_data",value:void 0},{kind:"field",decorators:[(0,d.SB)()],key:"_start",value(){return(0,n.I)()}},{kind:"field",decorators:[(0,d.SB)()],key:"_end",value(){return(0,o.p)()}},{kind:"field",decorators:[(0,d.SB)()],key:"_compareStart",value:void 0},{kind:"field",decorators:[(0,d.SB)()],key:"_compareEnd",value:void 0},{kind:"field",decorators:[(0,k.t)({key:"energy-devices-hidden-stats",state:!0,subscribe:!1})],key:"_hiddenStats",value(){return[]}},{kind:"field",key:"hassSubscribeRequiredHostProps",value(){return["_config"]}},{kind:"method",key:"hassSubscribe",value:function(){var t;return[(0,m.UB)(this.hass,{key:null===(t=this._config)||void 0===t?void 0:t.collection_key}).subscribe((t=>{this._data=t,this._processStatistics()}))]}},{kind:"method",key:"getCardSize",value:function(){return 3}},{kind:"method",key:"setConfig",value:function(t){this._config=t}},{kind:"method",key:"shouldUpdate",value:function(t){return(0,b.SN)(this,t)||t.size>1||!t.has("hass")}},{kind:"method",key:"willUpdate",value:function(t){(t.has("_hiddenStats")||t.has("_config"))&&this._data&&this._processStatistics()}},{kind:"method",key:"render",value:function(){return this.hass&&this._config?(0,r.dy)(S||(S=x` <ha-card> ${0} <div class="content ${0}"> <ha-chart-base .hass="${0}" .data="${0}" .options="${0}" @dataset-hidden="${0}" @dataset-unhidden="${0}"></ha-chart-base> </div> </ha-card> `),this._config.title?(0,r.dy)($||($=x`<h1 class="card-header">${0}</h1>`),this._config.title):"",(0,c.$)({"has-header":!!this._config.title}),this.hass,this._chartData,this._createOptions(this._start,this._end,this.hass.locale,this.hass.config,j,this._compareStart,this._compareEnd),this._datasetHidden,this._datasetUnhidden):r.Ld}},{kind:"field",key:"_formatTotal",value(){return t=>this.hass.localize("ui.panel.lovelace.cards.energy.energy_usage_graph.total_consumed",{num:(0,g.uf)(t,this.hass.locale),unit:j})}},{kind:"method",key:"_datasetHidden",value:function(t){this._hiddenStats=[...this._hiddenStats,t.detail.name]}},{kind:"method",key:"_datasetUnhidden",value:function(t){this._hiddenStats=this._hiddenStats.filter((e=>e!==t.detail.name))}},{kind:"field",key:"_createOptions",value(){return(0,u.Z)(((t,e,s,a,i,n,o)=>{const r=(0,_.J)(t,e,s,a,i,n,o,this._formatTotal);return Object.assign(Object.assign({},r),{},{legend:{show:!0,type:"scroll",animationDurationUpdate:400,selected:this._hiddenStats.reduce(((t,e)=>(t[e]=!1,t)),{}),icon:"circle"},grid:{top:15,bottom:0,left:1,right:1,containLabel:!0}})}))}},{kind:"method",key:"_processStatistics",value:function(){const t=this._data;this._start=t.start,this._end=t.end||(0,o.p)(),this._compareStart=t.startCompare,this._compareEnd=t.endCompare;const e=t.stats,s=t.statsCompare,a=getComputedStyle(this),i={};t.prefs.device_consumption.forEach((t=>{const s=t.stat_consumption in e&&(0,p.Kj)(e[t.stat_consumption])||0;i[t.stat_consumption]=s}));const n=t.prefs.device_consumption.map((t=>t.stat_consumption));n.sort(((t,e)=>i[e]-i[t]));const r=[],{summedData:d,compareSummedData:c}=(0,m.EH)(t),u="from_grid"in d||"solar"in d||"from_battery"in d,{consumption:l,compareConsumption:h}=u?(0,m.E4)(d,c):{consumption:void 0,compareConsumption:void 0};if(s){const e=this._processDataSet(a,s,t.statsMetadata,t.prefs.device_consumption,n,!0);if(r.push(...e),u){const t=this._processUntracked(a,e,h,!0);r.push(t)}}else{var f,v;const e=null!==(f=null===(v=t.prefs.device_consumption[0])||void 0===v?void 0:v.stat_consumption)&&void 0!==f?f:"untracked";r.push({id:"compare-"+e,type:"bar",stack:"devices",data:[]})}const b=this._processDataSet(a,e,t.statsMetadata,t.prefs.device_consumption,n);if(r.push(...b),u){const t=this._processUntracked(a,b,l,!1);r.push(t)}(0,_.Zx)(r),this._chartData=r}},{kind:"method",key:"_processUntracked",value:function(t,e,s,a){const i={};e.forEach((t=>{t.data.forEach((t=>{i[t[a?2:0]]=(i[t[a?2:0]]||0)+t[1]}))}));const n=(0,_.kT)(this._start,this._compareStart),o=[];Object.keys(s.total).sort(((t,e)=>Number(t)-Number(e))).forEach((t=>{const e=Number(t),r=[e,s.total[t]-(i[t]||0)];a&&(r[2]=r[0],r[0]=n(new Date(e)).getTime()),o.push(r)}));const r=Date.now();return{type:"bar",cursor:"default",id:a?`compare-untracked-${r}`:`untracked-${r}`,name:this.hass.localize("ui.panel.lovelace.cards.energy.energy_devices_detail_graph.untracked_consumption"),itemStyle:{borderColor:(0,h.H)(t,this.hass.themes.darkMode,!1,a,"--state-unavailable-color")},barMaxWidth:50,color:(0,h.H)(t,this.hass.themes.darkMode,!0,a,"--state-unavailable-color"),data:o,stack:a?"devicesCompare":"devices"}}},{kind:"method",key:"_processDataSet",value:function(t,e,s,a,i,n=!1){const o=[],r=(0,_.kT)(this._start,this._compareStart);return a.forEach(((a,d)=>{var c;const u=i.indexOf(a.stat_consumption);if(null!==(c=this._config)&&void 0!==c&&c.max_devices&&u>=this._config.max_devices)return void console.warn(`Max devices exceeded for ${a.name} (${u} >= ${this._config.max_devices})`);const h=(0,l.hZ)(d,t);let f=null;const m=[];if(a.stat_consumption in e){const t=e[a.stat_consumption];for(const e of t){if(null===e.change||void 0===e.change||0===e.change)continue;if(f===e.start)continue;const t=[e.start,e.change];n&&(t[2]=t[0],t[0]=r(new Date(e.start)).getTime()),m.push(t),f=e.start}}o.push({type:"bar",cursor:"default",id:n?`compare-${a.stat_consumption}-${u}`:`${a.stat_consumption}-${u}`,name:a.name||(0,p.Kd)(this.hass,a.stat_consumption,s[a.stat_consumption]),itemStyle:{borderColor:n?h+"7F":h},barMaxWidth:50,color:n?h+"32":h+"7F",data:m,stack:n?"devicesCompare":"devices"})})),i.map((t=>o.find((e=>e.id.replace(/^compare-/,"").replace(/-\d+$/,"")===t)))).filter(Boolean)}},{kind:"field",static:!0,key:"styles",value(){return(0,r.iv)(C||(C=x`.card-header{padding-bottom:0}.content{padding:16px}.has-header{padding-top:0}`))}}]}}),(0,v.f)(r.oi));a()}catch(S){a(S)}}))}}]);
//# sourceMappingURL=63697.00f053a82154f53f.js.map